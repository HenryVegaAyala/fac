function LimnpiarForm(){$("#ddlPlantilla")[0].selectedIndex=0;var e=tinyMCE.get("txtEstructura");e.setContent(""),$("#txtAsunto").val("").focus()}function EnviarEmail(){var e=new FormData;e.append("btnEnviarEmail","btnEnviarEmail"),precargaExp("#form1",!0),tinymce.triggerSave();var t=$("#form1 :input").serializeArray();$.each(t,function(t,a){e.append(a.name,a.value)}),$.ajax({url:"services/email/email-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){precargaExp("#form1",!1),MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){"0"!=e.rpta&&LimnpiarForm()})},error:function(e){console.log(e)}})}function InsertarImagenes(){var e=window.location.href.split("/"),t=window.location.pathname.split("/"),a=e[0]+"//"+e[2]+"/"+t[1],i=$("#gvFiles .selected"),n=i.length;if(n>0){for(var l=0,s=tinyMCE.get("txtEstructura"),c=s.selection.getRng();n>l;){var o=s.getDoc().createElement("img");o.src=a+"/"+i[l].getAttribute("data-url"),c.insertNode(o),++l}$("#btnHideFiles").trigger("click"),$("#btnClearSelect").trigger("click")}}function AdjuntarArchivos(){var e=$("#gvFiles .selected"),t=e.length;if(t>0){for(var a="",i=0;t>i;){var n=e[i].getAttribute("data-name");a+='<div class="file-attach float-left bg-darkCyan fg-white padding10 margin10"><input type="hidden" name="attachFiles[]" value="'+n+'" />'+n+'&nbsp;<a href="#" data-action="delete" class="float-right fg-white"><i class="icon-cancel-2"></i></a></div>',++i}0==$("#attach-files .file-attach").length&&$("#attach-files").html(""),$("#attach-files").append(a),$("#btnHideFiles").trigger("click"),$("#btnClearSelect").trigger("click")}}function insertarContenido(e){var t=tinyMCE.get("txtEstructura");t.insertContent(e)}function ListarArchivos(e,t){var a="",i="",n="";a="#gvFiles .gridview",i="#moduloFiles .colTwoPanel2",precargaExp(i,!0),$.ajax({url:"services/files/files-search.php",type:"GET",cache:!1,dataType:"json",data:{folder:e,tipo:t,criterio:n}}).done(function(e){var n=0,l=e.length,s="";if(precargaExp(i,!1),l>0)for(;l>n;){var c=e[n].path,o=e[n].file,r=e[n].ext,d="",u="";d="documents"==t?"icon":"image",s+='<div class="tile dato" data-name="'+o+'" data-url="'+c+'">',s+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+c+'" />',s+='<div class="tile_true_content">',s+='<div class="tile-content '+d+'">',"media"==t?s+='<img src="'+c+'" alt="" />':(u="doc"==r||"docx"==r?"file-word":"xls"==r||"xlsx"==r?"file-excel":"ppt"==r||"pptx"==r?"file-powerpoint":"pdf"==r?"file-pdf":"zip"==r||"rar"==r||"7z"==r?"file-zip":"html"==r||"htm"==r?"html5":"file",s+='<i class="icon-'+u+' fg-black"></i>'),s+="</div>",s+='<div class="tile-status bg-dark opacity">',s+='<span class="label">'+o+"</span>",s+="</div>",s+="</div>",s+="</div>",++n}$(a).html(s)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}function ListarModelo(){$.ajax({url:"services/modelocarta/modelocarta-search.php",type:"GET",dataType:"json",data:{tipo:"1",tipobusqueda:"3",criterio:""},success:function(e){var t="",a=0,i=e.length;if(i>0){for(;i>a;)t+='<option value="'+e[a].idmodelocarta+'">'+e[a].nombre+"</option>",++a;$("#ddlPlantilla").append(t)}},error:function(e){console.log(e)}})}function getModelo(e){$.ajax({url:"services/modelocarta/modelocarta-search.php",type:"GET",dataType:"json",data:{tipo:"1",tipobusqueda:"2",id:e},success:function(e){var t=e.length;if(t>0){var a=e[0].contenido;insertarContenido(a)}},error:function(e){console.log(e)}})}$(function(){ListarModelo(),$("#ddlPlantilla").on("change",function(e){e.preventDefault();var t=$(this).val();if("0"==t){var a=tinyMCE.get("txtEstructura");a.setContent("")}else getModelo(t)}),tinymce.init({selector:"textarea",plugins:["advlist autolink lists link image charmap anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste"],toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image ",autosave_ask_before_unload:!1,min_height:160,relative_urls:!1,remove_script_host:!1,convert_urls:!0,menubar:"tools edit table format view insert",setup:function(e){}}),$("#gvFiles").on("click",".dato",function(e){e.preventDefault();var t=$(".btn-header.success").attr("data-tipo"),a=$(this).find("input:checkbox");$(this).hasClass("selected")?($(this).removeClass("selected"),a.removeAttr("checked"),0==$("#gvFiles .dato.selected").length?$("#btnClearSelect, #btnInsertFiles, #btnAttachFiles").addClass("oculto"):1==$("#gvFiles .dato.selected").length&&($("#btnClearSelect, #btnAttachFiles").removeClass("oculto"),"media"==t&&$("#btnInsertFiles").removeClass("oculto"))):($(this).addClass("selected"),a.attr("checked",""),$("#btnClearSelect, #btnAttachFiles").removeClass("oculto"),"media"==t&&$("#btnInsertFiles").removeClass("oculto"))}),$(".btn-header").on("click",function(e){e.preventDefault();var t=document.getElementById("hdUsuario").value,a=this.getAttribute("data-tipo");$(this).siblings(".success").removeClass("success"),$(this).addClass("success"),"media"==a&&$("#btnInsertFiles").addClass("oculto"),document.getElementById("ifrFiles").setAttribute("src","?pag=uploader&folder="+t+"&tipo="+a),ListarArchivos(t,a)}),$("#btnShowFiles").on("click",function(e){e.preventDefault(),$("#pnlFiles").fadeIn(400,function(){var e=$(".btn-header.success");e.trigger("click")})}),$("#btnHideFiles").on("click",function(e){e.preventDefault(),$("#pnlFiles").fadeOut(400,function(){})}),$("#btnClearSelect").on("click",function(e){e.preventDefault(),$("#btnClearSelect, #btnInsertFiles, #btnAttachFiles").addClass("oculto"),$("#gvFiles .tile.selected").removeClass("selected"),$("#gvFiles input:checkbox:checked").removeAttr("checked")}),$("#btnInsertFiles").click(function(e){e.preventDefault(),InsertarImagenes()}),$("#btnAttachFiles").on("click",function(e){e.preventDefault(),AdjuntarArchivos()}),$("#attach-files").on("click","a",function(e){e.preventDefault();var t=this.getAttribute("data-action");"delete"==t&&$(this).parent().fadeOut(400,function(){this.remove(),0==$("#attach-files .file-attach").length&&$("#attach-files").html("No se han adjuntado archivos")})}),$("#btnEnviarEmail").on("click",function(e){e.preventDefault(),EnviarEmail()})});