function LimpiarForm_SaldoInicial(){$("#hdIdPrimary").val("0"),$("#txtSaldoInicial").val("").focus()}function GoToEdit_SaldoInicial(){openModalCallBack("#modalLiquidacion",function(){var e=new Date,a=e.getFullYear();ListarAnhoProceso_liquidacion(a)})}function createFrame(e,a){precargaExp("body",!0);var o=$("#hdIdProyecto").val(),t=$("#lblProceso").attr("data-anho"),r=$("#lblProceso").attr("data-mes"),i=$("#lblProceso").attr("data-estado");window.top.idproyecto=o,window.top.anho=t,window.top.mes=r,window.top.escobrodiferenciado=escobrodiferenciado,window.top.idbanco=idbanco,window.top.idcuentabancaria=idcuentabancaria,window.top.estadoproceso=i;var n;if(0==$(e+" .tab-pane.active iframe").length){var d=a.getAttribute("href"),c=a.getAttribute("data-url"),l=document.getElementById(d.substr(1));n=document.createElement("iframe"),c=c+"&idproyecto="+o,c=c+"&anho="+t,c=c+"&mes="+r,c=c+"&escobrodiferenciado="+escobrodiferenciado,c=c+"&idbanco="+idbanco,c=c+"&idcuentabancaria="+idcuentabancaria,c=c+"&estadoproceso="+i,n.setAttribute("scrolling","no"),n.setAttribute("marginwidth","0"),n.setAttribute("marginheight","0"),n.setAttribute("width","100%"),n.setAttribute("height","100%"),n.setAttribute("frameborder","no"),n.setAttribute("src",c),n.onload=function(e){var a=this.document||this.contentWindow;a.Cambiar_DatosProyecto_Work(o,t,r),precargaExp("body",!1)},l.appendChild(n)}else{n=$(e+" .tab-pane.active iframe")[0];var s=n.document||n.contentWindow;console.log("fuck"),s.Cambiar_DatosProyecto_Work(o,t,r),precargaExp("body",!1)}}function ListarAnhoProceso(){$.ajax({url:"services/proceso/proceso-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"ANHO",idproyecto:"0"},success:function(e){var a=0,o="",t=e.length;if(t>0)for(;a<t;)o+='<option value="'+e[a].per_ano+'">'+e[a].per_ano+"</option>",++a;else o='<option value="0">NO HAY PROCESOS VIGENTES</option>';$("#ddlAnho").html(o)},error:function(e){console.log(e)}})}function ListarAnhoProceso_liquidacion(e){$.ajax({url:"services/proceso/proceso-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"ANHO",idproyecto:$("#hdIdProyecto").val()},success:function(a){var o=0,t=0,r="",i="";if(t=a.length,t>0)for(;o<t;)i=e==a[o].per_ano?' selected="selected"':"",r+="<option"+i+' value="'+a[o].per_ano+'">'+a[o].per_ano+"</option>",++o;else r+='<option value="0">NO HAY PROCESOS RELACIONADOS CON EL PROYECTO SELECCIONADO</option>';$("#ddlAnho_Liquidacion").html(r)},error:function(e){console.log(e)}})}function ListarProyectos(e){var a="#gvDatos";precargaExp("#gvDatos",!0),$.ajax({type:"GET",url:"services/condominio/condominio-search.php",cache:!1,dataType:"json",data:"criterio="+$("#txtSearch").val()+"&pagina="+e,success:function(o){var t=0,r="",i=o.length;if(i>0){for(;t<i;){var n=o[t].idproyecto;r+="<div",r+=' data-id="'+n+'"',r+=' data-idproyecto="'+n+'"',r+=' data-codigo="'+o[t].codigoproyecto+'"',r+=' data-nombre="'+o[t].nombreproyecto+'"',r+=' data-tipoproyecto="'+o[t].tipoproyecto+'"',r+=' data-datosimpleduplex="'+o[t].datosimpleduplex+'"',r+=' data-tipovaloracion="'+o[t].tipovaloracion+'"',r+=' data-tipoproyecto="'+o[t].tipoproyecto+'"',r+=' data-datosimpleduplex="'+o[t].datosimpleduplex+'"',r+=' data-tipovaloracion="'+o[t].tipovaloracion+'"',r+=' data-escobrodiferenciado="'+o[t].escobrodiferenciado+'"',r+=' data-idbanco="'+o[t].idbanco+'"',r+=' data-idcuentabancaria="'+o[t].idcuentabancaria+'"',r+=' class="dato result item pos-rel animate mdl-shadow--2dp margin10 full-size">',r+='<div class="col-md-4">',r+="<h4>ID Proyecto #"+n+"</h4>",r+='<p class="descripcion"><strong>'+o[t].codigoproyecto+" - "+o[t].nombreproyecto+"</strong></p>",r+='<p class="lugar"><strong>Direcci&oacute;n: </strong>'+o[t].direccionproyecto.length==0?"Sin direcci&oacute;n espec&iacute;fica":o[t].direccionproyecto+"</p>",r+="</div>",r+='<div class="col-md-4">',r+="<h4>Tipo de proyecto:</h4>",r+='<span class="duracion">'+o[t].ubigeo+"</span>",r+="</div>",r+='<div class="col-md-4">',r+='<div class="grouped-buttons no-margin pos-rel">',r+='<a data-action="more" href="#" class="btn btn-primary right margin10">Opciones</a>',r+='<ul class="dropdown-list">',r+='<li><a href="#" data-action="edit">Editar</a></li>',r+='<li><a href="#" data-action="more-info">M&aacute;s informaci&oacute;n</a></li>',r+='<li role="separator" class="divider"></li>',r+='<li><a href="#" data-action="delete">Eliminar</a></li>',r+="</ul>",r+="</div>",r+='<div class="clear"></div>',r+="</div>",r+="</div>",++t}paginaProyecto+=1,$("#hdPageProyecto").val(paginaProyecto),"1"==e?$(a).html(r):$(a).append(r)}else"1"==e&&$(a).html("<h2>No hay datos.</h2>");precargaExp("#gvDatos",!1)}})}function ListarPropiedades(e){var a="#gvPropiedad .items-area";precargaExp("#gvPropiedad",!0),$.ajax({type:"GET",url:"services/propiedad/propiedad-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",id:$("#hdIdProyecto").val(),idtipopropiedad:$("#ddlTipoPropiedadFiltro").val(),criterio:$("#txtSearchPropiedad").val(),pagina:e},success:function(o){var t=0,r=0,i="",n="",d="",c="",l="",s="",p="",u="",m="";$("#hdTipoValoracion").val();if(r=o.length,r>0){for(;t<r;)d=o[t].idpropiedad,c=o[t].idtipopropiedad,null!=o[t].numerodoc&&(s=0==o[t].numerodoc.trim().length?"":o[t].numerodoc+" "),p=null!=o[t].descrippersona?0==o[t].descrippersona.trim().length?"(EN BLANCO)":o[t].descrippersona:"(EN BLANCO)","DPT"==c?n=" blue-grey lighten-2":"DEP"==c?n=" grey darken-1":"EST"==c?n=" blue-grey":"TIE"==c&&(n=" blue-grey darken-1"),l=Number(o[t].area)>0?"bg-dark":"bg-darkRed","0"==o[t].cantidadrelaciones?0==o[t].propiedadpadre.length?(u="SIN PROPIEDADES RELACIONADAS",m=" bg-gray"):(u=o[t].propiedadpadre,m=" light-blue darken-4"):(u="VER PROPIEDADES RELACIONADAS",m=" light-blue darken-4"),i+='<div class="tile dato double almost-double-vertical shadow '+n+'" ',i+='data-idpropiedad="'+d+'" ',i+='data-idtipopropiedad="'+c+'" ',i+='data-descripcion="'+o[t].descripcionpropiedad+'" ',i+='data-areasintechar="'+o[t].areasintechar+'" ',i+='data-areatechada="'+o[t].areatechada+'" ',i+='data-area="'+o[t].area+'" ',i+='data-idclasepropiedad="'+o[t].idclasepropiedad+'" ',i+='data-idpropietario="'+o[t].idpersona+'" ',i+='data-relaciones="'+o[t].cantidadrelaciones+'" ',i+='title="'+s+p+'">',i+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+d+'" />',i+='<div class="place-top-left">',i+='<h5 class="fg-white">'+o[t].torre+"</h5>",i+="</div>",i+='<div class="inputInItem padding20 bg-white shadow row hide">',i+='<div class="grid fluid"><div class="row">',i+='<div class="span6">',i+='<div class="inputSaldoInicial">',i+='<label class="black-text">Saldo Inicial</label>',i+='<div class="input-control text no-margin" data-role="input-control">',i+='<input type="text" class="fg-black input-saldoinicial" value="'+o[t].saldoinicial+'" />',i+='<button class="btn-clear" tabindex="-1" type="button"></button>',i+="</div>",i+="</div>",i+="</div>",i+='<div class="span6">',i+='<div class="inputRatio hide">',i+='<label class="black-text">Ratio</label>',i+='<div class="input-control text no-margin" data-role="input-control">',i+='<input type="text" class="fg-black input-ratio" value="'+o[t].ratio+'" />',i+='<button class="btn-clear" tabindex="-1" type="button"></button>',i+="</div>",i+="</div>",i+='<div class="inputImporteFijo hide">',i+='<label class="black-text">Importe Fijo</label>',i+='<div class="input-control text no-margin" data-role="input-control">',i+='<input type="text" class="fg-black input-importefijo" value="'+o[t].importefijo+'" />',i+='<button class="btn-clear" tabindex="-1" type="button"></button>',i+="</div>",i+="</div>",i+="</div>",i+="</div></div>",i+="</div>",i+='<div class="tile_true_content">',i+='<div class="tile-content">',i+='<div class="text-right padding10 ntp">',i+='<h3 class="white-text">'+o[t].descripcionpropiedad+"</h3>",i+='<h6 class="padding5 text-ellipsis smaller bg-white text-center fg-dark">'+p+"</h6>",i+='<h6 class="link-relacion padding5 smaller text-center fg-white'+m+'">'+u+"</h6>",i+="</div>",i+="</div>",i+='<div class="brand"><span class="badge '+l+'">Area: '+o[t].area+" (m<sup>2</sup>)</span></div>",i+="</div>",i+="</div>",++t;paginaPropiedad+=1,$("#hdPagePropiedad").val(paginaPropiedad),1==e?$(a).html(i):$(a).append(i)}else 1==e&&$(a).html("<h2>No se encontraron resultados.</h2>");precargaExp("#gvPropiedad",!1)}})}function ListarPropiedades_Orden(e){var a="#gvPropiedadOrden .ui-sortable";precargaExp("#gvPropiedadOrden",!0),$.ajax({type:"GET",url:"services/propiedad/propiedad-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",id:$("#hdIdProyecto").val(),idtipopropiedad:"*",criterio:$("#txtSearchPropiedad").val(),pagina:e},success:function(o){var t=0,r="",i="",n="",d="",c="",l="",s="",p=($("#hdTipoValoracion").val(),o.length);if(p>0){for(;t<p;){var u=o[t].idpropiedad,m=o[t].idtipopropiedad;null!=o[t].numerodoc&&(d=0==o[t].numerodoc.trim().length?"":o[t].numerodoc+" "),c=null!=o[t].descrippersona?0==o[t].descrippersona.trim().length?"(EN BLANCO)":o[t].descrippersona:"(EN BLANCO)","DPT"==m?i=" blue-grey lighten-2":"DEP"==m?i=" grey darken-1":"EST"==m?i=" blue-grey":"TIE"==m&&(i=" blue-grey darken-1"),n=Number(o[t].area)>0?"bg-dark":"bg-darkRed","0"==o[t].cantidadrelaciones?0==o[t].propiedadpadre.length?(l="SIN PROPIEDADES RELACIONADAS",s=" bg-gray"):(l=o[t].propiedadpadre,s=" light-blue darken-4"):(l="VER PROPIEDADES RELACIONADAS",s=" light-blue darken-4"),r+="<a ",r+='data-idpropiedad="'+u+'" ',r+='data-idtipopropiedad="'+m+'" ',r+='data-descripcion="'+o[t].descripcionpropiedad+'" ',r+='data-areasintechar="'+o[t].areasintechar+'" ',r+='data-areatechada="'+o[t].areatechada+'" ',r+='data-area="'+o[t].area+'" ',r+='data-idclasepropiedad="'+o[t].idclasepropiedad+'" ',r+='data-idpropietario="'+o[t].idpersona+'" ',r+='data-relaciones="'+o[t].cantidadrelaciones+'" ',r+='title="'+d+c+'" ',r+='href="#" class="list'+i+'">',r+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+u+'" />',r+='<div class="list-content">'+o[t].descripcionpropiedad+"</div></a>",++t}paginaPropiedad+=1,$("#hdPagePropiedad__Orden").val(paginaPropiedad),1==e?$(a).html(r):$(a).append(r),$(a).sortable({start:function(e,a){var o=a.item.index();a.item.data("start_pos",o)},update:function(e,a){var o=a.item.data("start_pos"),t=a.item.index();alert(o+" - "+t)}}),$(a).disableSelection(),$("#gvPropiedadOrden").on("scroll",".listview",function(){var e=0;$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&(e=Number($("#hdPagePropiedad__Orden").val()),ListarPropiedades_Orden(e))})}else 1==e&&$(a).html("<h2>No se encontraron resultados.</h2>");precargaExp("#gvPropiedadOrden",!1)}})}function ListarPropietarios(e){var a="#gvPropietario .items-area";precargaExp("#gvPropietario",!0),$.ajax({type:"GET",url:"services/propietario/propietario-search.php",cache:!1,dataType:"json",data:"criterio="+encodeURIComponent($("#txtSearchPropietario").val())+"&pagina="+e,success:function(o){var t=0,r=o.length,i="";if(r>0){for(;t<r;)iditem=o[t].tm_idtipopropietario,foto=o[t].tm_foto,i+='<a href="#" class="list dato bg-gray-glass bg-cyan" data-idpropietario="'+iditem+'" data-tipopropietario="'+o[t].tm_iditc+'" data-tipopersona="00">',i+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+iditem+'" />',i+='<div class="list-content pos-rel">',i+='<span class="ubigeotag fg-white bg-darkCyan place-bottom-right padding5 margin5"style="z-index: 99;">UBIGEO: '+o[t].ubigeo+"</span>",i+='<div class="data">',i+="<aside>",i+="no-set"==foto?'<i class="fa fa-user"></i>':'<img src="'+foto+'" />',i+="</aside>",i+='<main><p class="fg-white"><span class="descripcion">'+o[t].descripcion+'</span></p><p class="fg-white">Tel&eacute;fono: '+o[t].tm_telefono+' - Direcci&oacute;n: <span class="direccion">'+o[t].tm_direccion+'</span><br /><span class="docidentidad">'+o[t].tipodoc+": "+o[t].tm_numerodoc+"</span> - Email: "+o[t].tm_email+"</p>",i+="</main>",i+='<div class="progress-bar small" data-role="progress-bar" data-value="0"></div>',i+="</div></div>",i+="</a>",++t;paginaPropietario+=1,$("#hdPagePropietario").val(paginaPropietario),"1"==e?$(a).html(i):$(a).append(i)}else"1"==e&&$(a).html("<h2>No hay datos.</h2>");precargaExp("#gvPropietario",!1)}})}function ListarInquilinos(e){var a="#gvInquilino .items-area";precargaExp("#gvInquilino",!0),$.ajax({type:"GET",url:"services/inquilino/inquilino-search.php",cache:!1,dataType:"json",data:"criterio="+$("#txtSearchInquilino").val()+"&pagina="+e,success:function(o){var t=0,r=o.length,i="";if(r>0){for(;t<r;)iditem=o[t].tm_idtipoinquilino,foto=o[t].tm_foto,i+='<a href="#" class="list dato bg-gray-glass bg-cyan" data-idinquilino="'+iditem+'" data-tipoinquilino="'+o[t].tm_iditc+'" data-tipopersona="01">',i+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+iditem+'" />',i+='<div class="list-content pos-rel">',i+='<span class="ubigeotag fg-white bg-darkCyan place-top-right padding5 margin5">UBIGEO: '+o[t].ubigeo+"</span>",i+='<div class="data">',i+="<aside>",i+="no-set"==foto?'<i class="fa fa-user"></i>':'<img src="'+foto+'" />',i+="</aside>",i+='<main><p class="fg-white"><span class="descripcion">'+o[t].descripcion+'</span></p><p class="fg-white">Tel&eacute;fono: '+o[t].tm_telefono+' - Direcci&oacute;n: <span class="direccion">'+o[t].tm_direccion+'</span><br /><span class="docidentidad">'+o[t].tipodoc+": "+o[t].tm_numerodoc+"</span> - Email: "+o[t].tm_email+"</p>",i+="</main>",i+='<div class="progress-bar small" data-role="progress-bar" data-value="0"></div>',i+="</div></div>",i+="</a>",++t;paginaInquilino+=1,$("#hdPageInquilino").val(paginaInquilino),"1"==e?$(a).html(i):$(a).append(i)}else"1"==e&&$(a).html("<h2>No hay datos.</h2>");precargaExp("#gvInquilino",!1)}})}function prepareImport(e){var a=["jpg","png","gif","jpeg"],o="",t="",r=new FileReader;return fileValue=e[0],t=e[0].name,o=t.split(".").pop().toLowerCase(),$.inArray(o,a)==-1?(MessageBox("Archivo no v&aacute;lido","El tipo de archivo *."+o+" no es compatible","[Aceptar]",function(){}),!1):(r.readAsDataURL(fileValue),console.log(fileValue),void(r.onload=function(e){$(".droping-air .help").text(t),$(".droping-air").addClass("dropped"),$(".droping-air > .icon").css("background","url("+e.target.result+") no-repeat center"),$(".droping-air > .cancel").removeClass("oculto")}))}function cancelImport(){$("#fileImagen").val(""),$(".droping-air .help").text("Seleccione o arrastre un archivo de imagen (*.jpg, .gif, *.png)"),$(".droping-air").removeClass("dropped"),$(".droping-air > .icon").css("background","transparent"),$(".droping-air > .cancel").addClass("oculto"),$("#hdFoto").val("no-set"),fileValue=!1}function CalcularArea(){var e=0,a=0,o=0;e=Number(document.getElementById("txtAreaTechada").value),a=Number(document.getElementById("txtAreaSinTechar").value),o=e+a,document.getElementById("txtAreaPropiedad").value=o.toFixed(2)}function AsignarPropiedades(){indexList=0,elemsSelected=$("#pnlPropietarioInquilino .list.selected").toArray(),EnvioDataAsignacion(elemsSelected[0])}function EnvioDataAsignacion(e){var a="",o=new FormData,t=$(e),r=t.find(".progress-bar"),i=r.progressbar({animate:!0}),n=t.attr("data-tipopersona");"00"==n?a=t.attr("data-idpropietario"):"01"==n&&(a=t.attr("data-idinquilino"));var d=$("#gvPropiedad .tile.selected"),c=$.map(d,function(e,a){return e.getAttribute("data-idpropiedad")}).join(",");o.append("btnAsignarPropiedades","btnAsignarPropiedades"),o.append("listpropiedades",c),o.append("hdTipoPersona",n),o.append("hdIdPersona",a),$.ajax({url:"services/propiedad/propiedad-post.php",type:"POST",dataType:"json",data:o,cache:!1,contentType:!1,processData:!1,success:function(e){++indexList,progressError=!1,i.progressbar("value",100),intervalProgress.isRunning()&&intervalProgress.stop(),indexList<=elemsSelected.length-1?EnvioDataAsignacion(elemsSelected[indexList]):(completado=!0,MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){"0"!=e.rpta&&(paginaPropiedad=1,ListarPropiedades("1"),$("#btnHidePropietarioInquilino").trigger("click"))}))},beforeSend:function(){completado=!1,intervalProgress.start()},complete:function(){progress=0,progressError&&0==completado&&setTimeout(function(){intervalProgress.isRunning()&&intervalProgress.stop(),i.progressbar("value",100),EnvioDataAsignacion(elemsSelected[indexList])},1e4)},error:function(e){progress=0,progressError=!0,console.log(e)}})}function MostrarRowPorcentajeDuplex(e){e?$("#rowPorcentajeDuplex").show():($("#chkPorcjDuplex")[0].checked=!1,$("#rowPorcentajeDuplex").hide(),$("#rowPorcjDuplex").hide(),$("#rowChkPorcjDuplex").removeClass("span8").addClass("span12"),$("#txtPorcjDuplex").val("0"))}function MostrarPorcjDuplex(e){e?($("#rowPorcjDuplex").show(),$("#rowChkPorcjDuplex").removeClass("span12").addClass("span8"),$("#txtPorcjDuplex").val("50").focus()):($("#rowPorcjDuplex").hide(),$("#rowChkPorcjDuplex").removeClass("span8").addClass("span12"),$("#txtPorcjDuplex").val("0"))}function EliminarProyecto(){xzzxxxz,indexList=0,elemsSelected=$("#gvDatos .selected").toArray(),EliminarItemProyecto(elemsSelected[0])}function EliminarItemProyecto(e){var a=new FormData,o="0";o=e.getAttribute("data-idproyecto"),a.append("btnEliminarItem","btnEliminarItem"),a.append("hdIdProyecto",o),$.ajax({url:"services/condominio/condominio-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){var t,r,i=0,n="",d=0;r=$(e),d=r.height(),"0"==a.rpta?(n="El proyecto "+o+": "+r.find(".descripcion").text(),"ERROR-PROPIEDAD"==a.contenidomsje&&(n+=" tiene propiedades relacionadas."),MessageBox(a.titulomsje,n,"[Aceptar]",function(){})):(++indexList,t=$("#gvDatos .listview"),i=t.scrollTop(),r.fadeOut(400,function(){$(this).remove()}),indexList<=elemsSelected.length-1?(i+=d+18,t.animate({scrollTop:i},400,function(){EliminarItemProyecto(elemsSelected[indexList])})):MessageBox(a.titulomsje,a.contenidomsje,"[Aceptar]",function(){$("#btnLimpiarSeleccion").trigger("click")}))},error:function(e){console.log(e)}})}function GenerarFacturacion(){indexList=0,elemsSelected=$("#gvDatos .selected").toArray(),GenerarFacturacionProyecto(elemsSelected[0])}function GenerarFacturacionProyecto(e){var a=e.getAttribute("data-idproyecto"),o=$(e),t=o.find(".progress-bar"),r=t.progressbar({animate:!0}),i=new FormData;i.append("btnGenerar","btnGenerar"),i.append("hdIdProyecto",a),i.append("ddlAnho",$("#ddlAnho").val()),i.append("ddlMes",$("#ddlMes").val()),i.append("txtFechaVencimiento",$("#txtFechaVencimiento").val()),i.append("txtFechaTope",$("#txtFechaTope").val()),$.ajax({url:"services/facturacion/facturacion-post.php",type:"POST",dataType:"json",data:i,cache:!1,contentType:!1,processData:!1,success:function(e){var a=$("#gvPropiedadSelected .listview"),t=a.scrollTop();++indexList,progressError=!1,r.progressbar("value",100),intervalProgress.isRunning()&&intervalProgress.stop(),indexList<=elemsSelected.length-1?(t+=o.height()+18,a.animate({scrollTop:t},400,function(){GenerarFacturacionProyecto(elemsSelected[indexList])})):(completado=!0,MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){$("#btnLimpiarSeleccion").trigger("click"),paginaProyecto=1,ListarProyectos("1")}))},beforeSend:function(){closeCustomModal("#modalGenFacturacion"),$("#gvDatos .dato.selected .progress-bar").removeClass("hide"),intervalProgress.start()},complete:function(){progress=0,progressError&&0==completado&&setTimeout(function(){intervalProgress.isRunning()&&intervalProgress.stop(),r.progressbar("value",100),GenerarFacturacionProyecto(elemsSelected[indexList])},1e4)},error:function(e){progress=0,progressError=!0,console.log(e)}})}function EliminarPropiedad(){indexList=0,elemsSelected=$("#gvPropiedad .selected").toArray(),EliminarItemPropiedad(elemsSelected[0])}function EliminarItemPropiedad(e){var a=new FormData,o="0";o=e.getAttribute("data-idpropiedad"),a.append("btnEliminarPropiedad","btnEliminarPropiedad"),a.append("hdIdPropiedad",o),$.ajax({url:"services/condominio/condominio-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){var t,r,i=0,n="",d=0;r=$(e),d=r.height(),"0"==a.rpta?(n="La propiedad "+o+": "+r.find(".descripcion").text(),"ERROR-PROPIEDAD"==a.contenidomsje&&(n+=" tiene propiedades relacionadas."),MessageBox(a.titulomsje,n,"[Aceptar]",function(){})):(++indexList,t=$("#gvPropiedad .listview"),i=t.scrollTop(),r.fadeOut(400,function(){$(this).remove()}),indexList<=elemsSelected.length-1?(i+=d+18,t.animate({scrollTop:i},400,function(){EliminarItemPropiedad(elemsSelected[indexList])})):MessageBox(a.titulomsje,a.contenidomsje,"[Aceptar]",function(){$("#btnClearSelPropiedades").trigger("click")}))},error:function(e){console.log(e)}})}function RomperRelaciones(){var e,a=new FormData;confirma=confirm("¿Desea romper las relaciones de las propiedades seleccionadas?"),confirma&&(e=$("#gvPropiedad input:checkbox:checked").serializeArray(),a.append("btnBreakRelacion","btnBreakRelacion"),$.each(e,function(e,o){a.append(o.name,o.value)}),$.ajax({url:"services/condominio/condominio-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(e){MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){$("#btnClearSelPropiedades").trigger("click"),paginaPropiedad=1,ListarPropiedades("1")})},error:function(e){console.log(e)}}))}function RelacionarDepartamento(){indexList=0,elemsSelected=$("#gvPropiedad .selected").toArray(),RelacionarItemDepartamento(elemsSelected[0])}function RelacionarItemDepartamento(e){var a=new FormData,o="0",t="0";o=$("#gvDepartamento .tile.selected").attr("data-idpropiedad"),t=e.getAttribute("data-idpropiedad"),a.append("btnRelacionar","btnRelacionar"),a.append("hdIdDepartamento",o),a.append("hdIdPropiedad",t),$.ajax({url:"services/condominio/condominio-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){var o,r="";o=$(e),"0"==a.rpta?(r="La propiedad "+t+": "+o.find(".descripcion").text(),"ERROR-PROPIEDAD"==a.contenidomsje&&(r+=" tiene departamentos relacionados."),MessageBox(a.titulomsje,r,"[Aceptar]",function(){})):(++indexList,indexList<=elemsSelected.length-1?RelacionarItemDepartamento(elemsSelected[indexList]):MessageBox(a.titulomsje,a.contenidomsje,"[Aceptar]",function(){$("#btnHideDepartamento").trigger("click"),paginaPropiedad=1,ListarPropiedades("1")}))},error:function(e){console.log(e)}})}function CopiarPropiedades(e,a,o,t){var r=0,i="",n="0",d="0",c="0",l="",s="",p=0;if(r=a,s=$("#ddlTipoPropiedad").val(),"NEW"==e?(d=s,p=parseInt(o.val())+1):"EDIT"==e&&(p=o.length),p>0)for(;r<p;)"NEW"==e?(l=s+r.toString(),c=$("#txtAreaPropiedad").val()):"EDIT"==e&&(n=o[r].getAttribute("data-idpropiedad"),d=o[r].getAttribute("data-idtipopropiedad"),c=o[r].getAttribute("data-area"),l=o[r].getAttribute("data-descripcion")),i+='<div href="#" class="list dato bg-gray-glass" data-idpropiedad="'+n+'" data-idtipopropiedad="'+d+'">',i+='<div class="list-content pos-rel">',i+='<span class="ubigeotag fg-white bg-darker place-top-right padding5 margin5">Area: '+c+" (m<sup>2</sup>)</span>",i+='<div class="data">',i+='<main style="max-width: 300px;">',i+='<div class="row">',i+='<div class="input-control text no-margin" data-role="input-control">',i+='<input type="text" class="input-descripcion" value="'+l+'" />',i+='<button class="btn-clear" tabindex="-1" type="button"></button>',i+="</div>",i+="</div>",i+='<div class="row">',i+="<label>Saldo Inicial</label>",i+='<div class="input-control text no-margin" data-role="input-control">',i+='<input type="text" class="input-saldoinicial" value="0" />',i+='<button class="btn-clear" tabindex="-1" type="button"></button>',i+="</div>",i+="</div>","02"==$("#hdTipoValoracion").val()?(i+='<div class="row">',i+="<label>Ratio</label>",i+='<div class="input-control text no-margin" data-role="input-control">',i+='<input type="text" class="input-ratio" value="0" />',i+='<button class="btn-clear" tabindex="-1" type="button"></button>',i+="</div>",i+="</div>"):"03"==$("#hdTipoValoracion").val()&&(i+='<div class="row">',i+="<label>Importe fijo</label>",i+='<div class="input-control text no-margin" data-role="input-control">',i+='<input type="text" class="input-importefijo" value="0" />',i+='<button class="btn-clear" tabindex="-1" type="button"></button>',i+="</div>",i+="</div>"),i+="</main>",i+='<progress class="progress-bar small" data-role="progress-bar" data-value="0"></progress>',i+="</div></div>",i+="</div>",++r;$("#gvPropiedadSelected .items-area").html(i),t()}function DetalleConcepto(e,a,o){this.codigoconcepto=e,this.valorconcepto=a,this.tiporesultado=o}function EditMassrPropiedad(){return 0==$("#txtAreaPropiedad").val().trim().length?(MessageBox("Valores no v&aacute;lidos","Area de propiedades deben tener algun valor","[Aceptar]",function(){}),!1):0==Number($("#txtAreaPropiedad").val())?(MessageBox("Valores no v&aacute;lidos","Area de propiedades deben ser mayores a cero","[Aceptar]",function(){}),!1):(indexList=0,elemsSelected=$("#gvPropiedadSelected .list").toArray(),void EnvioDataEditPropiedad(elemsSelected[0]))}function ExtraerDetalleConcepto(e){var a,o,t=0,r=0,i="",n="",d="",c=[],l="";if(d="00"==e?"#tableConcepto":"#tableConceptoFormula",a=$(d+" .ibody table"),o=a[0],r=o.rows.length,r>0){for(;t<r;){i=o.rows[t].getAttribute("data-idconcepto"),n="00"==e?o.rows[t].cells[1].childNodes[0].value:o.rows[t].cells[1].childNodes[0].innerText;var s=new DetalleConcepto(i,n,e);c.push(s),++t}l=JSON.stringify(c)}return l}function EnvioDataEditPropiedad(e){var a=new FormData,o="0",t="0",r=e.getAttribute("data-idpropiedad"),i=e.getAttribute("data-idtipopropiedad"),n=$(e),d=n.find(".input-descripcion").val(),c=n.find(".input-saldoinicial").val();"02"==$("#hdTipoValoracion").val()?o=n.find(".input-ratio").val():"03"==$("#hdTipoValoracion").val()&&(t=n.find(".input-importefijo").val());var l=n.find(".progress-bar"),s=l.progressbar({animate:!0}),p=$("#modalGenPropiedad :input").serializeArray();$.each(p,function(e,o){a.append(o.name,o.value)}),a.append("btnPropiedadMasiva","btnPropiedadMasiva"),a.append("hdIdProyecto",$("#hdIdProyecto").val()),a.append("hdIdPropiedad",r),a.append("ddlTipoPropiedad",i),a.append("txtNombrePropiedad",d),a.append("txtRatioPropiedad",o),a.append("txtImporteFijoPropiedad",t),a.append("txtSaldoInicial",c),a.append("chkIngresoTorre",1==$("#chkIngresoTorre")[0].checked?"1":"0"),a.append("hdIdTorre",$("#hdIdTorre").val()),a.append("txtIngresoTorre",$("#txtIngresoTorre").val()),a.append("txtNroSuministro",$("#txtNroSuministro").val()),a.append("txtAreaSinTechar",$("#txtAreaSinTechar").val()),a.append("txtAreaTechada",$("#txtAreaTechada").val()),a.append("txtAreaPropiedad",$("#txtAreaPropiedad").val()),$.ajax({url:"services/condominio/condominio-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(e){var a=$("#gvPropiedadSelected .listview"),o=a.scrollTop();++indexList,progressError=!1,s.progressbar("value",100),intervalProgress.isRunning()&&intervalProgress.stop(),indexList<=elemsSelected.length-1?(o+=n.height()+18,a.animate({scrollTop:o},400,function(){EnvioDataEditPropiedad(elemsSelected[indexList])})):(completado=!0,MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){"0"!=e.rpta&&(paginaPropiedad=1,closeCustomModal("#modalGenPropiedad"),ListarPropiedades("1"))}))},beforeSend:function(){intervalProgress.start()},complete:function(){progress=0,progressError&&0==completado&&setTimeout(function(){intervalProgress.isRunning()&&intervalProgress.stop(),s.progressbar("value",100),EnvioDataEditPropiedad(elemsSelected[indexList])},1e4)},error:function(e){progress=0,progressError=!0,console.log(e)}})}function ListarTorres(){$.ajax({url:"services/torre/torre-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"2",id:$("#hdIdProyecto").val()}}).done(function(e){var a=0,o=0,t="";if(o=e.length,o>0)for(;a<o;)t+='<div data-idtorre="'+e[a].idtorre+'" title="'+e[a].descripciontorre+'" class="panel-info without-foto">',t+='<div class="info">',t+='<h3 class="descripcion">'+e[a].descripciontorre+"</h3>",t+="</div>",t+="</div>",++a;else t="<h2>No hay datos.</h2>";$("#gvTorre").html(t)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}function EvalConcepto(){var tableConcepto,tableConceptoFormula,itemsConcepto,itemsFormula,codigoconcepto="",valor="",formula="",i=0,j=0,countdata_concepto=0,countdata_formula=0,nrodecimales_concepto=0,nrodecimales_formula=0,nrocaracteres_formula="",resultformula;if(itemsConcepto=$("#tableConcepto .ibody table"),tableConcepto=itemsConcepto[0],itemsFormula=$("#tableConceptoFormula .ibody table"),tableConceptoFormula=itemsFormula[0],countdata_concepto=tableConcepto.rows.length,countdata_formula=tableConceptoFormula.rows.length,countdata_formula>0)for(;i<countdata_formula;){if(formula=tableConceptoFormula.rows[i].getAttribute("data-formula"),j=0,nrocaracteres_formula=Number(tableConceptoFormula.rows[i].getAttribute("data-nrocaracteres")),nrodecimales_formula=Number(tableConceptoFormula.rows[i].getAttribute("data-nrodecimales")),countdata_concepto>0)for(;j<countdata_concepto;)codigoconcepto=tableConcepto.rows[j].getAttribute("data-idconcepto"),valor=tableConcepto.rows[j].cells[1].childNodes[0].value,nrodecimales_concepto=Number(tableConcepto.rows[j].getAttribute("data-nrodecimales")),"01"==tableConcepto.rows[j].getAttribute("data-tipovalor")&&(valor=nrodecimales_concepto>0?"Number("+Number(valor).toFixed(nrodecimales_concepto)+")":"Number("+valor+")"),formula=formula.replace("["+codigoconcepto+"]",valor),++j;try{resultformula=eval(formula)}catch(err){console.log(err.message)}"01"==tableConceptoFormula.rows[i].getAttribute("data-tipovalor")?nrodecimales_formula>0&&(resultformula=Number(resultformula).toFixed(nrodecimales_formula)):resultformula=resultformula.toString().substring(0,nrocaracteres_formula),tableConceptoFormula.rows[i].cells[1].childNodes[0].innerText=resultformula,++i}}function ListarConceptos(e,a,o,t){precargaExp("#modalConcepto .modal-example-body",!0),$.ajax({url:"services/concepto/concepto-search.php",type:"GET",dataType:"json",data:{tipo:e,tipoconcepto:a,subtipoconcepto:o,idproyecto:$("#hdIdProyecto").val(),idpropiedad:t}}).done(function(e){var a=0,o=0,t="",r="",i="",n="",d=0,c=0,l="";if(o=e.length,precargaExp("#modalConcepto .modal-example-body",!1),o>0)for(;a<o;)strhtml="<tr ",strhtml+='data-idconcepto="'+e[a].tm_idconcepto+'" ',strhtml+='data-esformula="'+e[a].tm_esformula+'" ',strhtml+='data-formula="'+e[a].tm_definicion_formula+'" ',strhtml+='data-tipovalor="'+e[a].ta_tipovalor+'" ',strhtml+='data-nrocaracteres="'+e[a].tm_numerocaracteres+'" ',strhtml+='data-nrodecimales="'+e[a].tm_numerodecimales+'">',strhtml+='<td class="colConcepto">',strhtml+="<h4>"+e[a].tm_idconcepto+" - "+e[a].tm_descripcionconcepto+"</h4>",strhtml+="</td>",strhtml+='<td class="colValor">',d=Number(e[a].tm_numerodecimales),c=Number(e[a].td_valorconcepto),"00"==e[a].ta_tipovalor?(i="",n=' maxlength="'+e[a].tm_numerocaracteres+'"'):(i="0",n="",d>0&&(i+="."+"0".repeat(d))),l=c>0?c:i,"0"==e[a].tm_esformula?strhtml+='<input type="text" name="txtValorConcepto[]" class="inputTextInTable" value="'+l+'"'+n+" />":strhtml+="<h4>"+l+"</h4>",strhtml+="</td>",strhtml+="</tr>","0"==e[a].tm_esformula?t+=strhtml:r+=strhtml,++a;$("#tableConcepto tbody").html(t),$("#tableConceptoFormula tbody").html(r),EvalConcepto()}).fail(function(e){console.log(e)}).always(function(){console.log("complete")})}function GoToPropiedades(e){var a=$(e),o=(a.attr("data-idproyecto"),a.attr("data-nombre")),t=a.attr("data-tipoproyecto"),r=a.attr("data-tipovaloracion"),i=a.attr("data-datosimpleduplex");$("#hdTipoValoracion").val(r),$("#tituloProyecto").attr("data-hint",o).text(o),$("#chkIngresoTorre")[0].checked=!1,$("#rowIngreso").addClass("oculto"),"00"==t?($("#rowChkIngreso").removeClass("oculto"),$("#pnlInfoTorre").removeClass("oculto")):($("#rowChkIngreso").addClass("oculto"),$("#pnlInfoTorre").addClass("oculto")),"1"==i?($("#rowClasePropiedad").removeClass("oculto"),$("#ddlClasePropiedad")[0].selectedIndex=0):($("#rowClasePropiedad").addClass("oculto"),
$("#ddlClasePropiedad").val("02")),paginaPropiedad=1,$("#pnlListado").fadeOut(400,function(){$("#pnlListPropiedades").fadeIn(400,function(){ListarPropiedades("1")})})}function GetLastIndexPropiedad(){$.ajax({url:"services/propiedad/propiedad-lastindex.php",type:"GET",dataType:"json",data:{idtipopropiedad:$("#ddlTipoPropiedad").val(),idproyecto:$("#hdIdProyecto").val()}}).done(function(e){$("#txtNroInicial").val(e)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}function GuardarDatos(){$("#form1").submit()}function MostrarModalPorTab(){var e="";e=$("#tabDetalle .tabs li.active").attr("data-tab"),"Torre"==e?openCustomModal("#modalTorre"):"Departamento"==e?openCustomModal("#modalDepartamento"):"Estacionamiento"==e?openCustomModal("#modalEstacionamiento"):"Deposito"==e?openCustomModal("#modalDeposito"):"AreaComun"==e&&openCustomModal("#modalAreaComun")}function setConstructora(e,a){$("#hdIdConstructora").val(e),$("#pnlInfoConstructora").attr("data-idconstructora",e),$("#pnlInfoConstructora .info .descripcion").text(a),$("#pnlConstructora").fadeOut("400",function(){})}function setUbigeo(e,a){$("#pnlInfoUbigeo").attr("data-idubigeo",e),$("#pnlInfoUbigeo .info .descripcion").text(a),$("#hdIdLocalidad").val(e),closeCustomModal("#modalUbigeo")}function setTorre(e,a){$("#pnlInfoTorre").attr("data-idtorre",e),$("#pnlInfoTorre .info .descripcion").text(a),$("#hdIdTorre").val(e),closeCustomModal("#modalTorre")}function setArea(){var e="",a=$("#tableConceptoFormula tbody tr:last-child .colValor h4");e=Number(a.text()).toFixed(2),$("#txtAreaPropiedad").val(e),$("#pnlInfoArea").attr("data-editado","1"),$("#pnlInfoArea .info .descripcion").html("Area: "+e+" (m<sup>2</sup>)")}function unsetArea(){$("#txtAreaPropiedad").val("0.00"),$("#pnlInfoArea").attr("data-editado","0"),$("#pnlInfoArea .info .descripcion").html("Area: 0 (m<sup>2</sup>)")}function ListarConstructora(){$.ajax({url:"services/constructora/constructora-search.php",type:"GET",dataType:"json",data:{tipo:"BUSQUEDA",tipobusqueda:"1",criterio:$("#txtSearchConstructora").val()}}).done(function(e){var a=0,o=0,t="";if(o=e.length,o>0){for(;a<o;)t+='<div class="tile dato double bg-olive" data-idconstructora="'+e[a].idconstructora+'" data-nombre="'+e[a].nombreconstructora+'">',t+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+e[a].idconstructora+'" />',t+='<div class="tile_true_content">',t+='<div class="tile-content">',t+='<h3 class="text-center fg-white">'+e[a].nombreconstructora+"</h3>",t+="</div>",t+="</div>",t+="</div>",++a;$("#gvConstructora .items-area").html(t)}else $("#gvConstructora .items-area").html("<h2>No se encontraron resultados</h2>")}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}function ListarUbigeo(){precargaExp("#modalUbigeo .scrollbarra",!0),$.ajax({url:"services/ubigeo/ubigeo-autocomplete.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",criterio:$("#txtSearchUbigeo").val()}}).done(function(e){var a=0,o=0,t="";if(a=e.length,a>0)for(;o<a;)t+='<div data-idubigeo="'+e[o].tm_idubigeo+'" title="'+e[o].ubigeo+'" class="panel-info without-foto">',t+='<div class="info">',t+='<h3 class="descripcion">'+e[o].ubigeo+"</h3>",t+="</div>",t+="</div>",++o;else t="<h2>No hay datos.</h2>";$("#gvUbigeo").html(t),precargaExp("#modalUbigeo .scrollbarra",!1)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}function GoToEdit(e){precargaExp("#modalRegistroProyecto",!0),$("#hdIdProyecto").val(e),"0"!=e?$.ajax({url:"services/condominio/condominio-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"2",id:e},success:function(e){var a=0,o="",t=!1,r=!1,i="";precargaExp("#modalRegistroProyecto",!1),a=e.length,a>0&&(o=e[0].tipoproyecto,t="1"==e[0].datosimpleduplex,r="1"==e[0].tieneporcjduplex,i=e[0].logo,$("#hdIdProyecto").val(e[0].idproyecto),$("#ddlTipoProyecto").val(o),$("#ddlTipoValoracion").val(e[0].tipovaloracion),$("#txtCodigoProyecto").val(e[0].codigoproyecto),$("#txtNombreProyecto").val(e[0].nombreproyecto),$("#txtDireccion").val(e[0].direccionproyecto),$("#ddlBanco").val(e[0].idbanco),$("#txtDireccionPago").val(e[0].direccionpago),$("#txtEmailPago").val(e[0].emailpago),$("#chkCobroDiferenciado")[0].checked="1"==e[0].escobrodiferenciado,$("#chkDatoSimpleDuplex")[0].checked=t,$("#chkPorcjDuplex")[0].checked=r,ShowAskCobroTorre(),MostrarRowPorcentajeDuplex(t),MostrarPorcjDuplex(r),ListarCuentaBancaria(e[0].idcuentabancaria),"no-set"!=i&&($(".droping-air .help").text(i.substring(i.lastIndexOf("/")+1)),$(".droping-air").addClass("dropped"),$(".droping-air > .icon").css("background","url("+i+") no-repeat center"),$(".droping-air > .cancel").removeClass("oculto")),$("#hdFoto").val(i),setConstructora(e[0].idconstructora,e[0].constructora),setUbigeo(e[0].idlocalidad,e[0].ubigeo),$("#txtPorcjDuplex").val(Number(e[0].porcjduplex).toFixed(2)))},error:function(e){console.log(e)}}):precargaExp("#modalRegistroProyecto",!1),openModalCallBack("#modalRegistroProyecto",function(){ListarConceptos("PROYECTO","04","0","0")})}function ShowPanelConstructora(){$("#pnlConstructora").fadeIn(400,function(){ListarConstructora()})}function ListarDepartamentos(e){var a="#gvDepartamento .items-area";precargaExp("#gvDepartamento",!0),$.ajax({type:"GET",url:"services/propiedad/propiedad-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",id:$("#hdIdProyecto").val(),idtipopropiedad:"DPT",criterio:$("#txtSearchDepartamento").val(),pagina:e},success:function(o){var t=0,r=0,i="",n="",d="",c="",l="",s="",p="",u="",m="";if(r=o.length,r>0){for(;t<r;)d=o[t].idpropiedad,c=o[t].idtipopropiedad,null!=o[t].numerodoc&&(s=0==o[t].numerodoc.trim().length?"":o[t].numerodoc+" "),p=null!=o[t].descrippersona?0==o[t].descrippersona.trim().length?"(EN BLANCO)":o[t].descrippersona:"(EN BLANCO)","DPT"==c?n="bg-teal":"DEP"==c?n="bg-darkGreen":"EST"==c?n="bg-indigo":"TIE"==c&&(n="bg-orange"),l=Number(o[t].area)>0?"bg-dark":"bg-darkRed","0"==o[t].cantidadrelaciones?(u="SIN PROPIEDADES RELACIONADAS",m=" bg-gray"):(u="VER PROPIEDADES RELACIONADAS",m=" bg-green"),i+='<div class="tile dato double almost-double-vertical bg-gray-glass '+n+'" ',i+='data-idpropiedad="'+d+'" ',i+='data-idtipopropiedad="'+c+'" ',i+='data-descripcion="'+o[t].descripcionpropiedad+'" ',i+='data-areasintechar="'+o[t].areasintechar+'" ',i+='data-areatechada="'+o[t].areatechada+'" ',i+='data-area="'+o[t].area+'" ',i+='data-idclasepropiedad="'+o[t].idclasepropiedad+'" ',i+='data-idpropietario="'+o[t].idpersona+'" ',i+='data-relaciones="'+o[t].cantidadrelaciones+'" ',i+='title="'+s+p+'">',i+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+d+'" />',i+='<div class="tile_true_content">',i+='<div class="tile-content">',i+='<div class="text-right padding10 ntp">',i+='<h2 class="fg-dark">'+o[t].descripcionpropiedad+"</h2>",i+='<h6 class="padding5 text-ellipsis smaller bg-white text-center fg-dark">'+p+"</h6>",i+='<h6 class="padding5 smaller bg-white text-center fg-white'+m+'">'+u+"</h6>",i+="</div>",i+="</div>",i+='<div class="brand"><span class="badge '+l+'">Area: '+o[t].area+" (m<sup>2</sup>)</span></div>",i+="</div>",i+="</div>",++t;paginaPropiedad+=1,$("#hdPagePropiedad").val(paginaPropiedad),1==e?$(a).html(i):$(a).append(i)}else 1==e&&$(a).html("<h2>No se encontraron resultados.</h2>");precargaExp("#gvDepartamento",!1)}})}function ListarRelacionadas(e,a){var o="#gvRelaciones .items-area";precargaExp("#gvRelaciones",!0),$.ajax({type:"GET",url:"services/propiedad/propiedad-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"relacionadas",idproyecto:$("#hdIdProyecto").val(),id:e,criterio:$("#txtSearchRelacionadas").val(),pagina:a},success:function(e){var t=0,r=0,i="",n="",d="",c="",l="",s="",p="";if(r=e.length,r>0){for(;t<r;)d=e[t].idpropiedad,c=e[t].idtipopropiedad,s=0==e[t].numerodoc.trim().length?"":e[t].numerodoc+" ",p=0==e[t].descrippersona.trim().length?"(EN BLANCO)":e[t].descrippersona,"DPT"==c?n=" blue-grey lighten-2":"DEP"==c?n=" grey darken-1":"EST"==c?n=" blue-grey":"TIE"==c&&(n=" blue-grey darken-1"),l=Number(e[t].area)>0?"bg-dark":"bg-darkRed",i+='<div class="tile dato double '+n+'" ',i+='data-idpropiedad="'+d+'" ',i+='data-idtipopropiedad="'+c+'" ',i+='data-descripcion="'+e[t].descripcionpropiedad+'" ',i+='data-areasintechar="'+e[t].areasintechar+'" ',i+='data-areatechada="'+e[t].areatechada+'" ',i+='data-area="'+e[t].area+'" ',i+='data-idclasepropiedad="'+e[t].idclasepropiedad+'" ',i+='data-idpropietario="'+e[t].idpersona+'" ',i+='title="'+s+p+'">',i+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+d+'" />',i+='<div class="tile_true_content">',i+='<div class="tile-content">',i+='<div class="text-right padding10 ntp">',i+='<h2 class="fg-white">'+e[t].descripcionpropiedad+"</h2>",i+='<h6 class="padding5 text-ellipsis smaller bg-white text-center fg-dark">'+p+"</h6>",i+="</div>",i+="</div>",i+='<div class="brand"><span class="badge '+l+'">Area: '+e[t].area+" (m<sup>2</sup>)</span></div>",i+="</div>",i+="</div>",++t;paginaPropiedad+=1,$("#hdPagePropiedad").val(paginaPropiedad),1==a?$(o).html(i):$(o).append(i)}else 1==a&&$(o).html("<h2>No se encontraron resultados.</h2>");precargaExp("#gvRelaciones",!1)}})}function ShowPanelDepartamento(){$("#pnlDepartamento").fadeIn(400,function(){ListarDepartamentos("1")})}function ShowPanelRelacionadas(e){$("#pnlListPropiedades").fadeOut(400,function(){$("#pnlRelacionadas").fadeIn(400,function(){ListarRelacionadas(e,"1")})})}function ShowPanelPropietarioInquilino(){paginaPropietario=1,paginaInquilino=1,$("#pnlPropietarioInquilino").fadeIn(400,function(){ListarPropietarios("1"),ListarInquilinos("1")})}function FijarProyecto(){var e="0";e=$("#gvDatos .dato.selected").attr("data-idproyecto"),$.ajax({url:"services/condominio/condominio-post.php",type:"POST",dataType:"json",data:{btnFijarProyecto:"btnFijarProyecto",hdIdProyecto:e},success:function(e){MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){"0"!=e.rpta&&(paginaProyecto=1,clearOnlyListSelection(),ListarProyectos("1"),$("#btnNuevo, #btnUploadExcel").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnListPropiedades, #btnEditar, #btnFijarProyecto, #btnEliminar").addClass("oculto"))})},error:function(){hdIdProyecto}})}function EnvioAdminDatos(e){var a,o=new FormData;precargaExp("#modalRegistroProyecto",!0),a=$("#modalRegistroProyecto :input").serializeArray(),detalleConcepto=ExtraerDetalleConcepto("00"),o.append("btnGuardar","btnGuardar"),o.append("hdIdProyecto",$("#hdIdProyecto").val()),o.append("hdIdConstructora",$("#hdIdConstructora").val()),o.append("hdIdLocalidad",$("#hdIdLocalidad").val()),o.append("hdFoto",$("#hdFoto").val()),o.append("archivo",fileValue),$.each(a,function(e,a){o.append(a.name,a.value)}),o.append("detalleConcepto",detalleConcepto),$.ajax({type:"POST",url:"services/condominio/condominio-post.php",contentType:!1,processData:!1,cache:!1,dataType:"json",data:o,success:function(e){precargaExp("#modalRegistroProyecto",!1),MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){"0"!=e.rpta&&(paginaProyecto=1,clearOnlyListSelection(),ListarProyectos("1"),closeCustomModal("#modalRegistroProyecto"),$("#btnNuevo, #btnUploadExcel").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnListPropiedades, #btnEditar, #btnFijarProyecto, #btnEliminar").addClass("oculto"))})},error:function(e){console.log(e)}})}function GoToEditPropiedad(){var e,a="0",o="0",t=0,r="0",i="0",n="0",d="";e=$("#gvPropiedad .selected"),t=e.length,t>1?$("#rowTipoPropiedad").hide():(a=e[0].getAttribute("data-idpropiedad"),o=e[0].getAttribute("data-idtipopropiedad"),r=e[0].getAttribute("data-areasintechar"),i=e[0].getAttribute("data-areatechada"),n=e[0].getAttribute("data-area"),d=e[0].getAttribute("data-idclasepropiedad"),$("#ddlTipoPropiedad").val(o),$("#txtAreaSinTechar").val(r),$("#txtAreaTechada").val(i),$("#txtAreaPropiedad").val(n),$("#ddlClasePropiedad").val(d),$("#rowTipoPropiedad").show()),$("#rowRangos").hide(),openModalCallBack("#modalGenPropiedad",function(){var e;e=$("#gvPropiedad .tile.selected"),CopiarPropiedades("EDIT",0,e,function(){})})}function GenerarVistaPreviaPropiedad(){var e=$("#txtNroFinal"),a=parseInt($("#txtNroInicial").val());CopiarPropiedades("NEW",a,e,function(){})}function ShowAskCobroTorre(){"00"==$("#ddlTipoProyecto").val()?$("#rowCobroDiferenciado").show():($("#rowCobroDiferenciado").hide(),$("#chkCobroDiferenciado")[0].checked=!1)}function ListarCuentaBancaria(e){$.ajax({url:"services/cuentabancaria/cuentabancaria-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"4",id:$("#ddlBanco").val()},success:function(a){var o=0,t=0,r="",i="";if(t=a.length,t>0)for(;o<t;)i=e==a[o].tm_idcuentabancaria?' selected="selected"':"",r+='<option value="'+a[o].tm_idcuentabancaria+'"'+i+">"+a[o].tm_descripcioncuenta+"</option>",++o;else r='<option value="0">No hay cuentas bancarias</option>';$("#ddlCuentaBancaria").html(r)},error:function(e){console.log(e)}})}function LimpiarProyecto(){$("#ddlTipoProyecto")[0].selectedIndex=0,$("#ddlTipoValoracion")[0].selectedIndex=0,$("#txtNombreProyecto").val(""),$("#txtCodigoProyecto").val(""),$("#txtDireccion").val(""),ShowAskCobroTorre(),$("#rowPorcentajeDuplex").hide()}function LimpiarForm(){$("#ddlTipoPropiedad")[0].selectedIndex=0,$("#txtAreaTechada").val("0.00"),$("#txtAreaSinTechar").val("0.00"),$("#txtAreaPropiedad").val("0.00"),$("#txtNroInicial").val("0"),$("#txtNroFinal").val("0"),$("#txtIngresoTorre").val(""),$("#txtNroSuministro").val("0"),$("#gvPropiedadSelected .items-area").html("")}function ListarProcesos(){var e=$("#hdIdProyecto").val();precargaExp("#tableProceso",!0),$.ajax({url:"services/proceso/proceso-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"LISTADO",tipo:"1",id:e},success:function(e){var a,o=0,t=0,r="";if(precargaExp("#tableProceso",!1),t=e.length,t>0){for(;o<t;)r+='<tr data-idproceso="'+e[o].tm_idproceso+'" data-mes="'+e[o].tm_per_mes+'" data-anho="'+e[o].tm_per_ano+'" data-estado="'+e[o].tm_idestadoproceso+'">',r+="<td><h4>"+e[o].tm_per_ano+"</h4></td>",r+="<td><h4>"+arrMeses[parseInt(e[o].tm_per_mes)-1]+"</h4></td>",r+="<td></td>",r+='<td><button data-action="details" class="btn btn-primary center-block">Ver detalle</button></td>',r+="<td>","61"==$("#hdIdPerfil").val()&&""==$("#hdIdProyecto_Sesion").val()?(r+='<button type="button" data-action="delete" class="btn btn-danger center-block" title="Eliminar proceso"><i class="fa fa-trash"></i></button>',"0"==e[o].tm_idestadoproceso?(r+="</td><td>",r+='<button type="button" data-action="reopen" class="btn btn-info center-block" title="Reaperturar proceso"><i class="fa fa-repeat"></i></button>'):r+="</td><td>"):r+="</td><td>",r+="</td>",r+="</tr>",++o;$("#tableProceso tbody").html(r).find('tr[data-estado="1"]').length>0?($("#btnCerrarProceso").removeClass("oculto"),$("#tableProceso tbody").html(r).find('tr[data-estado="1"]:first').trigger("click"),a=$('#tableProceso tbody tr[data-estado="1"]').position(),$("#tableProceso .ibody-content").animate({scrollTop:a.top-50},400,function(){})):$("#btnCerrarProceso").addClass("oculto")}else $("#btnCerrarProceso").addClass("oculto"),$("#tableProceso tbody").html("")},error:function(e){console.log(e)}})}function GestionarProceso(e){var a,o,t=new FormData,r="0",i="0",n="0";precargaExp("#tableProceso",!0);var d=$("#hdIdProyecto").val();a=$("#modalProceso :input").serializeArray(),e?(r=$("#ddlAnhoProceso").val(),i=$("#ddlMesProceso").val()):(o=$("#tableProceso tbody tr.selected"),n=o.attr("data-idproceso"),r=o.attr("data-anho"),i=o.attr("data-mes")),t.append("btnGuardar","btnGuardar"),t.append("hdIdProceso",n),t.append("hdIdProyecto",d),t.append("ddlAnho",r),t.append("ddlMes",i),$.ajax({url:"services/proceso/proceso-post.php",type:"POST",cache:!1,dataType:"json",contentType:!1,processData:!1,data:t,success:function(a){precargaExp("#tableProceso",!1),MessageBox(a.titulomsje,a.contenidomsje,"[Aceptar]",function(){"0"!=a.rpta&&(0==e&&(0==$("#tableProceso tbody").find('tr[data-estado="1"]').length&&$("#btnCerrarProceso").addClass("oculto"),$("#btnBackToInfoProyecto").trigger("click")),ListarProcesos())})},error:function(e){console.log(e)}})}function DetallePropiedad(e,a,o){this.idpropiedad=e,this.saldoinicial=a,this.valor=o}function ActualizarValorFijoMasivo(){var e=new FormData,a=$("#hdTipoValoracion").val(),o=$("#txtValorFijo").val();precargaExp("#pnlListPropiedades",!0),a=$("#optSaldoInicial")[0].checked?"01":a,e.append("btnGuardarValores","btnGuardarValores"),e.append("hdIdProyecto",$("#hdIdProyecto").val()),e.append("hdTipoValoracion",a),e.append("txtValorFijo",o),$.ajax({url:"services/propiedad/propiedad-post.php",type:"POST",cache:!1,dataType:"json",contentType:!1,processData:!1,data:e,success:function(e){precargaExp("#pnlListPropiedades",!1),MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){"0"!=e.rpta&&(closeCustomModal("#modalGenValorFijo"),$("#btnClearSelPropiedades").trigger("click"),paginaPropiedad=1,ListarPropiedades("1"))})},error:function(e){console.log(e)}})}function ActualizarValorPropiedad(){var e=new FormData,a="",o=0,t=[],r=$("#hdTipoValoracion").val();precargaExp("#pnlListPropiedades",!0),$("#gvPropiedad .dato").each(function(e,a){var i=a.getAttribute("data-idpropiedad"),n=$(a).find(".input-saldoinicial").val(),d=$(a).find(".input-ratio").val(),c=$(a).find(".input-importefijo").val();"02"==r?o=d:"03"==r&&(o=c);var l=new DetallePropiedad(i,n,o);t.push(l)}),a=JSON.stringify(t),e.append("btnSaveValuesPropiedades","btnSaveValuesPropiedades"),e.append("hdTipoValoracion",r),e.append("detallePropiedad",a),$.ajax({url:"services/propiedad/propiedad-post.php",type:"POST",cache:!1,dataType:"json",contentType:!1,processData:!1,data:e,success:function(e){precargaExp("#pnlListPropiedades",!1),MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){"0"!=e.rpta&&(closeCustomModal("#modalGenValorFijo"),$("#btnClearSelPropiedades").trigger("click"),paginaPropiedad=1,ListarPropiedades("1"))})},error:function(e){console.log(e)}})}function GuardarLiquidacion(){var e=new FormData,a=$("#modalLiquidacion :input").serializeArray();e.append("btnGuardar","btnGuardar"),e.append("hdIdPrimary",$("#hdIdPrimary").val()),e.append("hdIdProyecto",$("#hdIdProyecto").val()),$.each(a,function(a,o){e.append(o.name,o.value)}),$.ajax({type:"POST",url:"services/liquidacion/liquidacion-post.php",contentType:!1,processData:!1,cache:!1,dataType:"json",data:e,success:function(e){MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){"0"!=e.rpta&&(ListarLiquidacion(),closeCustomModal("#modalLiquidacion"),$("#btnNuevo, #btnUploadExcel").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnEditar, #btnEliminar").addClass("oculto"))})},error:function(e){console.log(e)}})}function ReaperturarProceso(e){var a=new FormData;a.append("btnReaperturar","btnReaperturar"),a.append("hdIdProceso",e),precargaExp("#tableProceso",!0),$.ajax({url:"services/proceso/proceso-post.php",type:"POST",cache:!1,dataType:"json",contentType:!1,processData:!1,data:a,success:function(e){precargaExp("#tableProceso",!1),MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){"0"!=e.rpta&&ListarProcesos()})},error:function(e){console.log(e)}})}function EliminarProceso(e){var a=new FormData;a.append("btnEliminar","btnEliminar"),a.append("hdIdProceso",e),precargaExp("#tableProceso",!0),$.ajax({url:"services/proceso/proceso-post.php",type:"POST",cache:!1,dataType:"json",contentType:!1,processData:!1,data:a,success:function(e){precargaExp("#tableProceso",!1),MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){"0"!=e.rpta&&ListarProcesos()})},error:function(e){console.log(e)}})}function ProyectoPorDefecto(){var e=$("#hdIdProyecto_Sesion").val();""==e?ListarProyectos("1"):$.ajax({url:"services/condominio/condominio-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"2",id:e},success:function(e){var a=e.length;if(a>0){var o=document.createElement("a");o.setAttribute("data-idproyecto",e[0].idproyecto),o.setAttribute("data-nombre",e[0].nombreproyecto),o.setAttribute("data-tipoproyecto",e[0].tipoproyecto),o.setAttribute("data-tipovaloracion",e[0].tipovaloracion),o.setAttribute("data-datosimpleduplex",e[0].datosimpleduplex),$("#hdIdProyecto").val(e[0].idproyecto),MostrarPropiedades(o)}},error:function(e){console.log(e)}})}function MostrarPropiedades(e){$("#pnlInfoGeneralProyecto iframe").remove(),$("#pnlInfoDetalleProyecto iframe").remove(),$("#pnlListado").fadeOut(400,function(){$("#pnlOpciones").fadeIn(400,function(){GoToPropiedades(e),$("#myTab .tab-bar li:first-child a").trigger("click")})})}function initEventReorder(){$("#gvPropiedad").sortable({items:".dato",opacity:1,axis:"y",helper:ayudaArraste,forcePlaceholderSize:!0,sort:function(e,a){return $("<div style='width:100% !important;'>").html($(a).html()).css({border:"1px solid #cccccc",textAlign:"center",height:"25px"})},update:function(e,a){var o=$(a.item).attr("data-idpropiedad"),t=$(a.item).prev().attr("data-orden");t=null!=t?t:0,$("#hdIdPropiedad").val(o),$("#hdIdOrdenOrgAnt").val(t),saveReorder()}})}$(function(){ProyectoPorDefecto(),ListarAnhoProceso(),$("#btnSearchDepartamento").on("click",function(e){e.preventDefault(),ListarDepartamentos("1")}),$("#txtSearchConstructora").on("keydown",function(e){if(e.keyCode==$.ui.keyCode.ENTER)return ListarConstructora(),!1}),$("#myTab").on("click","a",function(e){e.preventDefault();var a=this.getAttribute("href");$("#myTab .tab-bar li").removeClass("active"),$(this).parent().addClass("active"),$(".panel-tab").removeClass("active"),$(a).addClass("active"),"#tab_propiedades"!=a&&createFrame("#pnlInfoGeneralProyecto",this)}),$("#tabProyecto").on("click","a",function(e){e.preventDefault(),$(this).tab("show"),createFrame("#pnlInfoDetalleProyecto",this)}),$("#tableProceso tbody").on("click","tr button",function(e){e.preventDefault();var a=this,o=a.getAttribute("data-action"),t=getParentsUntil(a,"#tableProceso","tr");if(t=t[0],"details"==o)$("#lblProceso").attr({"data-mes":t.getAttribute("data-mes"),"data-anho":t.getAttribute("data-anho"),"data-estado":t.getAttribute("data-estado")}).text($(t).find("td:eq(1) h4").text()+" "+t.getAttribute("data-anho")),$("#tabProyecto li.active a").trigger("click"),$("#pnlInfoGeneralProyecto").fadeOut(400,function(){$("#pnlInfoDetalleProyecto").fadeIn(400,function(){})}),closeCustomModal("#modalProceso");else if("reopen"==o){var r=t.getAttribute("data-idproceso");bootbox.confirm("¿Desea re-aperturar este proceso?",function(e){e&&ReaperturarProceso(r)})}else if("delete"==o){var r=t.getAttribute("data-idproceso");bootbox.confirm("¿Desea eliminar este proceso?",function(e){e&&EliminarProceso(r)})}return!1}),$("#btnGuardarLiquidacion").on("click",function(e){e.preventDefault(),GuardarLiquidacion()}),$("#gvDatos").on("click",".dropdown-list a",function(e){e.preventDefault();var a=this.getAttribute("data-action"),o=getParentsUntil(this,"#gvDatos",".dato"),t=o[0].getAttribute("data-idproyecto");escobrodiferenciado=o[0].getAttribute("data-escobrodiferenciado"),idbanco=o[0].getAttribute("data-idbanco"),idcuentabancaria=o[0].getAttribute("data-idcuentabancaria"),$("#hdIdProyecto").val(t),"edit"==a?GoToEdit(t):"more-info"==a?MostrarPropiedades(o[0]):"delete"==a&&bootbox.confirm("¿Desea eliminar este proyecto?",function(e){e&&EliminarItemProyecto(o[0])})}),$("#txtFechaVencimiento").mask("99/99/9999"),cargarDatePicker("#txtFechaVencimiento",function(e,a){}),$("#txtFechaTope").mask("99/99/9999"),cargarDatePicker("#txtFechaTope",function(e,a){}),$("#btnOrdenPropiedad").on("click",function(e){e.preventDefault(),openModalCallBack("#modalOrdenPropiedad",function(){ListarPropiedades_Orden("1")})}),$("#btnIniciarFacturacion").on("click",function(e){e.preventDefault(),openCustomModal("#modalGenFacturacion")}),$("#btnGenerarFacturacion").on("click",function(e){e.preventDefault(),GenerarFacturacion()}),$("#btnNuevo, #btnEditar").on("click",function(e){e.preventDefault(),$("#tableConcepto tbody").html(""),$("#tableConceptoFormula tbody").html(""),LimpiarProyecto(),cancelImport(),setUbigeo(0,"Localidad"),GoToEdit("0")}),$(".btnBackList").on("click",function(e){e.preventDefault(),BackToPrevPanel(),$("#hdIdProyecto").val("0"),$("#lblProceso").attr({"data-mes":"0","data-anho":"0"}).text("Ninguno"),"btnBackToProyecto"==$(this).attr("id")&&($("#btnLimpiarSeleccion").trigger("click"),$("#btnClearSelPropiedades").trigger("click"))}),$("#btnCancelar").on("click",function(e){e.preventDefault(),closeCustomModal("#modalRegistroProyecto")}),$("#btnProceso").on("click",function(e){e.preventDefault(),openModalCallBack("#modalProceso",function(){ListarProcesos()})}),$("#gvUbigeo").on("click",".panel-info",function(e){e.preventDefault();var a="0",o="";a=$(this).attr("data-idubigeo"),o=$(this).find(".descripcion").text(),setUbigeo(a,o)}),$("#txtSearchUbigeo").on("keyup",function(e){ListarUbigeo()}),$("#pnlInfoUbigeo").on("click",function(e){e.preventDefault(),openModalCallBack("#modalUbigeo",function(){precargaExp("#modalUbigeo",!0),ListarUbicacion("#ddlDepartamento","1","0",function(){ListarUbicacion("#ddlProvincia",$("#ddlDepartamento").val(),"0",function(){ListarUbicacion("#ddlDistrito",$("#ddlProvincia").val(),"0",function(){precargaExp("#modalUbigeo",!1)})})})})}),$("#ddlDepartamento").on("change",function(e){e.preventDefault(),precargaExp("#modalUbigeo",!0),ListarUbicacion("#ddlProvincia",$(this).val(),"0",function(){ListarUbicacion("#ddlDistrito",$("#ddlProvincia").val(),"0",function(){precargaExp("#modalUbigeo",!1)})})}),$("#ddlProvincia").on("change",function(e){e.preventDefault(),precargaExp("#modalUbigeo",!0),ListarUbicacion("#ddlDistrito",$(this).val(),"0",function(){precargaExp("#modalUbigeo",!1)})}),$("#btnAplicarUbigeo").on("click",function(e){e.preventDefault();var a=$("#ddlDistrito").val(),o="Perú/"+$("#ddlDepartamento option:selected").text()+"/"+$("#ddlProvincia option:selected").text()+"/"+$("#ddlDistrito option:selected").text();setUbigeo(a,o)}),$("#btnHideConstructora").on("click",function(e){e.preventDefault(),$("#pnlConstructora").fadeOut(400,function(){})}),$("#pnlInfoConstructora").on("click",function(e){e.preventDefault(),ShowPanelConstructora()}),$("#gvConstructora .items-area").on("click",".tile",function(e){e.preventDefault();var a="0",o="";a=$(this).attr("data-idconstructora"),o=$(this).attr("data-nombre"),setConstructora(a,o)}),$("#ddlTipoProyecto").on("change",function(e){e.preventDefault(),ShowAskCobroTorre()}),$("#ddlTipoValoracion").on("change",function(e){e.preventDefault()}),$("#chkDatoSimpleDuplex").on("click",function(e){MostrarRowPorcentajeDuplex(this.checked)}),$("#chkPorcjDuplex").on("click",function(e){MostrarPorcjDuplex(this.checked)}),$("#ddlBanco").on("change",function(e){e.preventDefault(),ListarCuentaBancaria("0")}),$("#btnGuardar").on("click",function(e){GuardarDatos()}),$("#btnGenPropFromList").on("click",function(e){e.preventDefault();var a;LimpiarForm(),$("#rowTipoPropiedad").show(),$("#rowRangos").show(),a=$("#gvDatos .list.selected"),tipoproyecto=a.attr("data-tipoproyecto"),GetLastIndexPropiedad(),openModalCallBack("#modalGenPropiedad",function(){})}),$("#btnMassConcept").on("click",function(e){e.preventDefault(),LimpiarForm(),GoToEditPropiedad()}),$("#form1").validate({lang:"es",showErrors:showErrorsInValidate,submitHandler:EnvioAdminDatos}),$("#chkIngresoTorre").on("click",function(e){$(this)[0].checked?($("#pnlInfoTorre").addClass("oculto"),$("#rowIngreso").removeClass("oculto"),$("#txtIngresoTorre").focus()):($("#pnlInfoTorre").removeClass("oculto"),$("#rowIngreso").addClass("oculto"))}),$("#pnlInfoTorre").on("click",function(e){e.preventDefault(),openModalCallBack("#modalTorre",function(){ListarTorres()})}),$("#btnLimpiarSeleccion").on("click",function(e){e.preventDefault(),$("#hdIdProyecto").val("0"),$("#gvDatos .dato.selected").removeClass("selected"),$("#gvDatos input:checkbox:checked").removeAttr("checked"),$("#btnNuevo, #btnUploadExcel").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnListPropiedades, #btnEditar, #btnFijarProyecto, #btnEliminar, #btnIniciarFacturacion").addClass("oculto")}),$("#gvPropiedad").on("click",'.tile[data-relaciones!="0"] .link-relacion',function(e){e.preventDefault();var a="0";return a=$(this).parent().parent().parent().parent().attr("data-idpropiedad"),ShowPanelRelacionadas(a),!1}),$("#gvPropiedad").on("click",".tile",function(e){e.preventDefault();var a=$(this).find("input:checkbox"),o=$("#ddlTipoPropiedadFiltro").val(),t=$("#hdTipoValoracion").val(),r=$(this).find(".inputInItem"),i=$(this).find(".input-saldoinicial"),n=$(this).find(".inputRatio"),d=$(this).find(".inputImporteFijo");$(this).hasClass("selected")?($(this).removeClass("selected"),a.removeAttr("checked"),r.addClass("hide"),n.addClass("hide"),d.addClass("hide"),0==$("#gvPropiedad .dato.selected").length?($("#btnGenPropFromList").removeClass("oculto"),$("#btnAsignPropToPerson, #btnMassConcept, #btnEliminarPropiedad, #btnClearSelPropiedades, #btnRelacionarPropiedades, #btnRomperRelaciones").addClass("oculto")):1==$("#gvPropiedad .dato.selected").length&&("EST"==o||"DEP"==o?$("#btnRelacionarPropiedades, #btnRomperRelaciones").removeClass("oculto"):$("#btnRelacionarPropiedades, #btnRomperRelaciones").addClass("oculto"),$("#btnAsignPropToPerson, #btnMassConcept, #btnEliminarPropiedad, #btnClearSelPropiedades").removeClass("oculto"))):($(this).addClass("selected"),a.attr("checked",""),r.removeClass("hide"),"02"==t?n.removeClass("hide"):"03"==t&&d.removeClass("hide"),i.focus(),$("#btnGenPropFromList").addClass("oculto"),"DPT"==o?$("#btnRelacionarPropiedades, #btnRomperRelaciones").addClass("oculto"):$("#btnRelacionarPropiedades, #btnRomperRelaciones").removeClass("oculto"),$("#btnAsignPropToPerson, #btnMassConcept, #btnEliminarPropiedad, #btnClearSelPropiedades").removeClass("oculto"))}),$("#gvPropiedad").on("focus","input:text",function(e){$(this).select()}),$("#gvPropiedad").on("click","input:text",function(e){e.preventDefault(),e.stopPropagation()}),$("#gvDepartamento").on("click",".tile",function(e){e.preventDefault();var a=$(this).find("input:checkbox");$(this).hasClass("selected")?($(this).removeClass("selected"),a.removeAttr("checked"),0==$("#gvDepartamento .dato.selected").length?$("#btnRelacionar, #btnClearSelDepartamentos").addClass("oculto"):$("#btnRelacionar, #btnClearSelDepartamentos").removeClass("oculto")):($(this).siblings(".selected").removeClass("selected"),$(this).addClass("selected"),a.attr("checked",""),$("#btnRelacionar, #btnClearSelDepartamentos").removeClass("oculto"))}),$("#btnClearSelDepartamentos").on("click",function(e){e.preventDefault(),$("#btnSelectAllDepartamentos").removeClass("oculto"),$("#gvDepartamento .tile.selected").removeClass("selected"),$("#gvDepartamento input:checkbox:checked").removeAttr("checked"),$("#btnRelacionar, #btnClearSelDepartamentos").addClass("oculto")}),$("#btnSelectAllDepartamentos").on("click",function(e){e.preventDefault(),$(this).addClass("oculto"),$("#gvDepartamento .tile").addClass("selected"),$("#gvDepartamento input:checkbox").attr("checked",""),$("#btnRelacionar, #btnClearSelDepartamentos").removeClass("oculto")}),$("#btnRelacionarPropiedades").on("click",function(e){e.preventDefault(),ShowPanelDepartamento()}),$("#btnRelacionar").on("click",function(e){e.preventDefault(),RelacionarDepartamento()}),$("#btnRomperRelaciones").on("click",function(e){e.preventDefault(),RomperRelaciones()}),$("#btnHideDepartamento").on("click",function(e){e.preventDefault(),$("#pnlDepartamento").fadeOut(400,function(){$("#btnClearSelDepartamentos").trigger("click")})}),$("#btnHideRelaciones").on("click",function(e){e.preventDefault(),$("#pnlRelacionadas").fadeOut(400,function(){$("#pnlListPropiedades").fadeIn(400,function(){})})}),$("#btnClearSelPropiedades").on("click",function(e){e.preventDefault(),$("#btnSelectAllPropiedades").removeClass("oculto"),$("#gvPropiedad .tile.selected").removeClass("selected"),$("#gvPropiedad input:checkbox:checked").removeAttr("checked"),$("#btnGenPropFromList").removeClass("oculto"),$("#gvPropiedad .inputInItem").addClass("hide"),
$("#btnAsignPropToPerson, #btnMassConcept, #btnEliminarPropiedad, #btnClearSelPropiedades, #btnRelacionarPropiedades, #btnRomperRelaciones").addClass("oculto")}),$("#btnSelectAllPropiedades").on("click",function(e){e.preventDefault(),$(this).addClass("oculto"),$("#gvPropiedad .tile").addClass("selected"),$("#gvPropiedad input:checkbox").attr("checked",""),$("#btnGenPropFromList").addClass("oculto");var a=$("#hdTipoValoracion").val();$("#gvPropiedad .inputInItem").removeClass("hide"),"02"==a?$("#gvPropiedad .inputRatio").removeClass("hide"):"03"==a&&$("#gvPropiedad .inputImporteFijo").removeClass("hide"),$("#btnAsignPropToPerson, #btnMassConcept, #btnEliminarPropiedad, #btnClearSelPropiedades").removeClass("oculto")}),$("#btnSaveValuesPropiedades").on("click",function(e){e.preventDefault(),openModalCallBack("#modalGenValorFijo",function(){var e=!1,a=!1,o=$("#hdTipoValoracion").val(),t=$("#optOtroValor").parent().find(".text");$("#txtValorFijo").val("0.00"),$("#gvPropiedad .dato.selected").length>0?e=!0:($("#optAllValue")[0].checked=!0,$("#optSaldoInicial")[0].checked=!0,$("#txtValorFijo").focus()),$("#optDirect")[0].checked=e,habilitarControl("#optDirect",e),"02"==o||"03"==o?(a=!0,"02"==o?t.text("Ratio fijo"):t.text("Importe fijo")):t.text("No disponible"),habilitarControl("#optOtroValor",a)})}),$("#btnGuardarValores").on("click",function(e){e.preventDefault(),$("#optDirect")[0].checked?ActualizarValorPropiedad():ActualizarValorFijoMasivo()}),$("#btnAsignPropToPerson").on("click",function(e){e.preventDefault(),ShowPanelPropietarioInquilino()}),$("#pnlInfoArea").on("click",function(e){e.preventDefault(),unsetArea(),$("#gpConcepto").removeClass("gp-no-body").removeClass("gp-expand-header"),openCustomModal("#modalConcepto")}),$("#btnHidePropietarioInquilino").on("click",function(e){e.preventDefault(),$("#pnlPropietarioInquilino").fadeOut(400,function(){$("#btnClearSelPropInquilino").trigger("click")})}),$("#txtAreaTechada").on({keydown:function(e){if(e.keyCode==$.ui.keyCode.ENTER)return $("#txtAreaSinTechar").focus(),!1},keypress:function(e){if(e.keyCode==$.ui.keyCode.ENTER)return!1},keyup:function(e){CalcularArea()}}),$("#txtAreaSinTechar").on("keyup",function(e){CalcularArea()}),$("#pnlPropietarioInquilino").on("click",".list",function(e){e.preventDefault();var a=$(this).find("input:checkbox");$(this).hasClass("selected")?($(this).removeClass("selected"),a.removeAttr("checked"),0==$("#pnlPropietarioInquilino .dato.selected").length?$("#btnClearSelPropInquilino, #btnAsignarPropiedades").addClass("oculto"):1==$("#pnlPropietarioInquilino .dato.selected").length&&$("#btnClearSelPropInquilino, #btnAsignarPropiedades").removeClass("oculto")):($(this).addClass("selected"),a.attr("checked",""),$("#btnClearSelPropInquilino, #btnAsignarPropiedades").removeClass("oculto"))}),$("#btnClearSelPropInquilino").on("click",function(e){e.preventDefault(),$("#btnSelectAllPropInquilino").removeClass("oculto"),$("#pnlPropietarioInquilino .dato.selected").removeClass("selected"),$("#pnlPropietarioInquilino input:checkbox:checked").removeAttr("checked"),$("#btnClearSelPropInquilino, #btnAsignarPropiedades").addClass("oculto")}),$("#btnSelectAllPropInquilino").on("click",function(e){e.preventDefault(),$(this).addClass("oculto"),$("#pnlPropietarioInquilino .dato").addClass("selected"),$("#pnlPropietarioInquilino input:checkbox").attr("checked",""),$("#btnClearSelPropInquilino, #btnAsignarPropiedades").removeClass("oculto")}),$("#btnAsignarPropiedades").on("click",function(e){e.preventDefault(),AsignarPropiedades()}),$("#txtSearch").keydown(function(e){if(e.keyCode==$.ui.keyCode.ENTER)return $("#btnSearch").trigger("click"),!1}).keypress(function(e){if(e.keyCode==$.ui.keyCode.ENTER)return!1}),$("#btnSearch").on("click",function(e){e.preventDefault(),$("#btnLimpiarSeleccion").trigger("click"),paginaProyecto=1,ListarProyectos("1")}),$("#txtSearchPropiedad").keydown(function(e){if(e.keyCode==$.ui.keyCode.ENTER)return $("#btnSearchPropiedad").trigger("click"),!1}).keypress(function(e){if(e.keyCode==$.ui.keyCode.ENTER)return!1}),$("#btnSearchPropiedad").on("click",function(e){e.preventDefault(),$("#btnClearSelPropiedades").trigger("click"),paginaPropiedad=1,ListarPropiedades("1")}),$("#txtSearchPropietario").keydown(function(e){if(e.keyCode==$.ui.keyCode.ENTER)return $("#btnSearchPropietario").trigger("click"),!1}).keypress(function(e){if(e.keyCode==$.ui.keyCode.ENTER)return!1}),$("#btnSearchPropietario").on("click",function(e){e.preventDefault(),paginaPropietario=1,ListarPropietarios("1")}),$("#txtSearchInquilino").keydown(function(e){if(e.keyCode==$.ui.keyCode.ENTER)return $("#btnSearchInquilino").trigger("click"),!1}).keypress(function(e){if(e.keyCode==$.ui.keyCode.ENTER)return!1}),$("#btnSearchInquilino").on("click",function(e){e.preventDefault(),paginaInquilino=1,ListarInquilinos("1")}),$("#gvDatos").on("scroll",function(){var e=0;$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&(e=Number($("#hdPagePropiedad").val()),ListarProyectos(e))}),$("#gvPropiedad > .items-area").on("scroll",function(){var e=0;$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&(e=Number($("#hdPagePropiedad").val()),ListarPropiedades(e))}),$("#gvPropietario > .items-area").on("scroll",function(){var e=0;$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&(e=Number($("#hdPagePropietario").val()),ListarPropietarios(e))}),$("#gvInquilino > .items-area").on("scroll",function(){var e=0;$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&(e=Number($("#hdPageInquilino").val()),ListarInquilinos(e))}),$("#ddlTipoPropiedadFiltro").on("change",function(e){e.preventDefault(),$("#btnClearSelPropiedades").trigger("click"),paginaPropiedad=1,ListarPropiedades("1")}),$("#ddlTipoPropiedad").on("change",function(e){e.preventDefault(),GetLastIndexPropiedad()}),$("#tableConcepto tbody").on("keyup","input:text",function(e){EvalConcepto()}),$("#btnAplicarConcepto").on("click",function(e){e.preventDefault(),setArea(),closeCustomModal("#modalConcepto")}),$("#btnPropiedadMasiva").on("click",function(e){e.preventDefault(),EditMassrPropiedad()});var e=[];$(document).ajaxSend(function(a,o,t){e.push(o)}),$(document).ajaxComplete(function(a,o,t){e=$.grep(e,function(e){return e!=o})});var a=function(){completado=!0,$.each(e,function(e,a){a.abort()})};$("#btnCancelarGenProp").add("#btnCloseModalGenPropiedad").on("click",function(e){e.preventDefault(),0==completado&&bootbox.confirm("¿Está seguro de cancelar el envío?",function(e){e&&(progress=0,indexList=0,intervalProgress.isRunning()&&intervalProgress.stop(),a(),MessageBox("Operaci&oacute;n cancelada","Se cancelaron todas las peticiones","[Aceptar]",function(){}))}),closeCustomModal("#modalGenPropiedad")}),$("#btnEliminarPropiedad").on("click",function(e){e.preventDefault(),confirma=confirm("¿Desea eliminar los elementos seleccionados?"),confirma&&EliminarPropiedad()}),$("#btnGenVistaPropiedad").on("click",function(e){e.preventDefault(),GenerarVistaPreviaPropiedad()}),$("#pnlInfoConcepto").on("click",function(e){e.preventDefault(),$("#gpConcepto").addClass("gp-no-body").addClass("gp-expand-header"),openCustomModal("#modalConcepto")}),$("#btnBackToInfoProyecto").on("click",function(e){e.preventDefault(),$("#lblProceso").attr({"data-mes":"0","data-anho":"0"}).text("Ninguno"),$("#pnlInfoDetalleProyecto").fadeOut(400,function(){$("#pnlInfoGeneralProyecto").fadeIn(400,function(){})})}),$("#tableProceso tbody").on("click",'tr[data-estado="1"]',function(e){e.preventDefault(),$(this).siblings(".selected").removeClass("selected"),$(this).addClass("selected"),$("#btnCerrarProceso").removeClass("oculto")}),$("#btnAbrirProceso").on("click",function(e){e.preventDefault(),GestionarProceso(!0)}),$("#btnCerrarProceso").on("click",function(e){e.preventDefault(),GestionarProceso(!1)}),$("#btnFijarProyecto").on("click",function(e){e.preventDefault(),FijarProyecto()}),$(".droping-air").on({dragenter:function(e){e.stopPropagation(),e.preventDefault()},dragover:function(e){e.stopPropagation(),e.preventDefault()},change:function(e){e.preventDefault(),prepareImport(this.files)},drop:function(e){e.preventDefault();var a=e.originalEvent.dataTransfer.files;prepareImport(a)}},".file-import"),$(".droping-air .cancel").on("click",function(e){e.preventDefault(),cancelImport()}),$("#btnEliminar").on("click",function(e){e.preventDefault(),confirma=confirm("¿Desea eliminar los elementos seleccionados?"),confirma&&EliminarProyecto()})});var indexList=0,elemsSelected,progress=0,progressError=!1,paginaProyecto=1,paginaPropiedad=1,paginaPropietario=1,paginaInquilino=1,formula="",fileValue=!1,completado=!0,escobrodiferenciado=0,idbanco=0,idcuentabancaria=0,arrMeses=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],intervalProgress=new Interval(function(){var e,a;a=$(elemsSelected[indexList]).find(".progress-bar"),e=a.progressbar({animate:!0}),e.progressbar("value",++progress),100==progress&&intervalProgress.stop()},100);