function ListarConstructora(t){var o="#gvDatos .items-area";precargaExp("#gvDatos",!0),$.ajax({url:"services/constructora/constructora-search.php",type:"GET",dataType:"json",data:{tipo:"LISTADO",tipobusqueda:"1",criterio:$("#txtSearch").val()}}).done(function(e){var a=0,i=0,n="";if(i=e.length,i>0){for(;a<i;)iditem=e[a].idconstructora,n+='<a href="#" class="list dato without-foto bg-gray-glass half-col bg-cyan g200" data-idconstructora="'+iditem+'">',n+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+iditem+'" />',n+='<div class="list-content pos-rel">',n+='<span class="ubigeotag fg-white bg-darkCyan place-bottom-right padding5 margin5 text-ellipsis">LOCALIDAD: '+e[a].localidad+"</span>",n+='<div class="data">',n+='<main><p class="fg-white"><strong class="descripcion">'+e[a].nombreconstructora+"</strong></p>",n+="</main></div></div>",n+="</a>",++a;paginaConstructora+=1,$("#hdPageConstructora").val(paginaConstructora),"1"==t?$(o).html(n):$(o).append(n)}else"1"==t&&$(o).html("<h2>No hay datos.</h2>");precargaExp("#gvDatos",!1)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}function GoToEdit(){var t=$("#gvDatos .list.selected"),o="0";t.length>0&&(o=t.attr("data-idconstructora"),$.ajax({url:"services/constructora/constructora-search.php",type:"GET",dataType:"json",data:{tipo:"ID",criterio:o}}).done(function(t){var o=0;o=t.length,o>0&&($("#hdIdPrimary").val(t[0].idconstructora),$("#hdIdPropietario").val(t[0].idtipopropietario),$("#ddlTipoConstructora").val(t[0].idtipoconstructora),$("#txtNombreConstructora").val(t[0].nombreconstructora),$("#ddlTipoDocJuridica").val(t[0].iddocident),$("#txtRucEmpresa").val(t[0].numerodoc),$("#txtRazonSocial").val(t[0].razsocial),$("#txtDireccionEmpresa").val(t[0].direccion),$("#txtTelefonoEmpresa").val(t[0].telefono),$("#txtEmailEmpresa").val(t[0].email),$("#txtWebEmpresa").val(t[0].urlweb),setUbigeo(t[0].idlocalidad,t[0].localidad))}).fail(function(){console.log("error")}).always(function(){console.log("complete")})),openCustomModal("#modalRegistroConstructora")}function setUbigeo(t,o){$("#pnlInfoUbigeo").attr("data-idubigeo",t),$("#pnlInfoUbigeo .info .descripcion").text(o),$("#hdIdLocalidad").val(t),closeCustomModal("#modalUbigeo")}function ListarUbigeo(){precargaExp("#modalUbigeo .scrollbarra",!0),$.ajax({url:"services/ubigeo/ubigeo-autocomplete.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",criterio:$("#txtSearchUbigeo").val()}}).done(function(t){var o=0,e=0,a="";if(o=t.length,o>0)for(;e<o;)a+='<div data-idubigeo="'+t[e].tm_idubigeo+'" title="'+t[e].ubigeo+'" class="panel-info without-foto">',a+='<div class="info">',a+='<h3 class="descripcion">'+t[e].ubigeo+"</h3>",a+="</div>",a+="</div>",++e;else a="<h2>No hay datos.</h2>";$("#gvUbigeo").html(a),precargaExp("#modalUbigeo .scrollbarra",!1)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}function addValidPersonaJuridica(){$("#txtRucEmpresa").rules("add",{minlength:11,digits:!0}),$("#txtRazonSocial").rules("add",{required:!0})}function removeValidPersonaJuridica(){$("#txtRucEmpresa").rules("remove"),$("#txtRazonSocial").rules("remove")}function LimpiarForm(){$("#hdIdPrimary").val("0"),$("#txtNombreConstructora").val(""),$("#ddlTipoConstructora")[0].selectedIndex=0,$("#ddlTipoDocJuridica")[0].selectedIndex=0,$("#txtRucEmpresa").val(""),$("#txtRazonSocial").val(""),$("#txtDireccionEmpresa").val(""),$("#txtTelefonoEmpresa").val(""),$("#txtEmailEmpresa").val(""),$("#txtWebEmpresa").val(""),setUbigeo("0","Localidad")}function EnvioAdminDatos(t){var o=new FormData;if(addValidPersonaJuridica(),$("#form1").valid()){o.append("btnGuardar","btnGuardar");var e=$("#form1 :input").serializeArray();$.each(e,function(t,e){o.append(e.name,e.value)}),$.ajax({type:"POST",url:"services/constructora/constructora-post.php",contentType:!1,processData:!1,cache:!1,dataType:"json",data:o,complete:function(t){removeValidPersonaJuridica()},success:function(t){MessageBox(t.titulomsje,t.contenidomsje,"[Aceptar]",function(){"0"!=t.rpta&&(paginaConstructora=1,clearOnlyListSelection(),$("#txtSearch").val(""),ListarConstructora("1"),closeCustomModal("#modalRegistroConstructora"),$("#btnNuevo, #btnUploadExcel").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnListPropiedades, #btnEditar, #btnEliminar").addClass("oculto"))})},error:function(t){console.log(t)}})}}function GuardarDatos(){$("#form1").submit()}function EliminarConstructora(){indexList=0,elemsSelected=$("#gvDatos .selected").toArray(),EliminarItemConstructora(elemsSelected[0])}function EliminarItemConstructora(t){var o=new FormData,e="0";e=t.getAttribute("data-idconstructora"),o.append("btnEliminar","btnEliminar"),o.append("hdIdConstructora",e),$.ajax({url:"services/constructora/constructora-post.php",type:"POST",dataType:"json",data:o,cache:!1,contentType:!1,processData:!1,success:function(o){var a,i,n=0,r="",c=0;i=$(t),c=i.height(),"0"==o.rpta?(r="La empresa inmobiliaria "+e+": "+i.find(".descripcion").text(),"ERROR-PROYECTO"==o.contenidomsje&&(r+=" tiene proyectos relacionados."),MessageBox(o.titulomsje,r,"[Aceptar]",function(){})):(++indexList,a=$("#gvDatos .listview"),n=a.scrollTop(),i.fadeOut(400,function(){$(this).remove()}),indexList<=elemsSelected.length-1?(n+=c+18,a.animate({scrollTop:n},400,function(){EliminarItemConstructora(elemsSelected[indexList])})):MessageBox(o.titulomsje,o.contenidomsje,"[Aceptar]",function(){$("#btnLimpiarSeleccion").trigger("click")}))},error:function(t){console.log(t)}})}$(function(){ListarConstructora("1"),$("#txtSearch").keydown(function(t){if(t.keyCode==$.ui.keyCode.ENTER)return $("#btnSearch").trigger("click"),!1}).keypress(function(t){if(t.keyCode==$.ui.keyCode.ENTER)return!1}),$("#btnSearch").on("click",function(t){t.preventDefault(),$("#btnLimpiarSeleccion").trigger("click"),paginaConstructora=1,ListarConstructora("1")}),$("#gvDatos").on("click",".dato",function(t){var o=$(this).find("input:checkbox");t.preventDefault(),$(this).hasClass("selected")?($(this).removeClass("selected"),o.removeAttr("checked"),0==$("#gvDatos .dato.selected").length?($("#btnNuevo, #btnUploadExcel, #btnSelectAll").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnEditar, #btnDetalleFromList, #btnEliminar").addClass("oculto")):1==$("#gvDatos .dato.selected").length&&$("#btnLimpiarSeleccion, #btnEditar, #btnDetalleFromList").removeClass("oculto")):($(this).addClass("selected"),o.attr("checked",""),$("#btnNuevo, #btnUploadExcel").addClass("oculto"),$("#btnLimpiarSeleccion, #btnEliminar").removeClass("oculto"),1==$("#gvDatos .dato.selected").length?$("#btnEditar, #btnDetalleFromList").removeClass("oculto"):$("#btnEditar, #btnDetalleFromList").addClass("oculto"))}),$("#btnNuevo, #btnEditar").on("click",function(t){t.preventDefault(),LimpiarForm(),GoToEdit()}),$("#gvUbigeo").on("click",".panel-info",function(t){t.preventDefault();var o="0",e="";o=$(this).attr("data-idubigeo"),e=$(this).find(".descripcion").text(),setUbigeo(o,e)}),$("#txtSearchUbigeo").on("keyup",function(t){ListarUbigeo()}),$("#pnlInfoUbigeo").on("click",function(t){t.preventDefault(),openModalCallBack("#modalUbigeo",function(){precargaExp("#modalUbigeo",!0),ListarUbicacion("#ddlDepartamento","1","0",function(){ListarUbicacion("#ddlProvincia",$("#ddlDepartamento").val(),"0",function(){ListarUbicacion("#ddlDistrito",$("#ddlProvincia").val(),"0",function(){precargaExp("#modalUbigeo",!1)})})})})}),$("#ddlDepartamento").on("change",function(t){t.preventDefault(),precargaExp("#modalUbigeo",!0),ListarUbicacion("#ddlProvincia",$(this).val(),"0",function(){ListarUbicacion("#ddlDistrito",$("#ddlProvincia").val(),"0",function(){precargaExp("#modalUbigeo",!1)})})}),$("#ddlProvincia").on("change",function(t){t.preventDefault(),precargaExp("#modalUbigeo",!0),ListarUbicacion("#ddlDistrito",$(this).val(),"0",function(){precargaExp("#modalUbigeo",!1)})}),$("#btnAplicarUbigeo").on("click",function(t){t.preventDefault();var o="0",e="";o=$("#ddlDistrito").val(),e="Perú/"+$("#ddlDepartamento option:selected").text()+"/"+$("#ddlProvincia option:selected").text()+"/"+$("#ddlDistrito option:selected").text(),setUbigeo(o,e)}),$("#form1").validate({lang:"es",showErrors:showErrorsInValidate,submitHandler:EnvioAdminDatos}),$("#btnGuardar").on("click",function(t){t.preventDefault(),GuardarDatos()}),$("#btnCancelar").on("click",function(t){t.preventDefault(),closeCustomModal("#modalRegistroConstructora")}),$("#btnEliminar").on("click",function(t){t.preventDefault(),confirma=confirm("¿Desea eliminar los elementos seleccionados?"),confirma&&EliminarConstructora()}),$("#btnLimpiarSeleccion").on("click",function(t){t.preventDefault(),$("#gvDatos .dato.selected").removeClass("selected"),$("#gvDatos input:checkbox:checked").removeAttr("checked"),$("#btnNuevo, #btnUploadExcel, #btnSelectAll").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnDetalleFromList, #btnEditar, #btnEliminar").addClass("oculto")}),$("#btnSelectAll").on("click",function(t){t.preventDefault(),$(this).addClass("oculto"),$("#gvDatos .dato").addClass("selected"),$("#gvDatos input:checkbox").attr("checked",""),$("#btnNuevo, #btnDetalleFromList, #btnUploadExcel, #btnEditar").addClass("oculto"),$("#btnLimpiarSeleccion, #btnEliminar").removeClass("oculto")}),$("#gvDatos > .items-area").on("scroll",function(){var t=0;$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&(t=Number($("#hdPageConstructora").val()),ListarConstructora(t))})});var paginaConstructora=1,indexList=0,elemsSelected;