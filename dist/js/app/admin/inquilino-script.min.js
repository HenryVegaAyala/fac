function ListarInquilinos(t){var e="#gvDatos .items-area";precargaExp("#gvDatos",!0),$.ajax({type:"GET",url:"services/inquilino/inquilino-search.php",cache:!1,dataType:"json",data:"criterio="+$("#txtSearch").val()+"&pagina="+t,success:function(o){var a=0,i=o.length,n="";if(i>0){for(;i>a;)iditem=o[a].tm_idtipoinquilino,foto=o[a].tm_foto,n+='<a href="#" class="list dato bg-gray-glass bg-cyan" data-idinquilino="'+iditem+'" data-tipoinquilino="'+o[a].tm_iditc+'">',n+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+iditem+'" />',n+='<div class="list-content pos-rel">',n+='<span class="ubigeotag fg-white bg-darkCyan place-top-right padding5 margin5">UBIGEO: '+o[a].ubigeo+"</span>",n+='<div class="data">',n+="<aside>",n+="no-set"==foto?'<i class="fa fa-user"></i>':'<img src="'+foto+'" />',n+="</aside>",n+='<main><p class="fg-white"><span class="descripcion">'+o[a].descripcion+'</span></p><p class="fg-white">Tel&eacute;fono: '+o[a].tm_telefono+' - Direcci&oacute;n: <span class="direccion">'+o[a].tm_direccion+'</span><br /><span class="docidentidad">'+o[a].tipodoc+": "+o[a].tm_numerodoc+"</span> - Email: "+o[a].tm_email+"</p>",n+="</main></div></div>",n+="</a>",++a;paginaInquilino+=1,$("#hdPageInquilino").val(paginaInquilino),"1"==t?$(e).html(n):$(e).append(n)}else"1"==t&&$(e).html("<h2>No hay datos.</h2>");precargaExp("#gvDatos",!1)}})}function ListarPropiedadesPorTipo(){var t="0",e="";t=$("#gvDatos .dato.selected").attr("data-idinquilino"),e=$("#tabDetalle li.active").attr("data-idtipopropiedad"),$.ajax({url:"services/propiedad/propiedad-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"inquilino",idtipopropiedad:e,id:t},success:function(t){var o=0,a=0,i="",n="";if(a=t.length,"DPT"==e?n="#tableDepartamento .ibody tbody":"DEP"==e?n="#tableDeposito .ibody tbody":"EST"==e&&(n="#tableEstacionamiento .ibody tbody"),a>0)for(;a>o;)i+='<tr class="'+t[o].colorestado+'">',i+="<td>"+t[o].nombreproyecto+"</td>",i+="<td>"+t[o].propiedad+"</td>",i+="<td>"+t[o].areapropiedad+"</td>",i+="<td>"+t[o].estado+"</td>",i+="</tr>",++o;$(n).html(i)},error:function(t){console.log(t)}})}function SetTabByDefault(t){var e="",o="";o="NA"==t?"#tab1":"#tab2",e='[data-tipoinquilino="'+t+'"]',$("#pnlForm > .title-window button").removeClass("success"),$("#pnlForm > .title-window button"+e).addClass("success"),$("#pnlForm > .divContent section.tab-principal").hide(),$(o).show()}function prepareImport(t){var e=["xls","xlsx"],o="",a="";return fileValue=t[0],a=t[0].name,o=a.split(".").pop().toLowerCase(),-1==$.inArray(o,e)?(MessageBox("Extensi&oacute;n no v&aacute;lida","El tipo de archivo no es compatible para la importaci&oacute;n","[Aceptar]",function(){}),!1):($(".droping-air .help").text(a),$(".droping-air").addClass("dropped"),habilitarControl("#btnSubirDatos",!0),void $("#btnSubirDatos").addClass("success"))}function cancelImport(){var t;t=$(".progress-bar").progressbar(),$(".droping-air .help").text("Seleccione o arrastre un archivo de Excel"),$(".droping-air").removeClass("dropped"),habilitarControl("#btnSubirDatos",!1),$("#btnSubirDatos").removeClass("success"),$(".droping-air .file-import").val(""),t.progressbar("value",0),t.progressbar("color","bg-cyan"),fileValue=!1}function executeImport(){var t,e,o=fileValue,a=new FormData;t=$(".progress-bar").progressbar(),e=new Interval(function(){t.progressbar("value",++progress),100==progress&&(e.stop(),progressSuccess&&e.start())},100),t.progressbar("value","0"),t.progressbar("color","bg-cyan"),a.append("btnSubirDatos","btnSubirDatos"),a.append("archivo",o),$.ajax({type:"POST",url:"services/inquilino/inquilino-post.php",contentType:!1,processData:!1,cache:!1,dataType:"json",data:a,success:function(o){progressError=!1,"0"!=o.rpta&&(progressSuccess=!0),t.progressbar("value",100),t.progressbar("color","bg-green"),e.isRunning()&&e.stop(),MessageBox(o.titulomsje,o.contenidomsje,"[Aceptar]",function(){"0"!=o.rpta&&(closeCustomModal("#modalUploadExcel"),cancelImport(),paginaInquilino=1,ListarInquilinos("1"))})},beforeSend:function(){e.start()},complete:function(){progress=0,progressError&&setTimeout(function(){e.isRunning()&&e.stop(),t.progressbar("value",100),executeImport()},1e4)},error:function(e){progress=0,t.progressbar("color","bg-red"),progressError=!0,console.log(e)}})}function setUbigeo(t,e){var o="",a="",i=$("#pnlForm > .title-window button.success").attr("data-tipoinquilino");"NA"==i?(o="#pnlInfoUbigeoNatural",a="#hdIdUbigeoNatural"):(o="#pnlInfoUbigeoEmpresa",a="#hdIdUbigeoJuridico"),$(o).attr("data-idubigeo",t),$(o+" .info .descripcion").text(e),$(a).val(t),closeCustomModal("#modalUbigeo")}function ListarUbigeo(){$.ajax({url:"services/ubigeo/ubigeo-autocomplete.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",criterio:$("#txtSearchUbigeo").val()}}).done(function(t){var e=0,o=0,a="";if(e=t.length,e>0)for(;e>o;)a+='<div data-idubigeo="'+t[o].tm_idubigeo+'" title="'+t[o].ubigeo+'" class="panel-info without-foto">',a+='<div class="info">',a+='<h3 class="descripcion">'+t[o].ubigeo+"</h3>",a+="</div>",a+="</div>",++o;else a="<h2>No hay datos.</h2>";$("#gvUbigeo").html(a)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}function clearImagenForm(){$("#fileUploadImage").replaceWith($("#fileUploadImage").val("").clone(!0)),$("#imgFoto").attr({src:"images/user-nosetimg-233.jpg","data-src":"images/user-nosetimg-233.jpg"}),$("#btnResetImage").addClass("oculto")}function addValidPersonaNatural(){$("#txtNroDocNatural").rules("add",{minlength:8,digits:!0}),$("#txtApePaterno").rules("add",{required:!0}),$("#txtApeMaterno").rules("add",{required:!0}),$("#txtNombres").rules("add",{required:!0})}function removeValidPersonaNatural(){$("#txtNroDocNatural").rules("remove"),$("#txtApePaterno").rules("remove"),$("#txtApeMaterno").rules("remove"),$("#txtNombres").rules("remove")}function addValidPersonaJuridica(){$("#txtRucEmpresa").rules("add",{minlength:11,digits:!0}),$("#txtRazonSocial").rules("add",{required:!0})}function removeValidPersonaJuridica(){$("#txtRucEmpresa").rules("remove"),$("#txtRazonSocial").rules("remove")}function LimpiarForm(){$("#hdIdPrimary").val("0"),$("#hdCodigoOri").val("0"),$("#ddlTipoDocJuridica")[0].selectedIndex=0,$("#txtRucEmpresa").val(""),$("#txtRazonSocial").val(""),$("#txtDireccionEmpresa").val(""),$("#txtTelefonoEmpresa").val(""),$("#txtEmailEmpresa").val(""),$("#txtWebEmpresa").val(""),$("#ddlTipoDocNatural")[0].selectedIndex=0,$("#txtNroDocNatural").val(""),$("#txtApePaterno").val(""),$("#txtApeMaterno").val(""),$("#txtNombres").val(""),$("#txtDireccionNatural").val(""),$("#txtTelefonoNatural").val(""),$("#txtEmailNatural").val(""),setUbigeo(0,"Ubigeo")}function EnvioAdminDatos(t){var e=document.getElementById("fileUploadImage"),o=e.files[0],a=new FormData;if("NA"==$("#hdTipoInquilino").val()?(removeValidPersonaJuridica(),addValidPersonaNatural()):(removeValidPersonaNatural(),addValidPersonaJuridica()),$("#form1").valid()){a.append("btnGuardar","btnGuardar"),a.append("archivo",o);var i=$("#form1 :input").serializeArray();$.each(i,function(t,e){a.append(e.name,e.value)}),$.ajax({type:"POST",url:"services/inquilino/inquilino-post.php",contentType:!1,processData:!1,cache:!1,dataType:"json",data:a,complete:function(t){"NA"==$("#hdTipoInquilino").val()?removeValidPersonaNatural():removeValidPersonaJuridica()},success:function(t){MessageBox(t.titulomsje,t.contenidomsje,"[Aceptar]",function(){"0"!=t.rpta&&(paginaInquilino=1,clearOnlyListSelection(),ListarInquilinos("1"),clearImagenForm(),BackToPrevPanel(),$("#btnNuevo, #btnUploadExcel").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnEditar, #btnEliminar").addClass("oculto"))})},error:function(t){console.log(t)}})}}function GuardarDatos(){$("#form1").submit()}function MostrarModalPorTab(){var t;t=$("#tabDetalle .tabs li.active").attr("data-tab"),"Departamento"==t?openCustomModal("#modalDepartamento"):"Estacionamiento"==t?openCustomModal("#modalEstacionamiento"):"Deposito"==t&&openCustomModal("#modalDeposito")}function GoToDetalle(){var t,e="0",o="",a="";t=$("#gvDatos .dato.selected"),e=t.attr("data-idinquilino"),o=t.find(".list-content aside").html(),a=t.find(".list-content .descripcion").text(),$("#hdIdPrimary").val(e),$("#pnlInfoPersona").attr({"data-idpersona":e,"data-hint":a}),$("#pnlInfoPersona .foto").html(o),$("#pnlInfoPersona .info .descripcion").text(a),$("#pnlListado").fadeOut(500,function(){$("#pnlDetalle").fadeIn(500,function(){ListarPropiedadesPorTipo()})})}function GoToEdit(){var t=$("#gvDatos .list.selected"),e="0",o="NA";t.length>0&&(e=t.attr("data-idinquilino"),o=t.attr("data-tipoinquilino"),SetTabByDefault(o),$.ajax({url:"services/inquilino/inquilino-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"2",id:e}}).done(function(t){var e=0;e=t.length,e>0&&(foto=t[0].tm_foto,$("#hdIdPrimary").val(t[0].tm_idtipoinquilino),$("#hdCodigoOri").val(t[0].tm_codigo_ori),$("#hdTipoInquilino").val(t[0].tm_iditc),"NA"==t[0].tm_iditc?($("#ddlTipoDocNatural").val(t[0].tm_iddocident),$("#txtNroDocNatural").val(t[0].tm_numerodoc),$("#txtDireccionNatural").val(t[0].tm_direccion),$("#txtTelefonoNatural").val(t[0].tm_telefono),$("#txtApePaterno").val(t[0].tm_apepaterno),$("#txtApeMaterno").val(t[0].tm_apematerno),$("#txtNombres").val(t[0].tm_nombres),$("#txtEmailNatural").val(t[0].tm_email),$("#hdIdUbigeoNatural").val(t[0].tm_idubigeo)):($("#ddlTipoDocJuridica").val(t[0].tm_iddocident),$("#txtRucEmpresa").val(t[0].tm_numerodoc),$("#txtRazonSocial").val(t[0].tm_razsocial),$("#txtEmailEmpresa").val(t[0].tm_email),$("#txtRepresentante").val(t[0].tm_representante),$("#txtDireccionEmpresa").val(t[0].tm_direccion),$("#txtTelefonoEmpresa").val(t[0].tm_telefono),$("#txtWebEmpresa").val(t[0].tm_urlweb),$("#hdIdUbigeoJuridico").val(t[0].tm_idubigeo)),setUbigeo(t[0].tm_idubigeo,t[0].ubigeo),clearImagenForm(),"no-set"!=foto&&$("#imgFoto").attr({src:t[0].tm_foto,"data-src":t[0].tm_foto}),$("#hdFoto").val(foto))}).fail(function(){console.log("error")}).always(function(){console.log("complete")})),$("#pnlListado").fadeOut(500,function(){$("#pnlForm").fadeIn(500,function(){})})}function EliminarInquilino(){indexList=0,elemsSelected=$("#gvDatos .selected").toArray(),EliminarItemInquilino(elemsSelected[0])}function EliminarItemInquilino(t){var e=new FormData,o="0";o=t.getAttribute("data-idinquilino"),e.append("btnEliminar","btnEliminar"),e.append("hdIdInquilino",o),$.ajax({url:"services/inquilino/inquilino-post.php",type:"POST",dataType:"json",data:e,cache:!1,contentType:!1,processData:!1,success:function(e){var a,i,n=0,r="",l=0;i=$(t),l=i.height(),"0"==e.rpta?(r="El inquilino "+o+": "+$(t).find(".descripcion").text(),"ERROR-PROPIEDAD"==e.contenidomsje&&(r+=" esta asignado a una propiedad."),MessageBox(e.titulomsje,r,"[Aceptar]",function(){})):(++indexList,a=$("#gvDatos .listview"),n=a.scrollTop(),i.fadeOut(400,function(){$(this).remove()}),indexList<=elemsSelected.length-1?(n+=l+18,a.animate({scrollTop:n},400,function(){EliminarItemInquilino(elemsSelected[indexList])})):MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){$("#btnLimpiarSeleccion").trigger("click")}))},error:function(t){console.log(t)}})}$(function(){ListarInquilinos("1"),$("#pnlForm > .title-window").on("click","button",function(t){t.preventDefault();var e=$(this).attr("data-target"),o=$(this).attr("data-tipoinquilino");$(this).siblings(".success").removeClass("success"),$(this).addClass("success"),$("#pnlForm > .divContent section.tab-principal").hide(),$(e).show(),$("#hdTipoInquilino").val(o)}),$("#gvDatos").on("click",".dato",function(t){var e=$(this).find("input:checkbox");t.preventDefault(),$(this).hasClass("selected")?($(this).removeClass("selected"),e.removeAttr("checked"),0==$("#gvDatos .dato.selected").length?($("#btnNuevo, #btnUploadExcel").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnDetalleFromList, #btnEditar, #btnEliminar").addClass("oculto")):1==$("#gvDatos .dato.selected").length&&$("#btnLimpiarSeleccion, #btnDetalleFromList, #btnEditar").removeClass("oculto")):($(this).addClass("selected"),e.attr("checked",""),$("#btnNuevo, #btnUploadExcel").addClass("oculto"),$("#btnLimpiarSeleccion, #btnDetalleFromList, #btnEliminar").removeClass("oculto"),1==$("#gvDatos .dato.selected").length?$("#btnEditar").removeClass("oculto"):$("#btnEditar").addClass("oculto"))}),$("#btnDetalleFromList").on("click",function(t){t.preventDefault(),GoToDetalle()}),$("#btnNuevo, #btnEditar").on("click",function(t){t.preventDefault(),LimpiarForm(),GoToEdit()}),$("#btnBackToListFromForm").add("#btnBackToListFromDetalle").on("click",function(t){t.preventDefault(),"btnBackToListFromForm"==$(this).attr("id")?$("#pnlForm").fadeOut(400,function(){$("#pnlListado").fadeIn(400,function(){})}):$("#pnlDetalle").fadeOut(400,function(){$("#pnlListado").fadeIn(400,function(){})}),$("#btnLimpiarSeleccion").trigger("click")}),$("#btnCancelar").on("click",function(t){t.preventDefault(),closeCustomModal("#modalRegistro")}),$("#btnNuevoDetalle").on("click",function(t){t.preventDefault(),MostrarModalPorTab()}),$("#pnlInfoUbigeoNatural").add("#pnlInfoUbigeoEmpresa").on("click",function(t){t.preventDefault(),openModalCallBack("#modalUbigeo",function(){precargaExp("#modalUbigeo",!0),ListarUbicacion("#ddlDepartamento","1","0",function(){ListarUbicacion("#ddlProvincia",$("#ddlDepartamento").val(),"0",function(){ListarUbicacion("#ddlDistrito",$("#ddlProvincia").val(),"0",function(){precargaExp("#modalUbigeo",!1)})})})})}),$("#ddlDepartamento").on("change",function(t){t.preventDefault(),precargaExp("#modalUbigeo",!0),ListarUbicacion("#ddlProvincia",$(this).val(),"0",function(){ListarUbicacion("#ddlDistrito",$("#ddlProvincia").val(),"0",function(){precargaExp("#modalUbigeo",!1)})})}),$("#ddlProvincia").on("change",function(t){t.preventDefault(),precargaExp("#modalUbigeo",!0),ListarUbicacion("#ddlDistrito",$(this).val(),"0",function(){precargaExp("#modalUbigeo",!1)})}),$("#btnAplicarUbigeo").on("click",function(t){t.preventDefault();var e="0",o="";e=$("#ddlDistrito").val(),o="Perú/"+$("#ddlDepartamento option:selected").text()+"/"+$("#ddlProvincia option:selected").text()+"/"+$("#ddlDistrito option:selected").text(),setUbigeo(e,o)}),$("#pnlInfoUbigeoContacto").on("click",function(t){t.preventDefault(),openModalCallBack("#modalUbigeo",function(){})}),$("#fileUploadImage").change(function(){var t,e="",o="",a="",i=new FileReader;t=this.files[0],i.readAsDataURL(t),e=t.name,o=t.size,a=t.type,i.onload=function(t){$("#imgFoto").attr("src",t.target.result),$("#hdFoto").val(e),$("#btnResetImage").removeClass("oculto")}}),$("#btnResetImage").on("click",function(t){t.preventDefault(),$(this).addClass("oculto"),$("#imgFoto").attr("src",$("#imgFoto").attr("data-src"))}),$("#gvUbigeo").on("click",".panel-info",function(t){t.preventDefault();var e="0",o="";e=$(this).attr("data-idubigeo"),o=$(this).find(".descripcion").text(),setUbigeo(e,o)}),$("#txtSearchUbigeo").on("keyup",function(t){ListarUbigeo()}),$("#form1").validate({lang:"es",showErrors:showErrorsInValidate,submitHandler:EnvioAdminDatos}),$("#btnGuardar").on("click",function(t){GuardarDatos()}),$("#btnEliminar").on("click",function(t){t.preventDefault(),confirma=confirm("¿Desea eliminar los elementos seleccionados?"),confirma&&EliminarInquilino()}),$("#btnHideConstructora").on("click",function(t){t.preventDefault(),$("#pnlConstructora").fadeOut(400,function(){})}),$("#btnLimpiarSeleccion").on("click",function(t){t.preventDefault(),$("#hdIdPrimary").val("0"),$("#gvDatos .dato.selected").removeClass("selected"),$("#gvDatos input:checkbox:checked").removeAttr("checked"),$("#btnNuevo, #btnUploadExcel").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnDetalleFromList, #btnEditar, #btnEliminar").addClass("oculto")}),$("#gvDatos > .items-area").on("scroll",function(){var t=0;$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&(t=Number($("#hdPageInquilino").val()),ListarInquilinos(t))}),$("#tabDetalle").tabcontrol().bind("tabcontrolchange",function(t,e){ListarPropiedadesPorTipo()}),$("#btnUploadExcel").on("click",function(t){t.preventDefault(),openCustomModal("#modalUploadExcel")}),$(".droping-air .file-import").on({dragenter:function(t){t.stopPropagation(),t.preventDefault()},dragover:function(t){t.stopPropagation(),t.preventDefault()},change:function(t){t.preventDefault(),prepareImport(this.files)},drop:function(t){t.preventDefault();var e=t.originalEvent.dataTransfer.files;prepareImport(e)}}),$("#btnCancelarSubida").on("click",function(t){t.preventDefault(),cancelImport()}),$("#btnSubirDatos").on("click",function(t){t.preventDefault(),executeImport()})});var indexList=0,elemsSelected,fileValue=!1,progress=0,progressError=!1,progressSuccess=!1,paginaInquilino=1;