function insertarContenido(e){var t=tinyMCE.get("txtEstructura");t.insertContent(e)}function ListarArchivos(e){var t="",n="",a="";t="#gvFiles .gridview",n="#moduloFiles .colTwoPanel2",precargaExp(n,!0),$.ajax({url:"services/files/files-search.php",type:"GET",cache:!1,dataType:"json",data:{folder:e,criterio:a}}).done(function(e){var a=0,l=0,i="",o="",r="";if(l=e.length,precargaExp(n,!1),l>0)for(;a<l;)o=e[a].path,r=e[a].file,i+='<div class="tile dato" data-url="'+o+'">',i+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+o+'" />',i+='<div class="tile_true_content">',i+='<div class="tile-content image">',i+='<img src="'+o+'" alt="" />',i+="</div>",i+='<div class="tile-status bg-dark opacity">',i+='<span class="label">'+r+"</span>",i+="</div>",i+="</div>",i+="</div>",++a;$(t).html(i)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}function Registrar(){var e,t=new FormData;precargaExp("#pnlNuevoModelo",!0),tinymce.triggerSave(),e=$("#pnlNuevoModelo :input").serializeArray(),t.append("btnGuardar","btnGuardar"),$.each(e,function(e,n){t.append(n.name,n.value)}),$.ajax({url:"services/modelocarta/modelocarta-post.php",type:"POST",dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(e){precargaExp("#pnlNuevoModelo",!1),MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){"0"!=e.rpta&&(window.parent.paginaModelo=1,window.parent.ListarModelos("1"))})},error:function(e){console.log(e)}})}$(function(){var e=0;e=$("#pnlNuevoModelo > .gp-body").height(),e-=120,tinymce.init({selector:"textarea",plugins:["advlist autolink lists link image charmap anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste"],toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image ",autosave_ask_before_unload:!1,min_height:160,relative_urls:!1,remove_script_host:!1,convert_urls:!0,menubar:"tools edit table format view insert",height:e,setup:function(e){}}),$("#gvFiles").on("click",".dato",function(e){e.preventDefault();var t=$(this).find("input:checkbox");$(this).hasClass("selected")?($(this).removeClass("selected"),t.removeAttr("checked"),0==$("#gvFiles .dato.selected").length?$("#btnClearSelect, #btnInsertFiles").addClass("oculto"):1==$("#gvFiles .dato.selected").length&&$("#btnClearSelect, #btnInsertFiles").removeClass("oculto")):($(this).addClass("selected"),t.attr("checked",""),$("#btnClearSelect, #btnInsertFiles").removeClass("oculto"))}),$("#ddlTerminos").on("change",function(e){e.preventDefault(),insertarContenido($(this).val())}),$("#btnAddTermino").on("click",function(e){e.preventDefault(),insertarContenido($("#ddlTerminos").val())}),$("#btnShowFiles").on("click",function(e){e.preventDefault(),$("#pnlFiles").fadeIn(400,function(){var e=document.getElementById("hdUsuario").value;document.getElementById("ifrFiles").setAttribute("src","?pag=uploader&folder="+e+"&tipo=media"),ListarArchivos(e)})}),$("#btnHideFiles").on("click",function(e){e.preventDefault(),$("#pnlFiles").fadeOut(400,function(){})}),$("#btnClearSelect").on("click",function(e){e.preventDefault(),$("#btnClearSelect, #btnInsertFiles").addClass("oculto"),$("#gvFiles .tile.selected").removeClass("selected"),$("#gvFiles input:checkbox:checked").removeAttr("checked")}),$("#btnInsertFiles").click(function(){var e,t=[],n=[],a="",l=0,i=0;if(t=window.location.href.split("/"),n=window.location.pathname.split("/"),a=t[0]+"//"+t[2]+"/"+n[1],e=$("#gvFiles .dato.selected"),l=e.length,l>0){for(var o=tinyMCE.get("txtEstructura"),r=o.selection.getRng();i<l;){var s=o.getDoc().createElement("img");s.src=a+"/"+e[i].getAttribute("data-url"),r.insertNode(s),++i}$("#btnHideFiles").trigger("click"),$("#btnClearSelect").trigger("click")}}),$("#btnGuardarModelo").on("click",function(e){e.preventDefault(),Registrar()})});