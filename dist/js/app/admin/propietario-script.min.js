function ListarPropietarios(e){var t="#gvDatos .items-area";precargaExp("#gvDatos",!0),$.ajax({type:"GET",url:"services/propietario/propietario-search.php",cache:!1,dataType:"json",data:"criterio="+encodeURIComponent($("#txtSearchPropietario").val())+"&pagina="+e,success:function(o){var a=0,i=0,r="",n="";if(n=getParameterByName("screenmode"),i=o.length,i>0){for(;a<i;)iditem=o[a].tm_idtipopropietario,foto=o[a].tm_foto,r+='<a href="#" class="list dato bg-gray-glass bg-cyan" data-idpropietario="'+iditem+'" data-tipopropietario="'+o[a].tm_iditc+'" data-email="'+o[a].tm_email+'">',r+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+iditem+'" />',r+='<div class="list-content pos-rel">',r+='<span class="ubigeotag fg-white bg-darkCyan place-top-right padding5 margin5">UBIGEO: '+o[a].ubigeo+"</span>",r+='<div class="data">',r+="<aside>",r+="no-set"==foto?'<i class="fa fa-user"></i>':'<img src="'+foto+'" />',r+="</aside>",r+='<main><p class="fg-white"><span class="descripcion">'+o[a].descripcion+'</span></p><p class="fg-white">Tel&eacute;fono: '+o[a].tm_telefono+' - Direcci&oacute;n: <span class="direccion">'+o[a].tm_direccion+'</span><br /><span class="docidentidad">'+o[a].tipodoc+": "+o[a].tm_numerodoc+"</span> - Email: "+o[a].tm_email+"</p>",r+="</main></div></div>",r+="</a>",++a;paginaPropietario+=1,$("#hdPagePropietario").val(paginaPropietario),"1"==e?$(t).html(r):$(t).append(r),"search"==n?($("#btnSelectAll").addClass("oculto"),$(t).find(".dato").eq(0).trigger("click")):$("#btnSelectAll").removeClass("oculto")}else"1"==e&&($(t).html("<h2>No hay datos.</h2>"),"search"==n&&$("#btnSelectOne").addClass("oculto"));precargaExp("#gvDatos",!1)},error:function(e){console.log(e)}})}function ListarPropiedadesPorTipo(){var e="0",t="";e=$("#gvDatos .dato.selected").attr("data-idpropietario"),t=$("#tabDetalle li.active").attr("data-idtipopropiedad"),$.ajax({url:"services/propiedad/propiedad-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"propietario",idtipopropiedad:t,id:e},success:function(e){var o=0,a=0,i="",r="";if(a=e.length,"DPT"==t?r="#tableDepartamento .ibody tbody":"DEP"==t?r="#tableDeposito .ibody tbody":"EST"==t&&(r="#tableEstacionamiento .ibody tbody"),a>0)for(;o<a;)i+='<tr class="'+e[o].colorestado+'">',i+="<td>"+e[o].nombreproyecto+"</td>",i+="<td>"+e[o].propiedad+"</td>",i+="<td>"+e[o].areapropiedad+"</td>",i+="<td>"+e[o].estado+"</td>",i+="</tr>",++o;$(r).html(i)},error:function(e){console.log(e)}})}function SeleccionarPropietario(){var e,t="0",o="";e=$("#gvDatos .dato.selected"),t=e[0].getAttribute("data-idpropietario"),o=e.find(".descripcion").text(),window.parent.setPropietario(t,o)}function prepareImport(e){var t=["xls","xlsx"],o="",a="";return fileValue=e[0],a=e[0].name,o=a.split(".").pop().toLowerCase(),$.inArray(o,t)==-1?(MessageBox("Extensi&oacute;n no v&aacute;lida","El tipo de archivo no es compatible para la importaci&oacute;n","[Aceptar]",function(){}),!1):($(".droping-air .help").text(a),$(".droping-air").addClass("dropped"),habilitarControl("#btnSubirDatos",!0),void $("#btnSubirDatos").addClass("success"))}function cancelImport(){var e;e=$(".progress-bar").progressbar(),$(".droping-air .help").text("Seleccione o arrastre un archivo de Excel"),$(".droping-air").removeClass("dropped"),habilitarControl("#btnSubirDatos",!1),$("#btnSubirDatos").removeClass("success"),$(".droping-air .file-import").val(""),e.progressbar("value",0),e.progressbar("color","bg-cyan"),fileValue=!1}function executeImport(){var e,t,o=fileValue,a=new FormData;e=$(".progress-bar").progressbar(),t=new Interval(function(){e.progressbar("value",++progress),100==progress&&(t.stop(),progressSuccess&&t.start())},100),e.progressbar("value","0"),e.progressbar("color","bg-cyan"),a.append("btnSubirDatos","btnSubirDatos"),a.append("archivo",o),$.ajax({type:"POST",url:"services/propietario/propietario-post.php",contentType:!1,processData:!1,cache:!1,dataType:"json",data:a,success:function(o){progressError=!1,"0"!=o.rpta&&(progressSuccess=!0),e.progressbar("value",100),e.progressbar("color","bg-green"),t.isRunning()&&t.stop(),MessageBox(o.titulomsje,o.contenidomsje,"[Aceptar]",function(){"0"!=o.rpta&&(closeCustomModal("#modalUploadExcel"),cancelImport(),paginaPropietario=1,ListarPropietarios("1"))})},beforeSend:function(){t.start()},complete:function(){progress=0,progressError&&setTimeout(function(){t.isRunning()&&t.stop(),e.progressbar("value",100),executeImport()},1e4)},error:function(t){progress=0,e.progressbar("color","bg-red"),progressError=!0,console.log(t)}})}function SetTabByDefault(e){var t="",o="";o="NA"==e?"#tab1":"#tab2",t='[data-tipopropietario="'+e+'"]',$("#pnlForm > .title-window .btn").removeClass("btn-success"),$("#pnlForm > .title-window .btn"+t).addClass("btn-success"),$("#pnlForm > .divContent section.tab-principal").hide(),$(o).show()}function setUbigeo(e,t){var o="",a="",i=$("#pnlForm > .title-window .btn.btn-success").attr("data-tipopropietario");"NA"==i?(o="#pnlInfoUbigeoNatural",a="#hdIdUbigeoNatural"):(o="#pnlInfoUbigeoEmpresa",a="#hdIdUbigeoJuridico"),$(o).attr("data-idubigeo",e),$(o+" .info .descripcion").text(t),$(a).val(e),closeCustomModal("#modalUbigeo")}function ListarUbigeo(){$.ajax({url:"services/ubigeo/ubigeo-autocomplete.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",criterio:$("#txtSearchUbigeo").val()}}).done(function(e){var t=0,o=0,a="";if(t=e.length,t>0)for(;o<t;)a+='<div data-idubigeo="'+e[o].tm_idubigeo+'" title="'+e[o].ubigeo+'" class="panel-info without-foto">',a+='<div class="info">',a+='<h3 class="descripcion">'+e[o].ubigeo+"</h3>",a+="</div>",a+="</div>",++o;else a="<h2>No hay datos.</h2>";$("#gvUbigeo").html(a)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}function clearImagenForm(){$("#fileUploadImage").replaceWith($("#fileUploadImage").val("").clone(!0)),$("#imgFoto").attr({src:"dist/img/user-nosetimg-233.jpg","data-src":"dist/img/user-nosetimg-233.jpg"}),$("#btnResetImage").addClass("oculto")}function addValidPersonaNatural(){$("#txtNroDocNatural").rules("add",{minlength:8,digits:!0}),$("#txtApePaterno").rules("add",{required:!0}),$("#txtApeMaterno").rules("add",{required:!0}),$("#txtNombres").rules("add",{required:!0})}function removeValidPersonaNatural(){$("#txtNroDocNatural").rules("remove"),$("#txtApePaterno").rules("remove"),$("#txtApeMaterno").rules("remove"),$("#txtNombres").rules("remove")}function addValidPersonaJuridica(){$("#txtRucEmpresa").rules("add",{minlength:11,digits:!0}),$("#txtRazonSocial").rules("add",{required:!0})}function removeValidPersonaJuridica(){$("#txtRucEmpresa").rules("remove"),$("#txtRazonSocial").rules("remove")}function LimpiarForm(){$("#hdIdPrimary").val("0"),$("#hdCodigoOri").val("0"),$("#ddlTipoDocJuridica")[0].selectedIndex=0,$("#txtRucEmpresa").val(""),$("#txtRazonSocial").val(""),$("#txtDireccionEmpresa").val(""),$("#txtTelefonoEmpresa").val(""),$("#txtEmailEmpresa").val(""),$("#txtWebEmpresa").val(""),$("#chkEsConstructora")[0].checked=!1,$("#ddlTipoDocNatural")[0].selectedIndex=0,$("#txtNroDocNatural").val(""),$("#txtApePaterno").val(""),$("#txtApeMaterno").val(""),$("#txtNombres").val(""),$("#txtDireccionNatural").val(""),$("#txtTelefonoNatural").val(""),$("#txtEmailNatural").val(""),setUbigeo(0,"Ubigeo")}function EnvioAdminDatos(e){var t=(getParameterByName("screenmode"),document.getElementById("fileUploadImage")),o=t.files[0],a=new FormData;if("NA"==$("#hdTipoPropietario").val()?(removeValidPersonaJuridica(),addValidPersonaNatural()):(removeValidPersonaNatural(),addValidPersonaJuridica()),$("#form1").valid()){a.append("btnGuardar","btnGuardar"),a.append("hdLegal",$("#hdLegal").val()),a.append("archivo",o);var i=$("#form1 :input").serializeArray();$.each(i,function(e,t){a.append(t.name,t.value)}),$.ajax({type:"POST",url:"services/propietario/propietario-post.php",contentType:!1,processData:!1,cache:!1,dataType:"json",data:a,complete:function(e){"NA"==$("#hdTipoPropietario").val()?removeValidPersonaNatural():removeValidPersonaJuridica()},success:function(e){"0"==e.rpta?"ENTER-LEGAL"==e.titulomsje?openCustomModal("#modalCondiciones"):closeCustomModal("#modalCondiciones"):MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){closeCustomModal("#modalCondiciones");var e=getParameterByName("screenmode");"propietario"!=e&&(paginaPropietario=1,clearOnlyListSelection(),ListarPropietarios("1"),clearImagenForm(),BackToPrevPanel(),$("#btnNuevo, #btnUploadExcel, #btnSelectAll").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnEditar, #btnEliminar").addClass("oculto"))})},error:function(e){console.log(e)}})}}function GuardarDatos(){$("#form1").submit()}function MostrarModalPorTab(){var e;e=$("#tabDetalle .tabs li.active").attr("data-tab"),"Departamento"==e?openCustomModal("#modalDepartamento"):"Estacionamiento"==e?openCustomModal("#modalEstacionamiento"):"Deposito"==e&&openCustomModal("#modalDeposito")}function GoToDetalle(){var e,t="0",o="",a="";e=$("#gvDatos .dato.selected"),t=e.attr("data-idpropietario"),o=e.find(".list-content aside").html(),a=e.find(".list-content .descripcion").text(),$("#hdIdPrimary").val(t),$("#pnlInfoPersona").attr({"data-idpersona":t,"data-hint":a}),$("#pnlInfoPersona .foto").html(o),$("#pnlInfoPersona .info .descripcion").text(a),$("#pnlListado").fadeOut(500,function(){$("#pnlDetalle").fadeIn(500,function(){ListarPropiedadesPorTipo()})})}function GoToEdit(){var e=$("#gvDatos .list.selected"),t="0",o=getParameterByName("screenmode");$("#hdIdPrimary").val("0"),"search"!=o&&e.length>0&&(tipobusqueda="2",t=e.attr("data-idpropietario"),GetEdit(tipobusqueda,t)),$("#pnlListado").fadeOut(500,function(){$("#pnlForm").fadeIn(500,function(){})})}function GetEdit(e,t){$.ajax({url:"services/propietario/propietario-search.php",type:"GET",dataType:"json",data:{tipobusqueda:e,id:t}}).done(function(e){var t=0;t=e.length,t>0&&(foto=e[0].tm_foto,$("#hdIdPrimary").val(e[0].tm_idtipopropietario),$("#hdCodigoOri").val(e[0].tm_codigo_ori),$("#hdTipoPropietario").val(e[0].tm_iditc),SetTabByDefault(e[0].tm_iditc),"NA"==e[0].tm_iditc?($("#ddlTipoDocNatural").val(e[0].tm_iddocident),$("#txtNroDocNatural").val(e[0].tm_numerodoc),$("#txtDireccionNatural").val(e[0].tm_direccion),$("#txtTelefonoNatural").val(e[0].tm_telefono),$("#txtApePaterno").val(e[0].tm_apepaterno),$("#txtApeMaterno").val(e[0].tm_apematerno),$("#txtNombres").val(e[0].tm_nombres),$("#txtEmailNatural").val(e[0].tm_email),$("#hdIdUbigeoNatural").val(e[0].tm_idubigeo)):($("#ddlTipoDocJuridica").val(e[0].tm_iddocident),$("#txtRucEmpresa").val(e[0].tm_numerodoc),$("#txtRazonSocial").val(e[0].tm_razsocial),$("#txtEmailEmpresa").val(e[0].tm_email),$("#txtRepresentante").val(e[0].tm_representante),$("#txtDireccionEmpresa").val(e[0].tm_direccion),$("#txtTelefonoEmpresa").val(e[0].tm_telefono),$("#txtWebEmpresa").val(e[0].tm_urlweb),$("#hdIdUbigeoJuridico").val(e[0].tm_idubigeo),$("#chkEsConstructora")[0].checked="1"==e[0].tm_esconstructora),setUbigeo(e[0].tm_idubigeo,e[0].ubigeo),clearImagenForm(),"no-set"!=foto&&$("#imgFoto").attr({src:e[0].tm_foto,"data-src":e[0].tm_foto}),$("#hdFoto").val(foto))}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}function EliminarPropietario(){indexList=0,elemsSelected=$("#gvDatos .selected").toArray(),EliminarItemPropietario(elemsSelected[0])}function EliminarItemPropietario(e){var t=new FormData,o="0";o=e.getAttribute("data-idpropietario"),t.append("btnEliminar","btnEliminar"),t.append("hdIdPropietario",o),$.ajax({url:"services/propietario/propietario-post.php",type:"POST",dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(t){var a,i,r=0,n="",l=0;i=$(e),l=i.height(),"0"==t.rpta?(n="El propietario "+o+": "+$(e).find(".descripcion").text(),"ERROR-PROPIEDAD"==t.contenidomsje&&(n+=" esta asignado a una propiedad."),MessageBox(t.titulomsje,n,"[Aceptar]",function(){})):(++indexList,a=$("#gvDatos .listview"),r=a.scrollTop(),i.fadeOut(400,function(){$(this).remove()}),indexList<=elemsSelected.length-1?(r+=l+18,a.animate({scrollTop:r},400,function(){EliminarItemPropietario(elemsSelected[indexList])})):MessageBox(t.titulomsje,t.contenidomsje,"[Aceptar]",function(){$("#btnLimpiarSeleccion").trigger("click")}))},error:function(e){console.log(e)}})}$(function(){var e=getParameterByName("screenmode");"search"==e?($("#btnSelectAll").addClass("oculto"),$("#btnSelectOne").on("click",function(e){e.preventDefault(),SeleccionarPropietario()}),ListarPropietarios("1")):"propietario"==e?SetTabByDefault($("#hdTipoPropietario").val()):($("#btnSelectOne").addClass("oculto"),ListarPropietarios("1")),$("#btnCustomBack").on("click",function(t){t.preventDefault(),"search"==e?window.parent.closePanelPropietario():window.top.showDesktop()}),$("#pnlForm > .title-window").on("click","button",function(e){e.preventDefault();var t=$(this).attr("data-target"),o=$(this).attr("data-tipopropietario");$(this).siblings(".btn-success").removeClass("btn-success"),$(this).addClass("btn-success"),$("#pnlForm > .divContent section.tab-principal").hide(),$(t).show(),$("#hdTipoPropietario").val(o)}),$("#txtSearchPropietario").keydown(function(e){if(e.keyCode==$.ui.keyCode.ENTER)return $("#btnSearchPropietario").trigger("click"),!1}).keypress(function(e){if(e.keyCode==$.ui.keyCode.ENTER)return!1}),$("#btnSearchPropietario").on("click",function(e){e.preventDefault(),$("#btnLimpiarSeleccion").trigger("click"),paginaPropietario=1,ListarPropietarios("1")}),$("#gvDatos").on("click",".dato",function(t){t.preventDefault();var o=$(this).find("input:checkbox");"search"==e?($("#gvDatos input:checkbox").removeAttr("checked"),$(this).siblings(".selected").removeClass("selected"),$(this).addClass("selected"),o.attr("checked",""),$("#btnSelectOne").removeClass("oculto")):$(this).hasClass("selected")?($(this).removeClass("selected"),o.removeAttr("checked"),0==$("#gvDatos .dato.selected").length?($("#btnNuevo, #btnUploadExcel, #btnSelectAll").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnEditar, #btnDetalleFromList, #btnSendMail, #btnEliminar").addClass("oculto")):1==$("#gvDatos .dato.selected").length&&$("#btnLimpiarSeleccion, #btnEditar, #btnDetalleFromList").removeClass("oculto")):($(this).addClass("selected"),o.attr("checked",""),$("#btnNuevo, #btnUploadExcel").addClass("oculto"),$("#btnLimpiarSeleccion, #btnEliminar, #btnSendMail").removeClass("oculto"),1==$("#gvDatos .dato.selected").length?$("#btnEditar, #btnDetalleFromList").removeClass("oculto"):$("#btnEditar, #btnDetalleFromList").addClass("oculto"))}),$("#btnDetalleFromList").on("click",function(e){e.preventDefault(),GoToDetalle()}),$("#btnSendMail").on("click",function(e){e.preventDefault();var t=$("#gvDatos .selected").map(function(){return this.getAttribute("data-email")}).get().join(";");openModalCallBack("#modalEmail",function(){$("#ifrEmail").attr("src","index.php?pag=admin&subpag=email&para="+t)})}),$("#btnNuevo, #btnEditar").on("click",function(e){e.preventDefault(),LimpiarForm(),GoToEdit()}),$("#btnBackToListFromForm").add("#btnBackToListFromDetalle").on("click",function(t){t.preventDefault(),"btnBackToListFromForm"==$(this).attr("id")?$("#pnlForm").fadeOut(400,function(){$("#pnlListado").fadeIn(400,function(){})}):$("#pnlDetalle").fadeOut(400,function(){$("#pnlListado").fadeIn(400,function(){})}),"search"!=e&&$("#btnLimpiarSeleccion").trigger("click")}),$("#btnCancelar").on("click",function(e){e.preventDefault(),closeCustomModal("#modalRegistro")}),$("#btnNuevoDetalle").on("click",function(e){e.preventDefault(),MostrarModalPorTab()}),$("#pnlInfoUbigeoNatural").add("#pnlInfoUbigeoEmpresa").on("click",function(e){e.preventDefault(),openModalCallBack("#modalUbigeo",function(){precargaExp("#modalUbigeo",!0),ListarUbicacion("#ddlDepartamento","1","0",function(){ListarUbicacion("#ddlProvincia",$("#ddlDepartamento").val(),"0",function(){ListarUbicacion("#ddlDistrito",$("#ddlProvincia").val(),"0",function(){precargaExp("#modalUbigeo",!1)})})})})}),$("#ddlDepartamento").on("change",function(e){e.preventDefault(),precargaExp("#modalUbigeo",!0),ListarUbicacion("#ddlProvincia",$(this).val(),"0",function(){ListarUbicacion("#ddlDistrito",$("#ddlProvincia").val(),"0",function(){precargaExp("#modalUbigeo",!1)})})}),$("#ddlProvincia").on("change",function(e){e.preventDefault(),precargaExp("#modalUbigeo",!0),ListarUbicacion("#ddlDistrito",$(this).val(),"0",function(){precargaExp("#modalUbigeo",!1)})}),$("#btnAplicarUbigeo").on("click",function(e){e.preventDefault();var t="0",o="";t=$("#ddlDistrito").val(),o="Perú/"+$("#ddlDepartamento option:selected").text()+"/"+$("#ddlProvincia option:selected").text()+"/"+$("#ddlDistrito option:selected").text(),setUbigeo(t,o)}),$("#pnlInfoUbigeoContacto").on("click",function(e){e.preventDefault(),openModalCallBack("#modalUbigeo",function(){})}),$("#fileUploadImage").change(function(){var e,t="",o="",a="",i=new FileReader;e=this.files[0],i.readAsDataURL(e),t=e.name,o=e.size,a=e.type,i.onload=function(e){$("#imgFoto").attr("src",e.target.result),$("#hdFoto").val(t),$("#btnResetImage").removeClass("oculto")}}),$("#btnResetImage").on("click",function(e){e.preventDefault(),$(this).addClass("oculto"),$("#imgFoto").attr("src",$("#imgFoto").attr("data-src"))}),$("#gvUbigeo").on("click",".panel-info",function(e){e.preventDefault();var t="0",o="";t=$(this).attr("data-idubigeo"),o=$(this).find(".descripcion").text(),setUbigeo(t,o)}),$("#txtSearchUbigeo").on("keyup",function(e){ListarUbigeo()}),$("#form1").validate({lang:"es",showErrors:showErrorsInValidate,submitHandler:EnvioAdminDatos}),$("#btnGuardar").on("click",function(e){$("#hdLegal").val("LEGAL"),GuardarDatos()}),$("#btnAceptarTerminos").on("click",function(e){$("#hdLegal").val(""),GuardarDatos()}),$("#btnEliminar").on("click",function(e){e.preventDefault(),confirma=confirm("¿Desea eliminar los elementos seleccionados?"),confirma&&EliminarPropietario()}),$("#btnHideConstructora").on("click",function(e){e.preventDefault(),$("#pnlConstructora").fadeOut(400,function(){})}),$("#btnLimpiarSeleccion").on("click",function(e){e.preventDefault(),$("#hdIdPrimary").val("0"),$("#gvDatos .dato.selected").removeClass("selected"),$("#gvDatos input:checkbox:checked").removeAttr("checked"),$("#btnNuevo, #btnUploadExcel, #btnSelectAll").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnDetalleFromList, #btnSendMail, #btnEditar, #btnEliminar").addClass("oculto")}),$("#gvDatos > .items-area").on("scroll",function(){var e=0;$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&(e=Number($("#hdPagePropietario").val()),ListarPropietarios(e))}),$("#btnUploadExcel").on("click",function(e){e.preventDefault(),openCustomModal("#modalUploadExcel")}),$(".droping-air .file-import").on({dragenter:function(e){e.stopPropagation(),e.preventDefault()},dragover:function(e){e.stopPropagation(),e.preventDefault()},change:function(e){e.preventDefault(),prepareImport(this.files)},drop:function(e){e.preventDefault();var t=e.originalEvent.dataTransfer.files;prepareImport(t)}}),$("#btnCancelarSubida").on("click",function(e){e.preventDefault(),cancelImport()}),$("#btnSubirDatos").on("click",function(e){e.preventDefault(),executeImport()}),$("#btnSelectAll").on("click",function(e){e.preventDefault(),$(this).addClass("oculto"),$("#gvDatos .dato").addClass("selected"),$("#gvDatos input:checkbox").attr("checked",""),$("#btnNuevo, #btnDetalleFromList, #btnSendMail, #btnUploadExcel, #btnEditar").addClass("oculto"),$("#btnLimpiarSeleccion, #btnEliminar").removeClass("oculto")})});var indexList=0,elemsSelected,fileValue=!1,progress=0,progressError=!1,progressSuccess=!1,paginaPropietario=1;