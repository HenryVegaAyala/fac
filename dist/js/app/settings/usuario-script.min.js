function ListarRedes(e,t){$.ajax({url:"services/redes/redes-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"4",id:t,criterio:""}}).done(function(t){var a=0,o=0,i="";if(o=t.length,o>0)for(a=0;a<o;a++)i+='<li><a data-idred="'+t[a].tm_idred+'" data-codigo="'+t[a].tm_codigo+'" href="#"><h2>'+t[a].tm_nombre+"</h2></a></li>";$(e).html(i),"#ulTiendasGuia"!=e&&$(e).find("li:first-child > a").trigger("click")}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}function ShowPanelPersona(){$("#pnlSearchPersona").fadeIn(400,function(){BuscarPersona("1")})}function ShowPanelProyecto(){$("#pnlSearchProyecto").fadeIn(400,function(){BuscarProyecto("1")})}function clearImagenForm(){$("#fileUploadImage").replaceWith($("#fileUploadImage").val("").clone(!0)),$("#imgFoto").attr({src:"dist/img/user-nosetimg-233.jpg","data-src":"dist/img/user-nosetimg-233.jpg"}),$("#btnResetImage").addClass("oculto")}function addValidFormRegister(){}function removeValidFormRegister(){}function GetDataById(e){$.ajax({type:"GET",url:"services/usuarios/usuarios-search.php",cache:!1,dataType:"json",data:"tipobusqueda=2&criterio=&idusuario="+e,success:function(e){var t=0,a="";t=e.length,t>0&&(a=e[0].tm_foto,$("#hdIdPrimary").val(e[0].tm_idusuario),$("#txtNombre").val(e[0].tm_login),$("#txtNombres").val(e[0].tm_nombres),$("#txtApellidos").val(e[0].tm_apellidos),$("#txtClave").val(e[0].tm_clave),$("#txtTelefono").val(e[0].tm_telefono),$("#txtEmail").val(e[0].tm_correousuario),$("#hdFoto").val(a),$("#ddlPerfil").val(e[0].tm_idperfil),setPersona(e[0].tm_idpersona,e[0].persona),setProyecto(e[0].tm_idproyecto,e[0].proyecto),clearImagenForm(),"no-set"!=a&&$("#imgFotoUsuario").attr({src:a,"data-src":a}))}})}function setPersona(e,t,a){$("#hdIdPersona").val(e),$("#hdTipoDataPersona").val("04"),$("#pnlInfoPersonal").attr("data-idpersona",e),$("#pnlInfoPersonal .descripcion").text(t),$(".borrar-persona").removeClass("hide"),"undefined"!=typeof a&&($("#txtNombres").val(a.getAttribute("data-nombres")),$("#txtApellidos").val(a.getAttribute("data-apellidos")),$("#txtEmail").val(a.getAttribute("data-email")),$("#txtTelefono").val(a.getAttribute("data-telefono"))),$("#pnlSearchPersona").is(":visible")&&$("#pnlSearchPersona").fadeOut("400",function(){})}function setProyecto(e,t,a){$("#hdIdProyecto").val(e),$("#pnlInfoProyecto__Usuario").attr("data-idproyecto",e),$("#pnlInfoProyecto__Usuario .descripcion").text(t),$(".borrar-proyecto").removeClass("hide"),$("#pnlSearchProyecto").is(":visible")&&$("#pnlSearchProyecto").fadeOut("400",function(){})}function BuscarDatos(e){var t="#gvDatos .items-area",a="0";precargaExp("#gvDatos",!0),"61"==$("#hdIdPerfil").val()&&""!=$("#hdIdProyecto_Sesion").val()&&(a=$("#hdIdProyecto_Sesion").val()),"0"==a?tipobusqueda="1":tipobusqueda=a,$.ajax({type:"GET",url:"services/usuarios/usuarios-search.php",cache:!1,dataType:"json",data:"tipobusqueda="+tipobusqueda+"&idcargo="+$("#ddlCargo").val()+"&criterio="+$("#txtSearch").val()+"&pagina="+e,success:function(a){var o=0,i=a.length,r="",n="";if(i>0){for(;o<i;)iditem=a[o].tm_idusuario,foto=a[o].tm_foto,n="1"==a[o].activo?"bg-gray-glass":"bg-amber",r+='<a href="#" class="list dato '+n+'" data-id="'+iditem+'">',r+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+iditem+'" />',r+='<div class="list-content">',r+='<div class="data">',r+="<aside>",r+="no-set"==foto?'<i class="fa fa-user"></i>':'<img src="'+foto+'" />',r+="</aside>",r+='<main><p class="fg-darker"><strong>'+a[o].tm_login+"</strong>Email: "+(null==a[o].tm_correousuario?"":a[o].tm_correousuario)+"</p>",r+="</main></div></div>",r+="</a>",++o;"1"==e?$(t).html(r):$(t).append(r),$("#hdPage").val(Number($("#hdPage").val())+1),$(t).on("scroll",function(){if($(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight){var e=$("#hdPage").val();BuscarDatos(e)}})}else"1"==e&&$(t).html("<h2>No se encontraron resultados.</h2>");precargaExp("#gvDatos",!1)}})}function BackToList(){removeValidFormRegister(),$("#btnNuevo, #btnUploadExcel").removeClass("oculto"),$("#btnGuardar, #btnCancelar").addClass("oculto"),$("#pnlForm").fadeOut(500,function(){$("#pnlConfigMenu").fadeIn(500,function(){$("#txtSearch").focus()})})}function EnvioAdminDatos(e){var t=document.getElementById("fileUploadImage"),a=t.files[0],o=new FormData;o.append("btnGuardar","btnGuardar"),o.append("archivo",a);var i=$("#form1 :input").serializeArray();$.each(i,function(e,t){o.append(t.name,t.value)}),$.ajax({type:"POST",url:"services/perfil/perfilmenu-post.php",cache:!1,contentType:!1,processData:!1,dataType:"json",data:o,success:function(e){MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){if(Number(e.rpta)>0){var t=getParameterByName("screenmode");"usuarios"!=t&&($("#hdPage").val("1"),$("#hdPageActual").val("1"),$("#btnEditar, #btnEliminar").addClass("oculto"),$("#btnNuevo").removeClass("oculto"),limpiarSeleccionados(),BuscarDatos("1"),clearImagenForm(),closeCustomModal("#modalUsuarioReg"))}})}})}function GuardarDatos(){$("#form1").submit()}function ListarPerfiles(e){var t="";"DATA"==e&&(t="#pnlPermisos .gp-header"),""!=t&&precargaExp(t,!0),$.ajax({type:"GET",url:"services/perfil/perfil-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",idperfil:"0",idusuario:""},success:function(a){var o=0,i=0,r="",n="";if(i=a.length,"DATA"==e?n="#gvPerfil":"FIELD"==e&&(n="#ddlPerfil"),i>0){for(;o<i;)"DATA"==e?(r+='<div data-idperfil="'+a[o].tm_idperfil+'" class="tile dato double" data-click="transform">',r+='<div class="tile-content">',r+='<div class="text-right padding10 ntp">',r+='<h3 class="fg-gray">'+a[o].tm_nombre+"</h3>",r+="</div>",r+="</div>",r+='<div class="brand">',r+='<div class="label fg-darker">C&oacute;digo: '+a[o].tm_codigo+"</div>",r+="</div>",r+="</div>",r+="</div>"):"FIELD"==e&&(r+='<option value="'+a[o].tm_idperfil+'">'+a[o].tm_nombre+"</option>"),++o;"DATA"==e?$(n).html(r).find(".tile:first").trigger("click"):"FIELD"==e&&$(n).html(r)}else"DATA"==e?$(n).html("<h2>No se encontraron resultados.</h2>"):"FIELD"==e&&$(n).html("");""!=t&&precargaExp(t,!0)}})}function LimpiarFormUsuario(){var e="",t="";e="#pnlConfigUser > .sectionHeader button",t="#pnlConfigUser > .sectionContent section",$("#tablePerfil tbody tr").remove(),$(e).removeClass("btn-success"),$(e).first().addClass("btn-success"),$(t).hide(),$(t).first().show()}function LimpiarFormPerfil(){$("#hdIdPerfil").val("0"),$("#txtNombrePerfil").val(""),$("#txtDescripcionPerfil").val(""),$("#txtAbreviaturaPerfil").val("")}function GetPerfil(e){$.ajax({type:"GET",url:"services/perfil/perfil-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"2",idperfil:e},success:function(e){var t=0;t=e.length,t>0&&($("#hdIdPerfil").val(e[0].tm_idperfil),$("#txtNombrePerfil").val(e[0].tm_nombre),$("#txtDescripcionPerfil").val(e[0].tm_descripcion),$("#txtAbreviaturaPerfil").val(e[0].tm_abreviatura))}})}function GuardarPerfil(){$.ajax({type:"POST",url:"services/perfil/perfilmenu-post.php",cache:!1,dataType:"json",data:"fnPost=fnPost&btnGuardarPerfil=btnGuardarPerfil&hdIdPerfil="+$("#hdIdPerfil").val()+"&"+$("#modalPerfil input:text, #modalPerfil textarea").serialize(),success:function(e){e.rpta&&MessageBox("Datos guardados","La operaci&oacute;n se complet&oacute; correctamente.","[Aceptar]",function(){closeCustomModal("#modalPerfil"),ListarPerfiles("DATA"),ListarPerfiles("FIELD")})}})}function EliminarPerfil(){var e="0";e=$("#gvPerfil .tile.selected").attr("data-idperfil"),$.ajax({type:"POST",url:"services/perfil/perfilmenu-post.php",cache:!1,dataType:"json",data:"fnPost=fnPost&btnEliminarPerfil=btnEliminarPerfil&hdIdPerfil="+e,success:function(e){e.rpta&&MessageBox(e.titulomsje,e.contenidomensaje,"[Aceptar]",function(){ListarPerfiles("DATA"),ListarPerfiles("FIELD")})}})}function AplicarPerfil(){var e="0",t="";e=$("#gvPerfil .tile.selected").attr("data-idperfil"),t=$.map($("#tableMenu tbody input:checkbox:checked"),function(e,t){return e.value}).join(","),$.ajax({type:"POST",url:"services/perfil/perfilmenu-post.php",cache:!1,dataType:"json",data:{fnPost:"fnPost",btnAplicarPerfil:"btnAplicarPerfil",hdIdPerfil:e,listIdMenu:t},success:function(t){t.rpta&&MessageBox(t.titulomsje,t.contenidomensaje,"[Aceptar]",function(){ListarOpcionesMenu(e)})}})}function limpiarSeleccionados(){$(".listview .selected").removeClass("selected"),$(".listview .list input:checkbox").removeAttr("checked")}function EliminarDatos(){var e=$("#form1 input[type!=text]").serialize()+"&btnEliminar=btnEliminar";precargaExp(".page-region",!0),$.ajax({type:"POST",url:"services/perfil/perfilmenu-post.php",cache:!1,dataType:"json",data:e,success:function(e){precargaExp(".page-region",!1),MessageBox(e.titulomsje,e.contenidomsje,"[Aceptar]",function(){Number(e.rpta)>0&&($("#btnEditar, #btnEliminar, #btnLimpiarSeleccion").addClass("oculto"),$("#btnNuevo").removeClass("oculto"),limpiarSeleccionados(),BuscarDatos("1"))})}})}function ListarOpcionesMenu(e){$("#chkAllMenu")[0].checked=!1,precargaExp("#tableMenu .ibody",!0),$.ajax({type:"GET",url:"services/menu/menu-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"CONFIG",idperfil:e},success:function(e){var t=0,a="",o="";t=e.length,o="#tableMenu tbody",t>0?(a=treeMenu(e,0,0),$(o).html(a)):$(o).html("<h2>No se encontraron resultados.</h2>"),precargaExp("#tableMenu .ibody",!1)}})}function treeMenu(e,t,a){var o="",i="";for(var r in e)e[r].tm_idmenuref==t&&(o=0==e[r].td_idperfilmenu?"":' checked=""',i+="<tr>",i+='<td style="width:20px;">',i+='<div class="input-control checkbox" data-role="input-control">',i+="<label>",i+='<input name="hdIdMenu[]" type="checkbox" value="'+e[r].tm_idmenu+'"'+o+" />",i+='<span class="check"></span>',i+="</label></div>",i+='<input type="hidden"  value="'+e[r].td_idperfilmenu+'" />',i+="</td><td>"+e[r].tm_nombre+"</td></tr>",i+=treeMenu(e,e[r].tm_idmenu,a));return i}function BuscarPersona(e){var t="#gvPersona .items-area";precargaExp("#gvPersona",!0),$.ajax({type:"GET",url:"services/propietario/propietario-search.php",cache:!1,dataType:"json",data:"criterio="+$("#txtSearchPersona").val()+"&pagina="+e,success:function(a){var o=0,i=a.length,r="";if(i>0){for(;o<i;){var n=a[o].tm_idtipopropietario,s=a[o].tm_foto;r+='<a href="#" ',r+='data-nombres="'+a[o].tm_nombres+'" ',r+='data-apellidos="'+a[o].tm_apepaterno+" "+a[o].tm_apematerno+'" ',r+='data-email="'+a[o].tm_email+'" ',r+='data-telefono="'+a[o].tm_telefono+'" ',r+='class="list dato bg-gray-glass bg-cyan" data-idpropietario="'+n+'" data-tipopropietario="'+a[o].tm_iditc+'">',r+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+n+'" />',r+='<div class="list-content pos-rel">',r+='<div class="data">',r+="<aside>",r+="no-set"==s?'<i class="fa fa-user"></i>':'<img src="'+s+'" />',r+="</aside>",r+='<main><p class="fg-white"><span class="descripcion">'+a[o].descripcion+'</span></p><p class="fg-white">Tel&eacute;fono: '+a[o].tm_telefono+' - Direcci&oacute;n: <span class="direccion">'+a[o].tm_direccion+'</span><br /><span class="docidentidad">'+a[o].tipodoc+": "+a[o].tm_numerodoc+"</span> - Email: "+a[o].tm_email+"</p>",r+="</main></div></div>",r+="</a>",++o}"1"==e?$(t).html(r):$(t).append(r),$("#hdPagePersona").val(Number($("#hdPagePersona").val())+1)}else"1"==e&&$(t).html("<h2>No se encontraron resultados.</h2>");precargaExp("#gvPersona",!1)}})}function BuscarProyecto(e){var t="#gvProyecto .items-area";precargaExp("#gvProyecto",!0),$.ajax({type:"GET",url:"services/condominio/condominio-search.php",cache:!1,dataType:"json",data:"criterio="+$("#txtSearchProyecto").val()+"&pagina="+e,success:function(a){var o=0,i=a.length,r="";if(i>0){for(;o<i;){var n=a[o].idproyecto;r+='<a href="#" data-idproyecto="'+n+'" data-nombre="'+a[o].nombreproyecto+'" ',r+='class="list dato bg-gray-glass bg-cyan">',r+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+n+'" />',r+='<div class="list-content pos-rel">',r+='<div class="data">',r+='<main><p class="fg-white"><span class="descripcion">'+a[o].nombreproyecto+"</span></p>",r+="</main></div></div>",r+="</a>",++o}$("#hdPageProyecto").val(e),"1"==e?$(t).html(r):$(t).append(r)}else"1"==e&&$(t).html("<h2>No se encontraron resultados.</h2>");precargaExp("#gvProyecto",!1)}})}var TipoBusqueda="00";$(function(){$("#fileUploadImage").change(function(){var e,t="",a="",o="",i=new FileReader;e=this.files[0],i.readAsDataURL(e),t=e.name,a=e.size,o=e.type,i.onload=function(e){$("#imgFoto").attr("src",e.target.result),$("#hdFoto").val(t),$("#btnResetImage").removeClass("oculto")}}),$("#btnResetImage").on("click",function(e){e.preventDefault(),$(this).addClass("oculto"),$("#imgFoto").attr("src",$("#imgFoto").attr("data-src"))}),$("#gvPersona > .items-area").on("scroll",function(){var e=0;$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&(e=Number($("#hdPagePropietario").val()),ListarPropietarios(e))}),$("#tablePerfil").on("click","input:checkbox",function(e){$("#tablePerfil input:checkbox").removeAttr("checked"),$(this)[0].checked=!0,$("#hdIdPerfilUsuario").val($(this).val())}),$("#pnlConfigMenu > .sectionHeader").on("click","button",function(e){var t=0,a="";a=$(this).attr("data-target"),$(this).siblings(".btn-success").removeClass("btn-success"),$(this).addClass("btn-success"),$("#pnlConfigMenu > .sectionContent > section").hide(),"#tab1"==a?(t=$("#pnlUsuario .dato.selected").length,$("#btnAplicarPerfil").addClass("oculto"),$("#btnNuevoPerfil, #btnEditarPerfil, #btnEliminarPerfil").addClass("oculto"),t>0?1==t?$("#btnEditar, #btnEliminar, #btnLimpiarSeleccion").removeClass("oculto"):$("#btnEliminar, #btnLimpiarSeleccion").removeClass("oculto"):$("#btnNuevo, #btnUploadExcel").removeClass("oculto")):"#tab2"==a&&($("#btnAplicarPerfil").removeClass("oculto"),$("#gvPerfil .tile").length>0&&$("#btnNuevoPerfil, #btnEditarPerfil, #btnEliminarPerfil").removeClass("oculto"),$("#btnNuevo, #btnLimpiarSeleccion, #btnEditar, #btnEliminar, #btnUploadExcel").addClass("oculto")),$(a).show()}),$("#gvDatos").on("click",".dato",function(e){var t=$(this).find("input:checkbox");e.preventDefault(),$(this).hasClass("selected")?($(this).removeClass("selected"),t.removeAttr("checked"),0==$("#gvDatos .dato.selected").length?($("#btnNuevo, #btnUploadExcel, #btnSelectAll").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnEditar, #btnEliminar").addClass("oculto")):1==$("#gvDatos .dato.selected").length&&$("#btnLimpiarSeleccion, #btnEditar").removeClass("oculto")):($(this).addClass("selected"),t.attr("checked",""),$("#btnNuevo, #btnUploadExcel").addClass("oculto"),$("#btnLimpiarSeleccion, #btnEliminar").removeClass("oculto"),1==$("#gvDatos .dato.selected").length?$("#btnEditar").removeClass("oculto"):$("#btnEditar").addClass("oculto"))}),$("#pnlPersona > .sectionHeader").on("click","button",function(e){var t="";t=$(this).attr("data-tipodata"),$("#hdTipoDataPersona").val(t),$(this).siblings(".btn-success").removeClass("btn-success"),$(this).addClass("btn-success"),"02"==t?($("#tabPersona1").hide(),$("#tabPersona2").show(),ListarRedes("#ulRedesGuia","0")):($("#tabPersona2").hide(),$("#tabPersona1").show(),BuscarPersona("1"))}),$(".borrar-persona").on("click",function(e){e.preventDefault(),e.stopPropagation(),$("#hdIdPersona").val("0"),$("#hdTipoDataPersona").val("00"),$("#pnlInfoPersonal").attr("data-idpersona","0"),$("#pnlInfoPersonal .descripcion").text("Elegir persona..."),$(this).addClass("hide")}),$("#gvPersona .items-area").on("click",".list",function(e){var t="0",a="";e.preventDefault(),t=$(this).attr("data-idpropietario"),a=$(this).find("main p .descripcion").text(),setPersona(t,a,this)}),$("#pnlInfoPersonal").on("click",function(e){e.preventDefault(),ShowPanelPersona()}),$("#btnExitPersona").on("click",function(e){e.preventDefault(),$("#pnlSearchPersona").fadeOut(400)}),$(".borrar-proyecto").on("click",function(e){e.preventDefault(),e.stopPropagation(),$("#hdIdProyecto").val("0"),$("#pnlInfoProyecto__Usuario").attr("data-idproyecto","0"),$("#pnlInfoProyecto__Usuario .descripcion").text("Elegir proyecto..."),$(this).addClass("hide")}),$("#gvProyecto .items-area").on("click",".list",function(e){var t="0",a="";e.preventDefault(),t=$(this).attr("data-idproyecto"),a=$(this).find("main p .descripcion").text(),setProyecto(t,a,this)}),$("#pnlInfoProyecto__Usuario").on("click",function(e){e.preventDefault(),ShowPanelProyecto()}),$("#btnExitProyecto").on("click",function(e){e.preventDefault(),$("#pnlSearchProyecto").fadeOut(400)}),$("#ddlCargo").focus().on("change",function(){idreferencia=$(this).val(),LoadPersonal(TipoBusqueda,$(this).val(),"0","1")}),$("#btnCancelar, #btnBackList").on("click",function(){return resetForm("form1"),limpiarSeleccionados(),clearImagenForm(),BackToList(),BuscarDatos("1"),!1}),$("#btnEditar").on("click",function(e){var t=$("#gvDatos .dato.selected").attr("data-id");e.preventDefault(),LimpiarFormUsuario(),openCustomModal("#modalUsuarioReg"),GetDataById(t)}),$("#btnNuevo").on("click",function(e){e.preventDefault(),LimpiarFormUsuario(),openCustomModal("#modalUsuarioReg")}),$("#gvDatos").on("click",function(){$(".filtro").length>0&&($("#btnFilter").removeClass("active"),$(".filtro").slideUp())}),BuscarDatos("1"),$("#txtSearch").on("keydown",function(e){if(e.keyCode==$.ui.keyCode.ENTER)return BuscarDatos("1"),!1}).on("keypress",function(e){if(e.keyCode==$.ui.keyCode.ENTER)return!1}),$("#btnSearch").on("click",function(){return BuscarDatos("1"),!1}),$("#btnFilter").length>0&&$("#btnFilter").on("click",function(){return $(this).hasClass("active")?($(this).removeClass("active"),$(".filtro").slideUp(),$("#txtSearch").focus()):($(this).addClass("active"),$(".filtro").slideDown(),$("#ddlCategoria").length>0&&$("#ddlCategoria").focus()),!1}),$("#btnGuardar").on("click",function(e){GuardarDatos()}),$("#btnEliminar").on("click",function(){return EliminarDatos(),!1}),$("#btnLimpiarSeleccion").on("click",function(){return $(this).addClass("oculto"),$("#btnEditar, #btnEliminar").addClass("oculto"),$("#btnNuevo").removeClass("oculto"),limpiarSeleccionados(),!1}),$("#btnEliminarPerfil").on("click",function(e){e.preventDefault(),EliminarPerfil()}),$("#btnEditarPerfil").on("click",function(e){var t="0";e.preventDefault(),t=$("#gvPerfil .tile.selected").attr("data-idperfil"),LimpiarFormPerfil(),openCustomModal("#modalPerfil"),GetPerfil(t),$("#txtNombrePerfil").focus()}),$("#btnNuevoPerfil").on("click",function(e){e.preventDefault(),LimpiarFormPerfil(),openCustomModal("#modalPerfil"),$("#txtNombrePerfil").focus()}),$("#gvPerfil").on("click",".tile",function(e){var t="0";e.preventDefault(),t=$(this).attr("data-idperfil"),$(this).siblings(".selected").removeClass("selected"),$(this).addClass("selected"),ListarOpcionesMenu(t)}),$("#btnGuardarPerfil").on("click",function(e){e.preventDefault(),GuardarPerfil()}),$("#btnAplicarPerfil").on("click",function(e){e.preventDefault(),AplicarPerfil()}),$("#form1").validate({lang:"es",showErrors:showErrorsInValidate,submitHandler:EnvioAdminDatos}),$("#chkAllMenu").on("click",function(e){var t=$(this)[0].checked,a=$("#tableMenu tbody input:checkbox"),o=a.length;if(o>0)for(var i=0;i<o;i++)a[i].checked=t}),addValidFormRegister(),ListarPerfiles("DATA")});