function addValidFormRegister_DeudaAnterior(){$("#txtImporteCobranza").rules("add",{required:!0,min:1,max:Number($("#hdSaldoDeudaAnterior").val())}),$("#form1").validate().element("#txtImporteCobranza")}function addValidFormRegister_Propiedad(){$("#txtImporteCobranza").rules("add",{required:!0,min:1,max:Number($("#hdSaldoInicial").val())}),$("#form1").validate().element("#txtImporteCobranza")}function addValidFormRegister_Facturacion(){$("#txtImporteCobranza").rules("add",{required:!0,min:1}),$("#form1").validate().element("#txtImporteCobranza")}function removeValidFormRegister(){$("#txtImporteCobranza").rules("remove")}function IniciarForm(){var a=window.top.idproyecto,t=window.top.anho,e=window.top.mes,o=window.top.idbanco,r=window.top.idcuentabancaria;$("#hdIdProyecto").val(a),$("#hdAnho").val(t),$("#hdMes").val(e),GetBanco(o),GetCuentaBancaria(r),ListarConcepto("1","default"),ListarCobranza();var i=new Date,n=i.getFullYear();ListarAnhoProceso(n)}function LimpiarForm(){cancelImport(),$("#ddlMesCobranza")[0].selectedIndex=0,$("#txtNroOperacion").val(""),$("#chkImporteDetallado")[0].checked=!1,$("#txtImporteCobranza").val("0.00"),$("#txtImporteMora").val("0.00")}function prepareImport(a){var t=["jpg","png","gif","jpeg"],e="",o="",r=new FileReader;return fileValue=a[0],o=a[0].name,e=o.split(".").pop().toLowerCase(),$.inArray(e,t)==-1?(MessageBox("Archivo no v&aacute;lido","El tipo de archivo *."+e+" no es compatible","[Aceptar]",function(){}),!1):(r.readAsDataURL(fileValue),console.log(fileValue),void(r.onload=function(a){$(".droping-air .help").text(o),$(".droping-air").addClass("dropped"),$(".droping-air > .icon").css("background","url("+a.target.result+") no-repeat center"),$(".droping-air > .cancel").removeClass("oculto")}))}function cancelImport(){$("#fileImagen").val(""),$(".droping-air .help").text("Seleccione o arrastre un archivo de imagen (*.jpg, .gif, *.png)"),$(".droping-air").removeClass("dropped"),$(".droping-air > .icon").css("background","transparent"),$(".droping-air > .cancel").addClass("oculto"),$("#hdFoto").val("no-set"),fileValue=!1}function ShowPanelProyecto(){$("#pnlProyecto").fadeIn(400,function(){paginaProyecto=1,$("#hdPageProyecto").val("1"),ListarProyectos("1")})}function RegistroPorDefecto(){$.ajax({url:"services/condominio/condominio-search.php",type:"GET",dataType:"json",data:{tipo:"defectoporcuenta"},success:function(a){var t=0,e="0",o="",r="",i="",n="",d="";t=a.length,t>0&&(e=a[0].idproyecto,o=a[0].nombreproyecto,r=a[0].idbanco,i=a[0].nombrebanco,n=a[0].idcuentabancaria,d=a[0].descripcioncuenta,$("#ddlMes").val(a[0].mesproceso),setProyecto(e,o,r,i,n,d))},error:function(a){console.log(a)}})}function RegistroPorDefectoId(a){$.ajax({url:"services/condominio/condominio-search.php",type:"GET",dataType:"json",data:{tipo:"defectoporcuenta",tipobusqueda:a},success:function(a){var t=0,e="0",o="",r="",i="",n="",d="";t=a.length,t>0&&(e=a[0].idproyecto,o=a[0].nombreproyecto,r=a[0].idbanco,i=a[0].nombrebanco,n=a[0].idcuentabancaria,d=a[0].descripcioncuenta,$("#ddlMes").val(a[0].mesproceso),setProyecto(e,o,r,i,n,d))},error:function(a){console.log(a)}})}function setProyecto(a,t,e,o,r,i){$("#hdIdProyecto").val(a),$("#pnlInfoProyecto").attr("data-idproyecto",a),$("#pnlInfoProyecto .info .descripcion").text(t),$("#hdIdBanco").val(e),$("#hdIdCuentaBancaria").val(r),$("#lblBanco").text(o),$("#lblCuentaBancaria").text(i),$("#pnlProyecto").fadeOut("400",function(){var a=new Date,t=a.getFullYear();ListarAnhoProceso(t)})}function setConcepto(a,t){$("#hdIdConcepto").val(a),$("#pnlInfoConcepto").attr("data-idconcepto",a),$("#pnlInfoConcepto .info .descripcion").text(t),$("#pnlDatosFiltro").fadeOut("400",function(){})}function ListarProyectos(a){var t="#gvProyecto .items-area";precargaExp("#gvProyecto",!0),$.ajax({type:"GET",url:"services/condominio/condominio-search.php",cache:!1,dataType:"json",data:"tipo=asignacionporcuenta&criterio="+$("#txtSearchFiltro").val()+"&pagina="+a,success:function(e){var o=0,r=0,i="";if(r=e.length,r>0){for(;o<r;)iditem=e[o].idproyecto,i+='<a href="#" class="list dato without-foto bg-gray-glass bg-cyan g200" data-idproyecto="'+iditem+'" data-tipoproyecto="'+e[o].tipoproyecto+'" data-nombre="'+e[o].nombreproyecto+'" data-mes="'+e[o].mesproceso+'" data-anho="'+e[o].anhoproceso+'" data-idbanco="'+e[o].idbanco+'" data-nombrebanco="'+e[o].nombrebanco+'"  data-idcuentabancaria="'+e[o].idcuentabancaria+'" data-descripcioncuenta="'+e[o].descripcioncuenta+'">',i+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+iditem+'" />',i+='<div class="list-content pos-rel">',i+='<div class="data">',i+='<main><p class="fg-white"><span class="descripcion">'+e[o].nombreproyecto+"</span></p>",i+="</main></div></div>",i+="</a>",++o;paginaProyecto+=1,$("#hdPageProyecto").val(paginaProyecto),"1"==a?$(t).html(i):$(t).append(i)}else"1"==a&&$(t).html("<h2>No hay datos.</h2>");precargaExp("#gvProyecto",!1)}})}function ListarAnhoProceso(a){$.ajax({url:"services/proceso/proceso-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"ANHO",idproyecto:$("#hdIdProyecto").val()},success:function(t){var e=0,o=0,r="",i="";if(o=t.length,o>0)for(;e<o;)i=a==t[e].per_ano?' selected="selected"':"",r+="<option"+i+' value="'+t[e].per_ano+'">'+t[e].per_ano+"</option>",++e;else r+='<option value="0">NO HAY PROCESOS RELACIONADOS CON EL PROYECTO SELECCIONADO</option>';$("#ddlAnho").html(r),$("#ddlAnhoCobranza").html(r),paginaGenFacturacion=1,ListarPropiedades("1")},error:function(a){console.log(a)}})}function VerImpresion(a){$("#pnlImpresionFactura").fadeIn(400,function(){var t=new FormData;precargaExp("#pnlImpresionFactura",!0),t.append("btnGenerarPDF","btnGenerarPDF"),t.append("tipoGen","EXPORTACION"),t.append("ddlAnho",a.getAttribute("data-anho")),t.append("ddlMes",a.getAttribute("data-mes")),t.append("hdIdFacturacion",a.getAttribute("data-idfacturacion")),t.append("hdIdProyecto",$("#hdIdProyecto").val()),t.append("hdIdPropietario",a.getAttribute("data-idpropietario")),t.append("hdIdPropiedad",$("#hdIdPropiedad").val()),t.append("txtCodigo",a.getAttribute("data-codigo")),t.append("txtFechaEmision",a.getAttribute("data-fechaemision")),t.append("txtFechaVencimiento",a.getAttribute("data-fechavencimiento")),t.append("txtFechaTope",a.getAttribute("data-fechatope")),t.append("txtRatio",a.getAttribute("data-ratio")),t.append("txtSimboloMoneda",a.getAttribute("data-simbolomoneda")),t.append("txtTotalImporte",a.getAttribute("data-importefacturado")),$.ajax({url:"services/facturacion/facturacion-post.php",type:"POST",dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(t){precargaExp("#pnlImpresionFactura",!1),$("#ifrImpresionFactura").attr("src",a.getAttribute("href"))},error:function(a){console.log(a)}})})}function ListarFacturacion(a){var t="#tableFacturacion";precargaExp(t,!0),$.ajax({url:"services/facturacion/facturacion-search.php",type:"GET",dataType:"json",cache:!1,data:{tipo:"FACTURACIONPROP__SALDOMES",idproyecto:$("#hdIdProyecto").val(),anho:$("#ddlAnho").val(),mes:$("#hdMes").val(),idpropiedad:a},success:function(a){var e=0,o="",r=0,i=a.length;$("#hdIdProyecto").val();if(i>0){for(;e<i;){var n=a[e].tm_importefacturado,d=a[e].td_importesaldo;o+='<tr data-idfacturacion="'+a[e].tm_idfacturacion+'" data-anho="'+a[e].tm_per_ano+'" data-mes="'+a[e].tm_per_mes+'" data-importefacturado="'+n+'" data-importesaldo="'+d+'" class="'+a[e].colorestado+'">';var c="null"==a[e].tm_codigo?"COD. PROV:"+a[e].tm_idfacturacion:a[e].tm_codigo;o+="<td>"+c+"</td>",o+="<td>"+convertDate(a[e].tm_fechavencimiento)+"</td>",o+="<td>"+convertDate(a[e].tm_fechatope)+"</td>",o+="<td>"+arrMeses[parseInt(a[e].tm_per_mes)-1]+"</td>",o+="<td>"+a[e].tm_per_ano+"</td>",o+="<td>"+a[e].simbolomoneda+"</td>",o+='<td class="importe">'+n+"</td>",o+='<td class="saldo">'+d+"</td>",o+="</tr>",r+=Number(a[e].td_importesaldo),++e}$(t+" tbody").html(o)}else $(t+" tbody").html("");$("#lblSaldoTotal_EsteAnho").text(r.toFixed(2)),precargaExp(t,!1)},error:function(a){console.log(a)}})}function ListarPropiedades(a){var t="#gvPropiedad .items-area";precargaExp("#gvPropiedad",!0),$.ajax({type:"GET",url:"services/propiedad/propiedad-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"1",id:$("#hdIdProyecto").val(),idtipopropiedad:$("#ddlTipoPropiedadFiltro").val(),criterio:$("#txtSearchPropiedad").val(),pagina:a},success:function(e){var o=0,r=0,i="",n="",d="",c="",l="",s="",p="",u="",h="";$("#hdTipoValoracion").val();if(r=e.length,r>0){for(;o<r;)d=e[o].idpropiedad,c=e[o].idtipopropiedad,null!=e[o].numerodoc&&(s=0==e[o].numerodoc.trim().length?"":e[o].numerodoc+" "),p=null!=e[o].descrippersona?0==e[o].descrippersona.trim().length?"(EN BLANCO)":e[o].descrippersona:"(EN BLANCO)","DPT"==c?n=" blue-grey lighten-2":"DEP"==c?n=" grey darken-1":"EST"==c?n=" blue-grey":"TIE"==c&&(n=" blue-grey darken-1"),l=Number(e[o].saldoinicial)>0?"bg-dark":"bg-green","0"==e[o].cantidadrelaciones?0==e[o].propiedadpadre.length?(u="SIN PROPIEDADES RELACIONADAS",h=" bg-gray"):(u=e[o].propiedadpadre,h=" bg-green"):(u="VER PROPIEDADES RELACIONADAS",h=" bg-green"),i+='<div class="tile dato double almost-double-vertical shadow '+n+'" ',i+='data-idpropiedad="'+d+'" ',i+='data-idtipopropiedad="'+c+'" ',i+='data-descripcion="'+e[o].descripcionpropiedad+'" ',i+='data-areasintechar="'+e[o].areasintechar+'" ',i+='data-areatechada="'+e[o].areatechada+'" ',i+='data-area="'+e[o].area+'" ',i+='data-idclasepropiedad="'+e[o].idclasepropiedad+'" ',i+='data-idpropietario="'+e[o].idpersona+'" ',i+='data-relaciones="'+e[o].cantidadrelaciones+'" ',i+='data-saldoinicial="'+e[o].saldoinicial+'" ',i+='title="'+s+p+'">',i+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+d+'" />',i+='<div class="place-top-left">',i+='<h5 class="fg-white">'+e[o].torre+"</h5>",i+="</div>",i+='<div class="inputInItem padding20 bg-white shadow row hide">',i+='<div class="grid fluid"><div class="row">',i+='<div class="span6">',i+='<div class="inputSaldoInicial">',i+='<label class="black-text">Saldo Inicial</label>',i+='<div class="input-control text no-margin" data-role="input-control">',i+='<input type="text" class="fg-black input-saldoinicial" value="'+e[o].saldoinicial+'" />',i+='<button class="btn-clear" tabindex="-1" type="button"></button>',i+="</div>",i+="</div>",i+="</div>",i+='<div class="span6">',i+='<div class="inputRatio hide">',i+='<label class="black-text">Ratio</label>',i+='<div class="input-control text no-margin" data-role="input-control">',i+='<input type="text" class="fg-black input-ratio" value="'+e[o].ratio+'" />',i+='<button class="btn-clear" tabindex="-1" type="button"></button>',i+="</div>",i+="</div>",i+='<div class="inputImporteFijo hide">',i+='<label class="black-text">Importe Fijo</label>',i+='<div class="input-control text no-margin" data-role="input-control">',i+='<input type="text" class="fg-black input-importefijo" value="'+e[o].importefijo+'" />',i+='<button class="btn-clear" tabindex="-1" type="button"></button>',i+="</div>",i+="</div>",i+="</div>",i+="</div></div>",i+="</div>",i+='<div class="tile_true_content">',i+='<div class="tile-content">',i+='<div class="text-right padding10 ntp">',i+='<h3 class="white-text">'+e[o].descripcionpropiedad+"</h3>",i+='<h6 class="padding5 text-ellipsis smaller bg-white text-center fg-dark">'+p+"</h6>",i+='<h6 class="link-relacion padding5 smaller bg-white text-center fg-white'+h+'">'+u+"</h6>",i+="</div>",i+="</div>",i+='<div class="brand"><span class="badge '+l+'">Saldo inicial: S/. '+e[o].saldoinicial+"</span></div>",i+="</div>",i+="</div>",++o;paginaPropiedad+=1,$("#hdPagePropiedad").val(paginaPropiedad),1==a?($(t).html(i),$(t).find(".dato").eq(0).trigger("click")):$(t).append(i)}else 1==a&&$(t).html("<h2>No se encontraron resultados.</h2>");precargaExp("#gvPropiedad",!1)}})}function ListarConcepto(a,t){var e="#gvFiltro",o=e+" .items-area",r="undefined"!=typeof t?t:"lista";precargaExp(e,!0),$.ajax({url:"services/concepto/concepto-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"3",id:"0",criterio:$("#txtSearchFiltro").val(),tipoconcepto:"05",idproyecto:$("#hdIdProyecto").val(),pagina:a}}).done(function(t){var i=0,n=0,d="",c="0";if(n=t.length,n>0){for(;i<n;)c=t[i].tm_idconcepto,d+='<a href="#" class="list dato without-foto bg-gray-glass bg-cyan g200" data-idconcepto="'+c+'" data-nombre="'+t[i].tm_descripcionconcepto+'" data-formula="'+t[i].tm_definicion_formula+'" data-tipovalor="concepto">',d+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+c+'" />',d+='<div class="list-content pos-rel">',d+='<div class="data">',d+='<main><p class="fg-white"><span class="codigo float-left">'+t[i].tm_idconcepto+' -&nbsp;</span><span class="descripcion float-left">'+t[i].tm_descripcionconcepto+"</span></p>",d+="</main></div></div>","1"==t[i].tm_esformula&&(d+='<span class="place-top-right bg-emerald margin10"><h5 class="fg-white padding10 no-margin text-center"><i class="icon-calculate"></i></h5></span>'),d+='<div class="place-bottom-left fg-white">',d+='<div class="tag-descrip bg-darkTeal">TIPO: '+t[i].nomtipoconcepto+"</div>",d+='<div class="tag-descrip bg-emerald">TIPO VALOR: '+t[i].nomtipovalor+"</div>",d+="</div>",d+="</a>",++i;paginaFiltro+=1,$("#hdPage").val(paginaFiltro),"1"==a?$(o).html(d):$(o).append(d),"default"==r&&($("#hdIdConcepto").val(t[0].tm_idconcepto),$("#pnlInfoConcepto").attr("data-idconcepto",t[0].tm_idconcepto),$("#pnlInfoConcepto .info .descripcion").text(t[0].tm_descripcionconcepto))}else"1"==a&&$(o).html("<h2>No hay datos.</h2>");precargaExp(e,!1)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}function ListarCuentaBancaria(){$.ajax({url:"services/cuentabancaria/cuentabancaria-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"3",id:$("#ddlBanco").val(),idproyecto:$("#hdIdProyecto").val()},success:function(a){var t=0,e=0,o="";if(e=a.length,e>0)for(;t<e;)o+='<option value="'+a[t].tm_idcuentabancaria+'">'+a[t].tm_descripcioncuenta+"</option>",++t;else o='<option value="0">No hay cuentas bancarias</option>';$("#ddlCuentaBancaria").html(o)},error:function(a){console.log(a)}})}function ListarCobranza(){precargaExp("#tableCobranza",!0),$.ajax({url:"services/cobranza/cobranza-search.php",type:"GET",dataType:"json",data:{tipo:"COBRANZAS",tipobusqueda:"1",idproyecto:$("#hdIdProyecto").val(),anho:$("#hdAnho").val(),mes:$("#hdMes").val()},success:function(a){var t=0,e=0,o="";if(precargaExp("#tableCobranza",!1),e=a.length,e>0){for(;t<e;)o+='<tr data-idconceptocobranza="'+a[t].td_idconceptocobranza+'">',null!=a[t].descrippersona?nombrepropietario=0==a[t].descrippersona.trim().length?"(EN BLANCO)":a[t].descrippersona:nombrepropietario="(EN BLANCO)",o+='<td style="width: 150px;">'+a[t].tipooperacion+"</td>",o+='<td style="width: 100px;">'+convertDate(a[t].td_fecha)+"</td>",o+="<td>"+nombrepropietario+"</td>",o+='<td style="width: 100px;">'+a[t].descripcionpropiedad+"</td>",o+='<td style="width: 60px;">'+a[t].per_anho+"</td>",o+='<td style="width: 60px;">'+a[t].per_mes+"</td>",o+='<td style="width: 120px;">'+a[t].td_num_operacion+"</td>",o+='<td class="consumo" style="width: 130px;">'+a[t].td_valorconcepto+"</td>",o+='<td style="width: 120px;"><button class="btn btn-primary edit-m" type="button" data-action="edit"><i class="fa fa-edit"></i></button></td>',o+="</tr>",++t;$("#btnSelectAll").removeClass("oculto")}else $("#btnSelectAll").addClass("oculto");$("#tableCobranza tbody").html(o)},error:function(a){console.log(a)}})}function SumaSaldos__OtrosMeses(){$.ajax({url:"services/facturacion/facturacion-search.php",type:"GET",dataType:"json",cache:!1,data:{tipo:"FACTURACIONPROP__SUMADEUDA",idproyecto:$("#hdIdProyecto").val(),anho:$("#ddlAnho").val(),mes:$("#hdMes").val(),idpropiedad:$("#hdIdPropiedad").val()},success:function(a){var t=RedondeoMagico(Number(a.sumadeuda_mes)).toFixed(2);$("#hdSaldoDeudaAnterior").val(t),$("#lblDeudaAnteriorMes").text(t)},error:function(a){console.log(a)}})}function SumaSaldos__OtrosAnhos(){var a=new FormData;a.append("btnSumarSaldo_OtroAnho","btnSumarSaldo_OtroAnho"),a.append("hdIdProyecto",$("#hdIdProyecto").val()),a.append("ddlAnho",$("#ddlAnho").val()),a.append("hdIdPropiedad",$("#hdIdPropiedad").val()),$.ajax({url:"services/cobranza/cobranza-post.php",type:"POST",dataType:"json",cache:!1,contentType:!1,processData:!1,data:a,success:function(a){var t=RedondeoMagico(Number(a.titulomsje)).toFixed(2);$("#lblSaldoTotal_OtrosAnhos").text(t)},error:function(a){console.log(a)}})}function Registrar(){if(!$("#form1").valid())return!1;var a=new FormData,t=[],e="";precargaExp("#modalRegistroCobranza",!0);var o=$("#modalRegistroCobranza :input").serializeArray();if("1"==$("#hdTieneFactura").val()){var r=$("#tableFacturacion__PorCobrar tbody tr"),i=r.length;i>0&&(r.each(function(a,e){t.push({idfacturacion:this.getAttribute("data-idfacturacion"),anho:this.getAttribute("data-anho"),mes:this.getAttribute("data-mes"),importe:this.getElementsByClassName("importe-pagar")[0].value})}),e=JSON.stringify(t))}a.append("btnGuardar","btnGuardar"),a.append("hdIdProyecto",$("#hdIdProyecto").val()),a.append("hdIdPropiedad",$("#hdIdPropiedad").val()),a.append("ddlAnho",$("#hdAnho").val()),a.append("ddlMes",$("#hdMes").val()),a.append("hdFoto",$("#hdFoto").val()),a.append("detalleFacturas",e),a.append("archivo",fileValue),$.each(o,function(t,e){a.append(e.name,e.value)}),$.ajax({url:"services/cobranza/cobranza-post.php",type:"POST",dataType:"json",data:a,cache:!1,contentType:!1,processData:!1,success:function(a){precargaExp("#modalRegistroCobranza",!1),MessageBox(a.titulomsje,a.contenidomsje,"[Aceptar]",function(){"0"!=a.rpta&&(closeCustomModal("#modalRegistroCobranza"),ListarCobranza(),$("#btnAgregarFromFacturacion").addClass("hide"),"0"==$("#hdTieneFactura").val()?(paginaPropiedad=1,ListarPropiedades("1")):(SumaSaldos__OtrosMeses(),ListarFacturacion($("#hdIdPropiedad").val())))})},complete:function(a){t=[]},error:function(a){console.log(a)}})}function ListarPropietario(a,t){var e="#gvPropietario",o="",r="";"propietario"==a?r="services/propietario/propietario-search.php":"inquilino"==a&&(r="services/inquilino/inquilino-search.php"),o=e+" .items-area",precargaExp(o,!0),$.ajax({type:"GET",url:r,cache:!1,dataType:"json",data:"criterio="+$("#txtSearchPropietario").val()+"&pagina="+t,success:function(e){var r=0,i=e.length,n="",d="0";if(i>0){for(;r<i;)d="propietario"==a?e[r].tm_idtipopropietario:e[r].tm_idtipoinquilino,foto=e[r].tm_foto,n+='<a href="#" class="list dato bg-gray-glass bg-cyan" data-idpropietario="'+d+'" data-tipopropietario="'+e[r].tm_iditc+'">',n+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+d+'" />',n+='<div class="list-content pos-rel">',n+='<div class="data">',n+="<aside>",n+="no-set"==foto?'<i class="fa fa-user"></i>':'<img src="'+foto+'" />',n+="</aside>",n+='<main><p class="fg-white"><span class="descripcion">'+e[r].descripcion+'</span></p><p class="fg-white">Tel&eacute;fono: '+e[r].tm_telefono+' - Direcci&oacute;n: <span class="direccion">'+e[r].tm_direccion+'</span><br /><span class="docidentidad">'+e[r].tipodoc+": "+e[r].tm_numerodoc+"</span> - Email: "+e[r].tm_email+"</p>",n+="</main>",n+="</div></div>",n+="</a>",++r;paginaPropietario+=1,$("#hdPagePropietario").val(paginaPropietario),"1"==t?$(o).html(n).find(".dato").eq(0).trigger("click"):$(o).append(n)}else"1"==t&&$(o).html("<h2>No hay datos.</h2>");precargaExp(o,!1)},error:function(a){console.log(a)}})}function ListarResumenCtaCorriente(){var a,t="0",e="0";precargaExp("#tableMaestroCuenta",!0),a=$("#gvPropietario .dato.selected"),t=document.getElementById("hdIdProyecto").value,e=a[0].getAttribute("data-idpropietario"),$.ajax({type:"GET",url:"services/cuentacorriente/cuentacorriente-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"2",idproyecto:t,idpropietario:e},success:function(a){var t=0,e=0,o="";if(precargaExp("#tableMaestroCuenta",!1),e=a.length,e>0)for(;t<e;)o+='<tr data-idmoneda="'+a[t].tm_idmoneda+'">',o+='<td class="text-right">'+a[t].tm_facturado+"</td>",o+='<td class="text-right">'+a[t].tm_cancelado+"</td>",o+='<td class="text-right">'+a[t].tm_saldo+"</td>",o+="</tr>",++t;$("#tableMaestroCuenta tbody").html(o)},error:function(a){console.log(a)}})}function ListarDetalleCtaCorriente(){var a,t="0",e="0",o="0";precargaExp("#tableDetalleCuenta",!0),a=$("#gvPropietario .dato.selected"),e=a[0].getAttribute("data-idpropietario"),t=document.getElementById("hdIdProyecto").value,o=$("#hdAnho").val(),$.ajax({type:"GET",url:"services/cuentacorriente/cuentacorriente-search.php",cache:!1,dataType:"json",data:{idpropietario:e,idproyecto:t,anho:o},success:function(a){var t=0,e=0,o="";if(precargaExp("#tableDetalleCuenta",!1),e=a.length,e>0)for(;t<e;)o+='<tr data-iddtalle="'+a[t].td_idcuentacorriente+'" data-nromes="'+a[t].tm_per_mes+'">',o+="<td>"+a[t].tm_descripcionpropiedad+"</td>",o+="<td>"+a[t].nombremes+"</td>",o+='<td><input type="text" class="facturado inputTextInTable text-right" value="'+a[t].td_importefacturado+'" /></td>',o+='<td><input type="text" class="pagado inputTextInTable text-right" value="'+a[t].td_importepagado+'" /></td>',o+='<td><input type="text" class="saldo inputTextInTable text-right" value="'+a[t].td_importesaldo+'" /></td>',o+="</tr>",++t;$("#tableDetalleCuenta tbody").html(o),$("#tableDetalleCuenta .ibody table").enableCellNavigation()},error:function(a){console.log(a)}})}function GetBanco(a){$("#hdIdBanco").val(a),$.ajax({type:"GET",url:"services/banco/banco-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"2",id:a},success:function(a){var t="Sin banco";a.length>0&&(t=a[0].tm_nombrebanco),$("#lblBanco").text(t)},error:function(a){console.log(a)}})}function GetCuentaBancaria(a){$("#hdIdCuentaBancaria").val(a),$.ajax({type:"GET",url:"services/cuentabancaria/cuentabancaria-search.php",cache:!1,dataType:"json",data:{tipobusqueda:"2",id:a},success:function(a){var t="Sin banco";a.length>0&&(t=a[0].tm_descripcioncuenta),$("#lblCuentaBancaria").text(t)},error:function(a){console.log(a)}})}function CobrarPorDeudaAnterior(){$("#hdTieneFactura").val("0"),$("#txtImporteCobranza").val($("#hdSaldoDeudaAnterior").val()),$("#tableFacturacion__PorCobrar, .colCheckImporteDetallado").addClass("hide"),removeValidFormRegister(),addValidFormRegister_DeudaAnterior(),openCustomModal("#modalRegistroCobranza")}$(function(){$("#tableCobranza").on("click",".edit-m",function(a){a.preventDefault();var t=this.getAttribute("data-action");"edit"==t&&(removeValidFormRegister(),addValidFormRegister_DeudaAnterior(),openCustomModal("#modalRegistroCobranza"))}),$("#txtFechaIni_Filter").mask("99/99/9999"),cargarDatePicker("#txtFechaIni_Filter",function(a,t){}),$("#txtFechaFin_Filter").mask("99/99/9999"),cargarDatePicker("#txtFechaFin_Filter",function(a,t){}),$("#btnCobroDeudaAnterior").on("click",function(a){a.preventDefault(),CobrarPorDeudaAnterior()}),$("#form1").validate({lang:"es",showErrors:showErrorsInValidate}),$("#txtFechaCobranza").mask("99/99/9999"),cargarDatePicker("#txtFechaCobranza",function(a,t){}),$("#chkImporteDetallado").on("change",function(a){habilitarControl("#txtImporteCobranza",!$("#chkImporteDetallado")[0].checked)}),$("#tabGeneralCobranza").on("click","a",function(a){a.preventDefault(),$(this).tab("show")}),$("#tabCobranza").on("click","a",function(a){a.preventDefault(),$(this).tab("show")}),$("#ddlAnho").on("change",function(a){a.preventDefault(),$("#lblTextSaldoAnho").text("Saldo "+$(this).val()),SumaSaldos__OtrosAnhos(),SumaSaldos__OtrosMeses(),ListarFacturacion($("#hdIdPropiedad").val())}),$("#ddlTipoPropiedadFiltro").on("change",function(a){a.preventDefault(),paginaPropiedad=1,ListarPropiedades("1")}),$("#txtSearchPropiedad").keydown(function(a){if(a.keyCode==$.ui.keyCode.ENTER)return $("#btnSearchPropiedad").trigger("click"),!1}).keypress(function(a){if(a.keyCode==$.ui.keyCode.ENTER)return!1}),$("#btnSearchPropiedad").on("click",function(a){a.preventDefault(),paginaPropiedad=1,ListarPropiedades("1")}),$("#txtSearchProyecto").keydown(function(a){if(a.keyCode==$.ui.keyCode.ENTER)return $("#btnSearchProyecto").trigger("click"),!1}).keypress(function(a){if(a.keyCode==$.ui.keyCode.ENTER)return!1}),$("#btnSearchProyecto").on("click",function(a){a.preventDefault(),ListarProyectos("1")}),$("#pnlInfoProyecto").on("click",function(a){a.preventDefault(),ShowPanelProyecto()}),$("#btnHideProyecto").on("click",function(a){a.preventDefault(),$("#pnlProyecto").fadeOut(400,function(){})}),$("#gvProyecto > .items-area").on("scroll",function(){var a=0;$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&(a=Number($("#hdPageProyecto").val()),ListarProyectos(a))}),$("#gvProyecto .items-area").on("click",".dato",function(a){a.preventDefault();var t=this.getAttribute("data-idproyecto"),e=this.getAttribute("data-nombre"),o=this.getAttribute("data-idbanco"),r=this.getAttribute("data-nombrebanco"),i=this.getAttribute("data-idcuentabancaria"),n=this.getAttribute("data-descripcioncuenta");$("#ddlMes").val(this.getAttribute("data-mes")),setProyecto(t,e,o,r,i,n)}),$("#gvPropiedad > .gridview").on("scroll",function(){var a=0;$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&(a=Number($("#hdPageGenFacturacion").val()),ListarPropiedades(a))}),$("#gvPropiedad").on("click",".dato",function(a){a.preventDefault();var t=this.getAttribute("data-idpropiedad"),e=this.getAttribute("data-saldoinicial");$("#gvPropiedad .dato.selected").removeClass("selected"),$(this).addClass("selected"),$("#hdIdPropiedad").val(t),$("#hdSaldoInicial").val(e),$("#btnAgregarFromPropiedad").removeClass("oculto"),SumaSaldos__OtrosMeses(),ListarFacturacion(t)}),$("#tableFacturacion tbody").on("click","tr:not(.bg-green)",function(a){a.preventDefault();this.getAttribute("data-idfacturacion");$(this).hasClass("selected")?($(this).removeClass("selected"),0==$("#tableFacturacion tbody tr.selected").length&&$("#btnAgregarFromFacturacion").addClass("hide")):($(this).addClass("selected"),$("#btnAgregarFromFacturacion").removeClass("hide"))}),$("#pnlInfoConcepto").on("click",function(a){a.preventDefault(),$("#pnlDatosFiltro").fadeIn(400,function(){paginaFiltro=1,ListarConcepto("1")})}),$("#gvFiltro").on("click",".dato",function(a){a.preventDefault();var t=document.getElementById("pnlDatosFiltro"),e=(t.getAttribute("data-tipofiltro"),this.getAttribute("data-idconcepto")),o=this.getAttribute("data-nombre");setConcepto(e,o)}),$("#btnEstadoCuenta").on("click",function(a){a.preventDefault(),openModalCallBack("#modalEstadoCuenta",function(){paginaPropietario=1,ListarPropietario("propietario","1")})}),$("#btnNuevo").on("click",function(a){openCustomModal("#modalCobranza")}),$("#btnAgregarFromPropiedad").on("click",function(a){a.preventDefault(),LimpiarForm(),$("#hdTieneFactura").val("0"),$("#txtImporteCobranza").val($("#hdSaldoInicial").val()),$("#tableFacturacion__PorCobrar, .colCheckImporteDetallado").addClass("hide"),removeValidFormRegister(),addValidFormRegister_Propiedad(),openCustomModal("#modalRegistroCobranza")}),$("#btnAgregarFromFacturacion").on("click",function(a){a.preventDefault(),LimpiarForm(),$("#hdTieneFactura").val("1"),$(".colPeriodo").addClass("hide"),$("#tableFacturacion__PorCobrar, .colCheckImporteDetallado").removeClass("hide");var t=0,e="",o=0,r=$("#tableFacturacion .ibody-content table"),i=r[0],n=i.rows.length;if(!(n>0))return-bootbox.alert("Debe seleccionar una factura para continuar en esta opción."),!1;for(;t<n;){if(i.rows[t].classList.contains("selected")){var d=i.rows[t].getAttribute("data-idfacturacion"),c=i.rows[t].getAttribute("data-anho"),l=i.rows[t].getAttribute("data-mes"),s=i.rows[t].getAttribute("data-importefacturado"),p=i.rows[t].getAttribute("data-importesaldo"),u=i.rows[t].cells[0].innerText,h=i.rows[t].cells[1].innerText,m=i.rows[t].cells[2].innerText,g=i.rows[t].cells[3].innerText,b=i.rows[t].cells[5].innerText;e+='<tr data-idfacturacion="'+d+'" data-anho="'+c+'" data-mes="'+l+'" data-importefacturado="'+s+'" data-importesaldo="'+p+'">',e+='<td style="width: 10%;">'+u+"</td>",e+='<td style="width: 15%;">'+h+"</td>",e+='<td style="width: 15%;">'+m+"</td>",e+='<td style="width: 10%;">'+g+"</td>",e+='<td style="width: 5%;">'+c+"</td>",e+='<td style="width: 15%;" class="importe">'+b+" "+s+"</td>",e+='<td style="width: 15%;" class="importe_saldo">'+b+" "+p+"</td>",e+='<td style="width: 15%;"><input type="text" class="importe-pagar inputTextInTable text-right" value="'+s+'" /></td>',e+="</tr>",o+=Number(s)}++t}$("#tableFacturacion__PorCobrar tbody").html(e),$("#txtImporteCobranza").val(o.toFixed(2)),removeValidFormRegister(),addValidFormRegister_Facturacion(),openCustomModal("#modalRegistroCobranza")}),$("#modalEstadoCuenta > .modal-example-header").on("click","button",function(a){var t="";t=this.getAttribute("data-target"),$(this).siblings(".success").removeClass("success"),$(this).addClass("success"),paginaPropietario=1,ListarPropietario(t,"1")}),$("#gvPropietario > .items-area").on("scroll",function(){var a=0,t=$("#modalEstadoCuenta > .modal-example-header button.success"),e=t.attr("data-target");$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight&&(a=Number($("#hdPagePropietario").val()),ListarPropietario(e,a))}),$("#gvPropietario").on("click",".dato",function(a){a.preventDefault(),$(this).siblings(".selected").removeClass("selected"),$(this).addClass("selected"),ListarResumenCtaCorriente(),ListarDetalleCtaCorriente()}),$("#btnGuardar").on("click",function(a){a.preventDefault(),Registrar()}),$("#btnHideFiltro").on("click",function(a){a.preventDefault(),$("#pnlDatosFiltro").fadeOut(400,function(){})}),$("#txtSearchPropietario").keydown(function(a){if(a.keyCode==$.ui.keyCode.ENTER)return $("#btnSearchPropietario").trigger("click"),!1}).keypress(function(a){if(a.keyCode==$.ui.keyCode.ENTER)return!1}),$("#btnSearchPropietario").on("click",function(a){a.preventDefault();var t=$("#modalEstadoCuenta > .modal-example-header button.success"),e=t.attr("data-target");paginaPropietario=1,ListarPropietario(e,"1")}),$("#ddlBanco").on("change",function(a){a.preventDefault(),ListarCuentaBancaria()}),$(".droping-air").on({dragenter:function(a){a.stopPropagation(),a.preventDefault()},dragover:function(a){a.stopPropagation(),a.preventDefault()},change:function(a){a.preventDefault(),prepareImport(this.files)},drop:function(a){a.preventDefault();var t=a.originalEvent.dataTransfer.files;prepareImport(t)}},".file-import"),$(".droping-air .cancel").on("click",function(a){a.preventDefault(),cancelImport()}),$("#tableFacturacion tbody").on("click","a",function(a){return a.preventDefault(),VerImpresion(this),!1}),$("#btnHideImpresion").on("click",function(a){a.preventDefault(),$("#pnlImpresionFactura").fadeOut(400)})});var paginaFiltro=1,paginaProyecto=1,paginaPropiedad=1,paginaGenFacturacion=1,paginaPropietario=1,arrMeses=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],o={38:"up",40:"bottom",37:"prev",39:"next"},$card,fileValue=!1;