function IniciarForm(){var a=window.top.idproyecto,o=window.top.anho,t=window.top.mes;$("#hdIdProyecto").val(a),$("#hdAnho").val(o),$("#hdMes").val(t),ListarLiquidacion(),ObtenerTotal_Cobranza(a,o,t),ObtenerTotal_Gasto(a,o,t)}function setProyecto(a,o){$("#hdIdProyecto").val(a),$("#pnlInfoProyecto").attr("data-idproyecto",a),$("#pnlInfoProyecto .info .descripcion").text(o),$("#pnlInfoLiquidacion").attr("data-idproyecto",a),$("#pnlInfoLiquidacion .info .descripcion").text(o),$("#pnlDatosFiltro").fadeOut("400",function(){var a=new Date,o=a.getFullYear();ListarAnhoProceso(o)})}function ListarProyectos(a){var o="#gvFiltro",t=o+" .gridview";precargaExp(o,!0),$(t).addClass("items-area").addClass("listview").removeClass("card-area"),$.ajax({type:"GET",url:"services/condominio/condominio-search.php",cache:!1,dataType:"json",data:"tipo=asignacion&criterio="+$("#txtSearchFiltro").val()+"&pagina="+a,success:function(o){var e=0,n=0,i="";if(n=o.length,n>0){for(;e<n;)iditem=o[e].idproyecto,i+='<a href="#" class="list dato without-foto bg-gray-glass bg-cyan g200" data-idproyecto="'+iditem+'" data-tipoproyecto="'+o[e].tipoproyecto+'" data-nombre="'+o[e].nombreproyecto+" | Proceso: "+arrMeses[parseInt(o[e].mesproceso)-1]+" "+o[e].anhoproceso+'" data-mes="'+o[e].mesproceso+'" data-anho="'+o[e].anhoproceso+'" data-escobrodiferenciado="'+o[e].escobrodiferenciado+'">',i+='<input name="chkItem[]" type="checkbox" class="oculto" value="'+iditem+'" />',i+='<div class="list-content pos-rel">',i+='<div class="data">',i+='<main><p class="fg-white"><span class="descripcion">'+o[e].nombreproyecto+" | Proceso: "+arrMeses[parseInt(o[e].mesproceso)-1]+" "+o[e].anhoproceso+"</span></p>",i+="</main></div></div>",i+="</a>",++e;paginaFiltro+=1,$("#hdPage").val(paginaFiltro),"1"==a?($("#btnNuevo").removeClass("oculto"),$(t).html(i)):$(t).append(i)}else"1"==a&&($("#btnNuevo").addClass("oculto"),$(t).html("<h2>No hay datos.</h2>"));precargaExp("#gvFiltro",!1)}})}function ListarAnhoProceso(a){$.ajax({url:"services/proceso/proceso-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"ANHO",idproyecto:$("#hdIdProyecto").val()},success:function(o){var t=0,e=0,n="",i="";if(e=o.length,e>0)for(;t<e;)i=a==o[t].per_ano?' selected="selected"':"",n+="<option"+i+' value="'+o[t].per_ano+'">'+o[t].per_ano+"</option>",++t;else n+='<option value="0">NO HAY PROCESOS RELACIONADOS CON EL PROYECTO SELECCIONADO</option>';$("#ddlAnho").html(n),ListarLiquidacion()},error:function(a){console.log(a)}})}function ListarLiquidacion(){$.ajax({url:"services/liquidacion/liquidacion-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"1",idproyecto:$("#hdIdProyecto").val(),anho:$("#hdAnho").val(),mes:$("#hdMes").val()},success:function(a){var o=a.length;if(o>0){var t=Number(a[0].saldoinicial).toFixed(2);$("#hdIdCierreLiquidacion").val(a[0].idcierreliquidacion),$("#hdSaldoInicial").val(t),$("#lblSaldoInicial").text(t),$("#txtSaldoInicial").val(t),CalcularLiquidacion()}},error:function(a){console.log(a)}})}function EnvioAdminDatos(a){var o=new FormData,t=$("#modalLiquidacion :input").serializeArray();o.append("btnGuardar","btnGuardar"),o.append("hdIdPrimary",$("#hdIdPrimary").val()),o.append("hdIdProyecto",$("#hdIdProyecto").val()),$.each(t,function(a,t){o.append(t.name,t.value)}),$.ajax({type:"POST",url:"services/liquidacion/liquidacion-post.php",contentType:!1,processData:!1,cache:!1,dataType:"json",data:o,success:function(a){MessageBox(a.titulomsje,a.contenidomsje,"[Aceptar]",function(){"0"!=a.rpta&&(ListarLiquidacion(),closeCustomModal("#modalLiquidacion"),$("#btnNuevo, #btnUploadExcel").removeClass("oculto"),$("#btnLimpiarSeleccion, #btnEditar, #btnEliminar").addClass("oculto"))})},error:function(a){console.log(a)}})}function GuardarDatos(){$("#form1").submit()}function LimpiarForm(){$("#hdIdPrimary").val("0"),$("#txtSaldoInicial").val("").focus()}function GoToEdit(){var a=$("#tableLiquidacion tr.selected"),o="0";a.length>0&&(o=a.attr("data-idliquidacion"),$.ajax({url:"services/liquidacion/liquidacion-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"2",id:o}}).done(function(a){var o=0;o=a.length,o>0&&($("#hdIdPrimary").val(a[0].tm_idliquidacion),$("#ddlAnho").val(a[0].tm_per_ano),$("#ddlMes").val(a[0].tm_per_mes),$("#txtSaldoInicial").val(a[0].tm_saldoinicial),setProyecto(a[0].tm_idproyecto,a[0].nombreproyecto))}).fail(function(){console.log("error")}).always(function(){console.log("complete")})),openCustomModal("#modalLiquidacion")}function RegistrarSaldoInicial(){var a=new FormData,o=$("#modalSaldoInicial :input").serializeArray();a.append("btnGuardar","btnGuardar"),a.append("hdIdCierreLiquidacion",$("#hdIdCierreLiquidacion").val()),a.append("hdIdProyecto",$("#hdIdProyecto").val()),a.append("hdAnho",$("#hdAnho").val()),a.append("hdMes",$("#hdMes").val()),$.each(o,function(o,t){a.append(t.name,t.value)}),$.ajax({type:"POST",url:"services/liquidacion/liquidacion-post.php",contentType:!1,processData:!1,cache:!1,dataType:"json",data:a,success:function(a){createSnackbar(a.titulomsje),"0"!=a.rpta&&($("#modalSaldoInicial").modal("hide"),ListarLiquidacion())},error:function(a){console.log(a)}})}function ListarCobranza_Resumen(){precargaExp("#gvCobranza",!0),$.ajax({url:"services/cobranza/cobranza-search.php",type:"GET",dataType:"json",data:{tipo:"LIQUIDACION",tipobusqueda:"1",idproyecto:$("#hdIdProyecto").val(),anho:$("#hdAnho").val(),mes:$("#hdMes").val()},success:function(a){var o=0,t=a.length,e="";if(precargaExp("#gvCobranza",!1),t>0)for(;o<t;)e+="<tr>",e+="<td>"+a[o].nombremes+"</td>",e+="<td>"+a[o].importe+"</td>",e+='<td><button type="button" data-action="view-details" class="btn btn-primary" data-mes="'+a[o].numeromes+'">VER DETALLE</button></td>',e+="</tr>",++o;$("#gvCobranza tbody").html(e)},error:function(a){console.log(a)}})}function ListarCobranzas_Proceso(a){$.ajax({url:"services/cobranza/cobranza-search.php",type:"GET",dataType:"json",data:{tipo:"COBRANZAS",tipobusqueda:"1",idproyecto:$("#hdIdProyecto").val(),anho:$("#hdAnho").val(),mes:a},success:function(a){var o=0,t=0,e="";if(precargaExp("#tableCobranza_Detalle",!1),t=a.length,t>0)for(;o<t;)e+='<tr data-idconceptocobranza="'+a[o].td_idconsumoescalonable+'">',e+="<td>"+a[o].tipooperacion+"</td>",e+="<td>"+convertDate(a[o].td_fecha)+"</td>",e+="<td>"+a[o].td_num_operacion+"</td>",e+='<td class="consumo">'+Number(a[o].td_valorconcepto).toFixed(2)+"</td>",e+="</tr>",++o;$("#tableCobranza_Detalle tbody").html(e)},error:function(a){console.log(a)}})}function ListarGastos_Proceso(a){var o="#tableGasto_Detalle",t=o+" tbody";precargaExp(o,!0),$.ajax({url:"services/gasto/gasto-search.php",type:"GET",dataType:"json",data:{tipo:"DETALLADO",idproyecto:$("#hdIdProyecto").val(),anho:$("#hdAnho").val(),tipogasto:a},success:function(a){var e=0,n="",i="0",r=a.length;if(r>0){for(;e<r;)i=a[e].idgastoproyecto,n+='<tr data-idgasto="'+i+'">',n+="<td>"+a[e].desctipogasto+"</td>",n+="<td>"+a[e].desctipodesembolso+"</td>",n+="<td>"+a[e].desctipoafectacion+"</td>",n+="<td>"+convertDate(a[e].fecha_documento)+"</td>",n+="<td>"+a[e].numerosuministro+"</td>",n+="<td>"+a[e].descripciongasto+"</td>",n+="<td>"+arrMeses[parseInt(a[e].per_mes)-1]+"</td>",n+="<td>"+a[e].per_anho+"</td>",n+="<td>"+Number(a[e].importe).toFixed(2)+"</td>",n+="</tr>",++e;$(t).html(n)}else $(t).html("<h2>No hay datos.</h2>");precargaExp(o,!1)},error:function(a){console.log(a)}})}function ListarGasto_Resumen(){precargaExp("#gvGasto",!0),$.ajax({url:"services/gasto/gasto-search.php",type:"GET",dataType:"json",data:{tipo:"LIQUIDACION",idproyecto:$("#hdIdProyecto").val(),anho:$("#hdAnho").val(),mes:$("#hdMes").val()},success:function(a){var o=0,t=0,e="";if(precargaExp("#gvGasto",!1),t=a.length,t>0)for(;o<t;)e+="<tr>",e+="<td>"+a[o].tipogasto+"</td>",e+="<td>"+Number(a[o].importe).toFixed(2)+"</td>",e+='<td><button type="button" data-action="view-details" class="btn btn-primary" data-tipogasto="'+a[o].codtipogasto+'">VER DETALLE</button></td>',e+="</tr>",++o;$("#gvGasto tbody").html(e)},error:function(a){console.log(a)}})}function ObtenerTotal_Cobranza(a,o,t){$.ajax({url:"services/cobranza/cobranza-search.php",type:"GET",dataType:"json",data:{tipo:"TOTAL",idproyecto:a,anho:o,mes:t},success:function(a){var o=Number(a).toFixed(2);$("#lblCobranza").text("S/. "+o),$("#hdCobranza").val(o),CalcularLiquidacion()},error:function(a){console.log(a)}})}function ObtenerTotal_Gasto(a,o,t){$.ajax({url:"services/gasto/gasto-search.php",type:"GET",dataType:"json",data:{tipo:"TOTAL",idproyecto:a,anho:o,mes:t},success:function(a){var o=Number(a).toFixed(2);$("#lblGasto").text("S/. "+o),$("#hdGasto").val(o),CalcularLiquidacion()},error:function(a){console.log(a)}})}function CalcularLiquidacion(){var a=Number($("#hdSaldoInicial").val()),o=Number($("#hdCobranza").val()),t=Number($("#hdGasto").val()),e=(a+o-t).toFixed(2);$("#hdSaldo").val(e),$("#lblSaldo").text("S/. "+e)}function ShowPanel(a,o,t){$("#pnlDatosDetalle").fadeIn(400,function(){var e="";"cobranza"==a?(ListarCobranzas_Proceso(o),$("#tableCobranza_Detalle").removeClass("hide"),$("#tableGasto_Detalle").addClass("hide"),e="DETALLE DE COBRANZAS"):(e="DETALLE DE GASTOS",$("#tableCobranza_Detalle").addClass("hide"),$("#tableGasto_Detalle").removeClass("hide"),ListarGastos_Proceso(t)),$("#txtTituloFiltro").text(e)})}$(function(){$("#btnHideFiltro").on("click",function(a){a.preventDefault(),$("#pnlDatosDetalle").fadeOut(400,function(){})}),$("#btnClearFilter").on("click",function(a){a.preventDefault(),$("#btnClearFilter, #btnAsignFilter").addClass("oculto"),$("#btnSelectAllFilter").removeClass("oculto"),$("#gvFiltro input:checkbox").removeAttr("checked"),$("#gvFiltro .dato").removeClass("selected")}),$("#btnSelectAllFilter").on("click",function(a){a.preventDefault(),$(this).addClass("oculto"),$("#btnClearFilter, #btnAsignFilter").removeClass("oculto"),$("#gvFiltro input:checkbox").attr("checked",""),$("#gvFiltro .dato").addClass("selected")}),$("#btnNuevo, #btnEditar").on("click",function(a){a.preventDefault(),LimpiarForm(),GoToEdit()}),$("#form1").validate({lang:"es",showErrors:showErrorsInValidate,submitHandler:EnvioAdminDatos}),$("#gvCobranza").on("click",'button[data-action="view-details"]',function(a){a.preventDefault();var o=this.getAttribute("data-mes");ShowPanel("cobranza",o,"")}),$("#gvGasto").on("click",'button[data-action="view-details"]',function(a){a.preventDefault();var o=this.getAttribute("data-tipogasto");ShowPanel("gasto","",o)}),$("#btnGuardar").on("click",function(a){GuardarDatos()}),$("#btnShowDetalle_Cobranza").on("click",function(a){a.preventDefault(),ListarCobranza_Resumen(),$("#gvCobranza").toggle(400,function(a){})}),$("#btnShowDetalle_Gasto").on("click",function(a){a.preventDefault(),ListarGasto_Resumen(),$("#gvGasto").toggle(400,function(a){})}),$("#txtSaldoInicial").click(function(){$(this).select()}),$("#btnSaldoInicial").on("click",function(a){a.preventDefault(),$("#modalSaldoInicial").modal("show")}),$("#modalSaldoInicial").on("shown.bs.modal",function(a){$("#txtSaldoInicial").val($("#lblSaldoInicial").text()).focus().select()}),$("#btnGuardarSaldoInicial").on("click",function(a){a.preventDefault(),RegistrarSaldoInicial()})});var paginaGasto=1,paginaCobr,arrMeses=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];