function ListarArchivos(){var o=window.top.idproyecto;$("#hdIdProyecto").val(o),$.ajax({url:"services/archivos/archivos-search.php",type:"GET",dataType:"json",data:{tipo:"4",idproyecto:o},success:function(o){var e=0,r="",t=o.length;if(t>0)for(;e<t;)r+="<tr><td>"+o[e].tm_nombredocumento+'</td><td><a href="'+o[e].tm_ubicaciondocumento+'" class="btn btn-primary" target="_blank">Descargar archivo</a></td></tr>',++e;$("#tableDocumentos tbody").html(r)},error:function(o){console.log(o)}})}function prepareImport(o){var e=["xls","xlsx","pdf","doc","docx","jpg","png","gif","ppt","pptx"],r="",t="";return fileValue=o[0],t=o[0].name,r=t.split(".").pop().toLowerCase(),$.inArray(r,e)==-1?(MessageBox("Extensi&oacute;n no v&aacute;lida","El tipo de archivo no es compatible para la importaci&oacute;n","[Aceptar]",function(){}),!1):($(".droping-air .help").text(t),$(".droping-air").addClass("dropped"),habilitarControl("#btnSubirDatos",!0),void $("#btnSubirDatos").addClass("success"))}function cancelImport(){$(".droping-air .help").text("Seleccione o arrastre un archivo de Excel"),$(".droping-air").removeClass("dropped"),habilitarControl("#btnSubirDatos",!1),$("#btnSubirDatos").removeClass("success"),$(".droping-air .file-import").val(""),fileValue=!1}function executeImport(){var o=fileValue,e=new FormData;e.append("btnSubirDatos","btnSubirDatos"),e.append("hdIdProceso",$("#ddlProceso").val()),e.append("hdIdProyecto",$("#hdIdProyecto").val()),e.append("hdAnho",$("#hdAnho").val()),e.append("hdMes",$("#hdMes").val()),e.append("archivo",o),$.ajax({type:"POST",url:"services/archivos/archivos-post.php",contentType:!1,processData:!1,cache:!1,dataType:"json",data:e,success:function(o){progressError=!1,"0"!=o.rpta&&(progressSuccess=!0),MessageBox(o.titulomsje,o.contenidomsje,"[Aceptar]",function(){"0"!=o.rpta&&(closeCustomModal("#modalUploadExcel"),cancelImport(),ListarArchivos())})},beforeSend:function(){},complete:function(){progress=0,progressError&&setTimeout(function(){executeImport()},1e4)},error:function(o){progress=0,progressError=!0,console.log(o)}})}function ListarProcesos(){var o=window.top.idproyecto;$("#hdIdProyecto").val(o),$.ajax({url:"services/proceso/proceso-search.php",type:"GET",dataType:"json",data:{tipobusqueda:"LISTADO",tipo:"1",id:o},success:function(o){var e=0,r="",t=o.length;if(t>0){for(;e<t;)r+='<option value="'+o[e].tm_idproceso+'" data-mes="'+o[e].tm_per_mes+'" data-anho="'+o[e].tm_per_ano+'" data-estado="'+o[e].tm_idestadoproceso+'">',r+="PROCESO "+arrMeses[parseInt(o[e].tm_per_mes)-1]+" "+o[e].tm_per_ano+"</option>",++e;$("#ddlProceso").html(r)}else $("#ddlProceso").html('<option value="0">NO SE ENCONTRARON PROCESOS RELACIONADOS AL PROYECTO SELECCIONADO</option>');$("#ddlProceso").trigger("change")},error:function(o){console.log(o)}})}function IniciarForm(){var o=window.top.idproyecto,e=window.top.anho,r=window.top.mes;$("#hdIdProyecto").val(o),$("#hdAnho").val(e),$("#hdMes").val(r),ListarArchivos()}$(function(){IniciarForm(),$("#btnImportarArchivos").on("click",function(o){openModalCallBack("#modalUploadExcel",function(){ListarProcesos()})}),$(".droping-air .file-import").on({dragenter:function(o){o.stopPropagation(),o.preventDefault()},dragover:function(o){o.stopPropagation(),o.preventDefault()},change:function(o){o.preventDefault(),prepareImport(this.files)},drop:function(o){o.preventDefault();var e=o.originalEvent.dataTransfer.files;prepareImport(e)}}),$("#btnCancelarSubida").on("click",function(o){o.preventDefault(),cancelImport()}),$("#btnSubirDatos").on("click",function(o){o.preventDefault(),executeImport()}),$("#ddlProceso").on("change",function(o){o.preventDefault();var e=$("#ddlProceso option:selected"),r=e.attr("data-anho"),t=e.attr("data-mes"),a=e.attr("data-estado");$("#hdAnho").val(r),$("#hdMes").val(t),$("#hdEstado_proceso").val(a)})});var fileValue=!1,progressError=!1,progressSuccess=!1,arrMeses=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];