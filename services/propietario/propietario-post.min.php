<?php include("../../common/sesion.class.php"); require('../../common/class.translation.php'); include('../../adata/Db.class.php'); include('../../bussiness/documentos.php'); include('../../bussiness/propietario.php'); $sesion = new sesion(); $idusuario = $sesion->get("idusuario"); $idperfil = $sesion->get("idperfil"); $IdEmpresa = 1; $IdCentro = 1; $counterDocIdentidad = 0; $counterValidItems = 0; $strListItems = ''; $strListDelete = ''; $strListValids = ''; $validItems = false; $arrayValid = array(); $arrayDelete = array(); $rpta = '0'; $titulomsje = ''; $contenidomsje = ''; $objData = new clsPropietario(); if ($_POST){ if (isset($_POST['btnGuardar'])){ $hdIdPrimary = (isset($_POST['hdIdPrimary'])) ? $_POST['hdIdPrimary'] : '0'; $hdIdContactoEmpresa = (isset($_POST['hdIdContactoEmpresa'])) ? $_POST['hdIdContactoEmpresa'] : '0'; $hdTipoPropietario = (isset($_POST['hdTipoPropietario'])) ? $_POST['hdTipoPropietario'] : 'NA'; $hdFoto = isset($_POST['hdFoto']) ? $_POST['hdFoto'] : 'no-set'; $ddlCanal = isset($_POST['ddlCanal']) ? $_POST['ddlCanal'] : 0; $ddlTipoDocNatural = (isset($_POST['ddlTipoDocNatural'])) ? $_POST['ddlTipoDocNatural'] : '0'; $txtNroDocNatural = isset($_POST['txtNroDocNatural']) ? $_POST['txtNroDocNatural'] : ''; $txtApePaterno = isset($_POST['txtApePaterno']) ? $_POST['txtApePaterno'] : ''; $txtApeMaterno = isset($_POST['txtApeMaterno']) ? $_POST['txtApeMaterno'] : ''; $txtNombres = isset($_POST['txtNombres']) ? $_POST['txtNombres'] : ''; $txtDireccionNatural = isset($_POST['txtDireccionNatural']) ? $_POST['txtDireccionNatural'] : ''; $txtTelefonoNatural = isset($_POST['txtTelefonoNatural']) ? $_POST['txtTelefonoNatural'] : ''; $txtEmailNatural = isset($_POST['txtEmailNatural']) ? $_POST['txtEmailNatural'] : ''; $hdIdUbigeoNatural = isset($_POST['hdIdUbigeoNatural']) ? $_POST['hdIdUbigeoNatural'] : '0'; $txtRucEmpresa = isset($_POST['txtRucEmpresa']) ? $_POST['txtRucEmpresa'] : ''; $txtRazonSocial = isset($_POST['txtRazonSocial']) ? $_POST['txtRazonSocial'] : ''; $txtRepresentante = isset($_POST['txtRepresentante']) ? $_POST['txtRepresentante'] : ''; $txtDireccionEmpresa = isset($_POST['txtDireccionEmpresa']) ? $_POST['txtDireccionEmpresa'] : ''; $txtTelefonoEmpresa = isset($_POST['txtTelefonoEmpresa']) ? $_POST['txtTelefonoEmpresa'] : ''; $txtEmailEmpresa = isset($_POST['txtEmailEmpresa']) ? $_POST['txtEmailEmpresa'] : ''; $hdIdUbigeoEmpresa = isset($_POST['hdIdUbigeoEmpresa']) ? $_POST['hdIdUbigeoEmpresa'] : '0'; $txtWebEmpresa = isset($_POST['txtWebEmpresa']) ? $_POST['txtWebEmpresa'] : '0'; $IdCanal = ($hdTipoPropietario == 'JU') ? $ddlCanal : 1; $IdDocIdent = ($hdTipoPropietario == 'JU') ? 2 : $ddlTipoDocNatural; $NroDocIdent = ($hdTipoPropietario == 'JU') ? $txtRucEmpresa : $txtNroDocNatural; $Direccion = ($hdTipoPropietario == 'JU') ? $txtDireccionEmpresa : $txtDireccionNatural; $Telefono = ($hdTipoPropietario == 'JU') ? $txtTelefonoEmpresa : $txtTelefonoNatural; $Email = ($hdTipoPropietario == 'JU') ? $txtEmailEmpresa : $txtEmailNatural; $IdUbigeo = ($hdTipoPropietario == 'JU') ? $hdIdUbigeoEmpresa : $hdIdUbigeoNatural; $ddlTipoDocUE = (isset($_POST['ddlTipoDocUE'])) ? $_POST['ddlTipoDocUE'] : '0'; $txtNroDocUE = isset($_POST['txtNroDocUE']) ? $_POST['txtNroDocUE'] : ''; $txtApePaternoUE = isset($_POST['txtApePaternoUE']) ? $_POST['txtApePaternoUE'] : ''; $txtApeMaternoUE = isset($_POST['txtApeMaternoUE']) ? $_POST['txtApeMaternoUE'] : ''; $txtNombresUE = isset($_POST['txtNombresUE']) ? $_POST['txtNombresUE'] : ''; $txtEmailUE = isset($_POST['txtEmailUE']) ? $_POST['txtEmailUE'] : ''; $hdIdUbigeoUE = isset($_POST['hdIdUbigeoUE']) ? $_POST['hdIdUbigeoUE'] : ''; if (empty($_FILES['archivo']['name'])) { $urlLogo = $hdFoto; } else { $upload_folder = '../../media/images/'; $url_folder = 'media/images/'; $nombre_archivo = $_FILES['archivo']['name']; $tipo_archivo = $_FILES['archivo']['type']; $tamano_archivo = $_FILES['archivo']['size']; $tmp_archivo = $_FILES['archivo']['tmp_name']; $nombre_archivo = trim($nombre_archivo); $nombre_archivo = str_replace(' ', '', $nombre_archivo); $archivador = $upload_folder.$nombre_archivo; if (move_uploaded_file($tmp_archivo, $archivador)) { $urlLogo = $url_folder.$nombre_archivo; } else { $urlLogo = $hdFoto; } } $rpta = $objData->Registrar($hdTipoPropietario, $hdIdPrimary, $IdEmpresa, $IdCentro, $IdDocIdent, $NroDocIdent, $txtRazonSocial, $txtRepresentante, $txtNombres, $txtApePaterno, $txtApeMaterno, $Direccion, $Telefono, '', $Email, $urlLogo, $txtWebEmpresa, $IdUbigeo, $idusuario, $rpta, $titulomsje, $contenidomsje); if ($hdTipoPropietario == 'JU'){ /*if ($rpta > 0){ $objData->RegistrarContactoEmpresa($hdIdContactoEmpresa, $rpta, $ddlTipoDocUE, $txtNroDocUE, $txtNombresUE, $txtApePaternoUE, $txtApeMaternoUE, $txtEmailUE, $hdIdUbigeoUE, $idusuario); }*/ } } elseif (isset($_POST['btnEliminar'])) { $chkItem = $_POST['chkItem']; if (isset($chkItem)) if (is_array($chkItem)) { $countCheckItems = count($chkItem); $strListItems = implode(',', $chkItem); $rpta = $objData->Eliminar($strListItems, $idusuario, $rpta, $titulomsje, $contenidomsje); } } $jsondata = array('rpta' => $rpta, 'titulomsje' => $titulomsje, 'contenidomsje' => $contenidomsje); echo json_encode($jsondata); exit(0); } ?>